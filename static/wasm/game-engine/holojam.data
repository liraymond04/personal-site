---@meta animation

---
---Anim class represents an animation definition with frames and transition conditions
---@class Anim
---@field name string Name of animator object
---@field animator Animator Reference to parent animator object
---@field Before function Function that runs before every frame tick
---@field After function Function that runs after every frame tick
---@field frame_resources integer[] Array of animator resource indices used in Anim object
---@field total_frames integer Total number of frames in animation
---@field current_frame integer Current frame to be displayed
---@field next_frame integer Next frame to transition to on frame tick
---@field frames_per_second integer Rate that animation changes frames
---@field frame_enter function[] Function runs once this frame is entered
---@field frame_update function[] Function runs every update tick for this frame
---@field frame_exit function[] Function runs once this frame is exited
---@field frame_started boolean Keep track of when the current frame has started ticking
---@field timer number Counter for timing animation ticks
---@field target_frame_time number Target frame time calculated from frames per second
---
Anim = {}
Anim.__index = Anim

---
---Constructor function to create a new Animator object
---@param name string Name of animator object
---@param frame_resources integer[] Array of resources used
---@param total_frames integer Total number of frames in animation
---@param initial_frame integer Initial frame of animation
---@param frames_per_second integer Rate that animation changes frames
---@return Anim
---
function Anim.new(name, frame_resources, total_frames, initial_frame, frames_per_second)
    local self = setmetatable({}, Anim)
    self.name = name
    self.frame_resources = frame_resources
    self.total_frames = total_frames
    self.current_frame = initial_frame
    self.frames_per_second = frames_per_second
    self.frame_enter = {}
    self.frame_update = {}
    self.frame_exit = {}
    self.frame_started = false
    self.timer = 0
    self.target_frame_time = 1.0 / self.frames_per_second
    return self
end

---
---Function that runs every animation tick, typically the frame rate of the application.
---The local Anim object timer is accumulated until it reaches the target frame time,
---where it will be reset and the current frame will be set to the next queued frame.
---
function Anim:Tick()
    if self.Before then
        self:Before()
    end

    local elapsed_time = GetFrameTime()
    self.timer = self.timer + elapsed_time

    -- frame enter
    if not self.frame_started then
        local enter = self.frame_enter[self.current_frame]
        if enter then
            enter(self)
        end
    end
    self.frame_started = true

    -- frame update
    local update = self.frame_update[self.current_frame]
    if update then
        update(self)
    end
    if self.timer >= self.target_frame_time then
        self.current_frame = self.next_frame
        self.timer = 0

        -- frame exit
        local fexit = self.frame_exit[self.current_frame]
        if fexit then
            fexit(self)
        end
        self.frame_started = false
    end

    if self.After then
        self:After()
    end
end

---
---Helper function to set next frame from the current and total frames.
---
function Anim:NextFrame()
    self.next_frame = self.current_frame + 1
    if self.next_frame > self.total_frames then
        self.next_frame = 1
    end
end

---
---Animator class representing the definition of resources and behaviour for an animation.
---@class Animator
---@field name string Name of animation object
---@field Init function Initialization function, should load resources like textures and anims
---@field Before function Function that runs before every animator tick
---@field After function Function that runs after every animator tick
---@field x number X position of animator object
---@field y number Y position of animator object
---@field w number Width of animator object
---@field h number Height of animator object
---@field resources (string | Texture2D | Sound)[] Array of resources loaded by animator object
---@field anims { [string]: Anim } Map of references to Anim objects loaded animator object
---@field current_state string Current Anim state, should match a loaded Anim
---@field state { [string]: any } Map of custom state variables for use in programmatic behaviour
---@field state_enter { [string]: function } Function that runs when a state is entered
---@field state_exit { [string]: function } Function that runs when a state is exited
---
Animator = {}
Animator.__index = Animator

---
---Constructor function to create a new Animator object
---@param name string Name of animator object
---@return Animator
---
function Animator.new(name)
    local self = setmetatable({}, Animator)
    self.name = name
    self.x = 0
    self.y = 0
    self.w = 0
    self.h = 0
    self.resources = {}
    self.anims = {}
    self.current_state = ""
    self.state = {}
    self.state_enter = {}
    self.state_exit = {}
    return self
end

---
---Load resource file from a rres resource path (the rres file should be loaded by engine already)
---@param path string rres resource path
---@param group? audio_group_t Audio group to add sound resource to optionally
---
function Animator:LoadResource(path, group)
    local latest = #self.resources
    local resource = Engine_LoadResource(path, 0)
    if type(resource) ~= "boolean" then
        self.resources[latest + 1] = resource

        if group and type(resource) == "userdata" then
            audio_group_add_sound(group, resource)
        end
    end
end

---
---Load Anim object from a directory
---@param anim Anim Path to directory with Anim definition
---
function Animator:LoadAnim(anim)
    self.anims[anim.name] = anim
    self.anims[anim.name].animator = self
end

---
---Function that runs every animation tick, typically the frame rate of the application.
---Runs the tick function of the currently active Anim object state.
---
function Animator:Tick()
    if self.Before then
        self:Before()
    end
    self.anims[self.current_state]:Tick()
    if self.After then
        self:After()
    end
end

---
---Changes the current state to the new state if it is different, and runs the proper enter
---and exit functions if they exist for the old and new states.
---
function Animator:ChangeState(new_state)
    if self.current_state == new_state then
        return
    end

    local exit = self.state_exit[self.current_state]
    if exit then
        exit(self)
    end

    self.current_state = new_state

    local enter = self.state_enter[self.current_state]
    if enter then
        enter(self)
    end
end

---Sound is a pointer to a sound loaded by raylib
---@alias Sound userdata
local PATH = (...):gsub("(%.init)$", "")

return {
  serializable = require(PATH..".serializable"),
  key          = require(PATH..".key"),
}
local PATH = (...):gsub('%.builtins%.[^%.]+$', '')

local Component = require(PATH..".component")

local getKey = function (self, key)
  local entity = self.__entity

  if not entity:inWorld() then
    error("entity needs to belong to a world")
  end

  local world = entity:getWorld()

  return world:__assignKey(entity, key)
end

local Key = Component("key", function (self, key)
  self.value = getKey(self, key)
end)

function Key:deserialize (data)
  self.value = getKey(self, data)
end

function Key.__mt:__call()
  return self.value
end

function Key:removed (replaced)
  if not replaced then
    local entity = self.__entity

    if entity:inWorld() then
      local world = entity:getWorld()

      return world:__clearKey(entity)
    end
  end
end

return Key
local PATH = (...):gsub('%.builtins%.[^%.]+$', '')

local Component = require(PATH..".component")

local Serializable = Component("serializable")

function Serializable:serialize ()
  -- Don't serialize this Component
  return nil
end

return Serializable--- A pure data container that is contained by a single entity.
-- @classmod Component

local PATH = (...):gsub('%.[^%.]+$', '')

local Components = require(PATH..".components")
local Utils      = require(PATH..".utils")

local Component = {}
Component.__mt = {
   __index = Component,
}

--- Creates a new ComponentClass.
-- @tparam function populate Function that populates a Component with values
-- @treturn Component A new ComponentClass
function Component.new(name, populate)
   if (type(name) ~= "string") then
      Utils.error(2, "bad argument #1 to 'Component.new' (string expected, got %s)", type(name))
   end

   if (string.match(name, Components.__REJECT_MATCH) ~= "") then
      Utils.error(2, "bad argument #1 to 'Component.new' (Component names can't start with '%s', got %s)", Components.__REJECT_PREFIX, name)
   end

   if (rawget(Components, name)) then
      Utils.error(2, "bad argument #1 to 'Component.new' (ComponentClass with name '%s' was already registerd)", name) -- luacheck: ignore
   end

   if (type(populate) ~= "function" and type(populate) ~= "nil") then
      Utils.error(2, "bad argument #1 to 'Component.new' (function/nil expected, got %s)", type(populate))
   end

   local componentClass = setmetatable({
      __populate = populate,

      __name             = name,
      __isComponentClass = true,
   }, Component.__mt)

   componentClass.__mt = {
      __index = componentClass
   }

   Components[name] = componentClass

   return componentClass
end

-- Internal: Populates a Component with values.
function Component:__populate() -- luacheck: ignore
end

-- Callback: When the Component gets removed or replaced in an Entity.
function Component:removed() -- luacheck: ignore
end

-- Callback: When the Component gets serialized as part of an Entity.
function Component:serialize()
   local data = Utils.shallowCopy(self, {})

   --This values shouldn't be copied over
   data.__componentClass   = nil
   data.__entity           = nil
   data.__isComponent      = nil
   data.__isComponentClass = nil

   return data
end

-- Callback: When the Component gets deserialized from serialized data.
function Component:deserialize(data)
   Utils.shallowCopy(data, self)
end

-- Internal: Creates a new Component.
-- @param entity The Entity that will receive this Component.
-- @return A new Component
function Component:__new(entity)
   local component = setmetatable({
      __componentClass = self,

      __entity           = entity,
      __isComponent      = true,
      __isComponentClass = false,
   }, self.__mt)

   return component
end

-- Internal: Creates and populates a new Component.
-- @param entity The Entity that will receive this Component.
-- @param ... Varargs passed to the populate function
-- @return A new populated Component
function Component:__initialize(entity, ...)
   local component = self:__new(entity)

   ---@diagnostic disable-next-line: redundant-parameter
   self.__populate(component, ...)

   return component
end

--- Returns true if the Component has a name.
-- @treturn boolean
function Component:hasName()
   return self.__name and true or false
end

--- Returns the name of the Component.
-- @treturn string
function Component:getName()
   return self.__name
end

return setmetatable(Component, {
   __call = function(_, ...)
      return Component.new(...)
   end,
})
--- Container for registered ComponentClasses
-- @module Components

local Components = {}

Components.__REJECT_PREFIX = "!"
Components.__REJECT_MATCH = "^(%"..Components.__REJECT_PREFIX.."?)(.+)"

--- Returns true if the containter has the ComponentClass with the specified name
-- @string name Name of the ComponentClass to check
-- @treturn boolean
function Components.has(name)
   return rawget(Components, name) and true or false
end

--- Prefix a component's name with the currently set Reject Prefix
-- @string name Name of the ComponentClass to reject
-- @treturn string
function Components.reject(name)
   local ok, err = Components.try(name)

   if not ok then error(err, 2) end

   return Components.__REJECT_PREFIX..name
end

--- Returns true and the ComponentClass if one was registered with the specified name
-- or false and an error otherwise
-- @string name Name of the ComponentClass to check
-- @boolean acceptRejected Whether to accept names prefixed with the Reject Prefix.
-- @treturn boolean
-- @treturn Component or error string
-- @treturn true if acceptRejected was true and the name had the Reject Prefix, false otherwise.
function Components.try(name, acceptRejected)
   if type(name) ~= "string" then
      return false, "ComponentsClass name is expected to be a string, got "..type(name)..")"
   end

   local rejected = false
   if acceptRejected then
      local prefix
      prefix, name = string.match(name, Components.__REJECT_MATCH)

      rejected = prefix ~= "" and name
   end

   local value = rawget(Components, name)
   if not value then
      return false, "ComponentClass '"..name.."' does not exist / was not registered"
   end

   return true, value, rejected
end

--- Returns the ComponentClass with the specified name
-- @string name Name of the ComponentClass to get
-- @treturn Component
function Components.get(name)
   local ok, value = Components.try(name)

   if not ok then error(value, 2) end

   return value
end

return setmetatable(Components, {
   __index = function(_, name)
      local ok, value = Components.try(name)

      if not ok then error(value, 2) end

      return value    end
})
--- An object that exists in a world. An entity
-- contains components which are processed by systems.
-- @classmod Entity

local PATH = (...):gsub('%.[^%.]+$', '')

local Components = require(PATH..".components")
local Type       = require(PATH..".type")
local Utils      = require(PATH..".utils")

-- Initialize built-in Components (as soon as possible)
local Builtins   = require(PATH..".builtins.init") --luacheck: ignore
-- Builtins is unused but the require already registers the Components

local Entity = {
   SERIALIZE_BY_DEFAULT = true,
}

Entity.__mt = {
   __index = Entity,
}

--- Creates a new Entity. Optionally adds it to a World.
-- @tparam[opt] World world World to add the entity to
-- @treturn Entity A new Entity
function Entity.new(world)
   if (world ~= nil and not Type.isWorld(world)) then
      Utils.error(2, "bad argument #1 to 'Entity.new' (world/nil expected, got %s)", type(world))
   end

   local e = setmetatable({
      __world      = nil,

      __isEntity = true,
   }, Entity.__mt)

   if (world) then
      world:addEntity(e)
   end

   if Entity.SERIALIZE_BY_DEFAULT then
      e:give("serializable")
   end

   return e
end

local function createComponent(e, name, componentClass, ...)
   local component = componentClass:__initialize(e, ...)
   local hadComponent = not not e[name]

   if hadComponent then
      e[name]:removed(true)
   end

   e[name] = component

   if not hadComponent then
      e:__dirty()
   end
end

local function deserializeComponent(e, name, componentData)
   local componentClass = Components[name]
   local hadComponent = not not e[name]

   if hadComponent then
      e[name]:removed(true)
   end

   local component = componentClass:__new(e)
   component:deserialize(componentData)

   e[name] = component

   if not hadComponent then
      e:__dirty()
   end
end

local function giveComponent(e, ensure, name, ...)
   local component
   if Type.isComponent(name) then
      component = name
      name = component:getName()
   end

   if ensure and e[name] then
      return e
   end

   local ok, componentClass = Components.try(name)

   if not ok then
      Utils.error(3, "bad argument #1 to 'Entity:%s' (%s)", ensure and 'ensure' or 'give', componentClass)
   end

   if component then
      local data = component:deserialize()
      if data == nil then
         Utils.error(3, "bad argument #1 to 'Entity:$s' (Component '%s' couldn't be deserialized)", ensure and 'ensure' or 'give', name)
      end

      deserializeComponent(e, name, data)
   else 
      createComponent(e, name, componentClass, ...)
   end

   return e
end


local function removeComponent(e, name)
   if e[name] then
      e[name]:removed(false)

      e[name] = nil

      e:__dirty()
   end
end

--- Gives an Entity a Component.
-- If the Component already exists, it's overridden by this new Component
-- @tparam Component componentClass ComponentClass to add an instance of
-- @param ... additional arguments to pass to the Component's populate function
-- @treturn Entity self
function Entity:give(name, ...)
   return giveComponent(self, false, name, ...)
end

--- Ensures an Entity to have a Component.
-- If the Component already exists, no action is taken
-- @tparam Component componentClass ComponentClass to add an instance of
-- @param ... additional arguments to pass to the Component's populate function
-- @treturn Entity self
function Entity:ensure(name, ...)
   return giveComponent(self, true, name, ...)
end

--- Removes a Component from an Entity.
-- @tparam Component componentClass ComponentClass of the Component to remove
-- @treturn Entity self
function Entity:remove(name)
   local ok, componentClass = Components.try(name)

   if not ok then
      Utils.error(2, "bad argument #1 to 'Entity:remove' (%s)", componentClass)
   end

   removeComponent(self, name)

   return self
end

--- Assembles an Entity.
-- @tparam function assemblage Function that will assemble an entity
-- @param ... additional arguments to pass to the assemblage function.
-- @treturn Entity self
function Entity:assemble(assemblage, ...)
   if type(assemblage) ~= "function" then
      Utils.error(2, "bad argument #1 to 'Entity:assemble' (function expected, got %s)", type(assemblage))
   end

   assemblage(self, ...)

   return self
end

--- Destroys the Entity.
-- Removes the Entity from its World if it's in one.
-- @return self
function Entity:destroy()
   if self.__world then
      self.__world:removeEntity(self)
   end

   return self
end

-- Internal: Tells the World it's in that this Entity is dirty.
-- @return self
function Entity:__dirty()
   if self.__world then
      self.__world:__dirtyEntity(self)
   end

   return self
end

--- Returns true if the Entity has a Component.
-- @tparam Component componentClass ComponentClass of the Component to check
-- @treturn boolean
function Entity:has(name)
   local ok, componentClass = Components.try(name)

   if not ok then
      Utils.error(2, "bad argument #1 to 'Entity:has' (%s)", componentClass)
   end

   return self[name] and true or false
end

--- Gets a Component from the Entity.
-- @tparam Component componentClass ComponentClass of the Component to get
-- @treturn table
function Entity:get(name)
   local ok, componentClass = Components.try(name)

   if not ok then
      Utils.error(2, "bad argument #1 to 'Entity:get' (%s)", componentClass)
   end

   return self[name]
end

--- Returns a table of all Components the Entity has.
-- Warning: Do not modify this table.
-- Use Entity:give/ensure/remove instead
-- @treturn table Table of all Components the Entity has
function Entity:getComponents(output)
   output = output or {}
   local components = Utils.shallowCopy(self, output)
   components.__world = nil
   components.__isEntity = nil

   return components
end

--- Returns true if the Entity is in a World.
-- @treturn boolean
function Entity:inWorld()
   return self.__world and true or false
end

--- Returns the World the Entity is in.
-- @treturn World
function Entity:getWorld()
   return self.__world
end

function Entity:serialize(ignoreKey)
   local data = {}

   for name, component in pairs(self) do
      -- The key component needs to be treated separately.
      if name == "key" and component.__name == "key" then
         if not ignoreKey then
            data.key = component.value
         end
      --We only care about components that were properly given to the entity
      elseif Type.isComponent(component) and (component.__name == name) then
         local componentData = component:serialize()

         if componentData ~= nil then
            componentData.__name = component.__name
            data[#data + 1] = componentData
         end
      end
   end

   return data
end

function Entity:deserialize(data)
   for i = 1, #data do
      local componentData = data[i]

      if (not Components.has(componentData.__name)) then
         Utils.error(2, "bad argument #1 to 'Entity:deserialize' (ComponentClass '%s' wasn't yet loaded)", tostring(componentData.__name)) -- luacheck: ignore
      end

      deserializeComponent(self, componentData.__name, componentData)
   end
end

return setmetatable(Entity, {
   __call = function(_, ...)
      return Entity.new(...)
   end,
})
--- Used to filter Entities with specific Components
-- A Filter has an associated Pool that can contain any amount of Entities.
-- @classmod Filter

local PATH = (...):gsub('%.[^%.]+$', '')

local List       = require(PATH..".list")
local Type       = require(PATH..".type")
local Utils      = require(PATH..".utils")
local Components = require(PATH..".components")


local Filter = {}
Filter.__mt = {
   __index = Filter,
}

--- Validates a Filter Definition to make sure every component is valid.
-- @string name Name for the Filter.
-- @tparam table definition Table containing the Filter Definition
-- @tparam onComponent Optional function, called when a component is valid.
function Filter.validate (errorLevel, name, def, onComponent)
   local filter = "World:query filter"
   if name then
      filter = ("filter '%s'"):format(name)
   end

   if type(def) ~= 'table' then
      Utils.error(3 + errorLevel, "invalid component list for %s (table expected, got %s)", filter, type(def))
   end

   if not onComponent and def.constructor and not Type.isCallable(def.constructor) then
      Utils.error(3 + errorLevel, "invalid pool constructor for %s (callable expected, got %s)", filter, type(def.constructor))
   end

   for n, component in ipairs(def) do
      local ok, err, reject = Components.try(component, true)

      if not ok then
         Utils.error(3 + errorLevel, "invalid component for %s at position #%d (%s)", filter, n, err)
      end

      if onComponent then
         onComponent(component, reject)
      end
   end
end

--- Parses the Filter Defintion into two tables
-- required: An array of all the required component names.
-- rejected: An array of all the components that will be rejected.
-- @string name Name for the Filter.
-- @tparam table definition Table containing the Filter Definition
-- @treturn table required
-- @treturn table rejected
function Filter.parse (name, def)
   local filter = {}

   Filter.validate(1, name, def, function (component, reject)
      if reject then
         table.insert(filter, reject)
         table.insert(filter, false)
      else
         table.insert(filter, component)
         table.insert(filter, true)
      end
   end)

   return filter
end

function Filter.match (e, filter)
   for i=#filter, 2, -2 do
      local match = filter[i - 0]
      local name  = filter[i - 1]

      if (not e[name]) == match then return false end
   end

   return true
end

local REQUIRED_METHODS = {"add", "remove", "has", "clear"}
local VALID_POOL_TYPES = {table=true, userdata=true, lightuserdata=true, cdata=true}

function Filter.isValidPool (name, pool)
   local poolType = type(pool)
   --Check that pool is not nil
   if not VALID_POOL_TYPES[poolType] then
      Utils.error(3, "invalid value returned by pool '%s' constructor (table expected, got %s).", name, type(pool))
   end

   --Check if methods are callables
   for _, method in ipairs(REQUIRED_METHODS) do
      if not Type.isCallable(pool[method]) then
         Utils.error(3, "invalid :%s method on pool '%s' (callable expected, got %s).", method, name, type(pool[method]))
      end
   end
end

--- Creates a new Filter
-- @string name Name for the Filter.
-- @tparam table definition Table containing the Filter Definition
-- @treturn Filter The new Filter
-- @treturn Pool The associated Pool
function Filter.new (name, def)
   local pool

   if def.constructor then
      pool = def.constructor(def)
      Filter.isValidPool(name, pool)
   else
      pool = List()
   end

   local filter = Filter.parse(name, def)

   local filter = setmetatable({
      pool = pool,

      __filter = filter,
      __name   = name,
   
      __isFilter = true,
   }, Filter.__mt)

   return filter, pool
end

--- Checks if an Entity fulfills the Filter requirements.
-- @tparam Entity e Entity to check
-- @treturn boolean
function Filter:eligible(e)
   return Filter.match(e, self.__filter)
end

function Filter:evaluate (e)
   local has  = self.pool:has(e)
   local eligible = self:eligible(e)

   if not has and eligible then
      self.pool:add(e)
   elseif has and not eligible then
      self.pool:remove(e)
   end

   return self
end


-- Adds an Entity to the Pool, if it passes the Filter.
-- @param e Entity to add
-- @param bypass Whether to bypass the Filter or not.
-- @treturn Filter self
-- @treturn boolean Whether the entity was added or not.
function Filter:add (e, bypass)
   if not bypass and not self:eligible(e) then
      return self, false
   end

   self.pool:add(e)

   return self, true
end

-- Remove an Entity from the Pool associated to this Filter.
-- @param e Entity to remove
-- @treturn Filter self
function Filter:remove (e)
   self.pool:remove(e)
   return self
end

-- Clear the Pool associated to this Filter.
-- @param e Entity to remove
-- @treturn Filter self
function Filter:clear (e)
   self.pool:clear(e)
   return self
end

-- Check if the Pool bound to this System contains the passed Entity
-- @param e Entity to check
-- @treturn boolean Whether the Entity exists.
function Filter:has (e)
   return self.pool:has(e)
end

--- Gets the name of the Filter
-- @treturn string
function Filter:getName()
   return self.__name
end

return setmetatable(Filter, {
  __call  = function(_, ...)
     return Filter.new(...)
  end,
})---
-- @module Concord

local PATH = (...):gsub('%.init$', '')

local Concord = {
   _VERSION     = "3.0",
   _DESCRIPTION = "A feature-complete ECS library",
   _LICENCE     = [[
      MIT LICENSE

      Copyright (c) 2020 Justin van der Leij / Tjakka5

      Permission is hereby granted, free of charge, to any person obtaining a
      copy of this software and associated documentation files (the
      "Software"), to deal in the Software without restriction, including
      without limitation the rights to use, copy, modify, merge, publish,
      distribute, sublicense, and/or sell copies of the Software, and to
      permit persons to whom the Software is furnished to do so, subject to
      the following conditions:

      The above copyright notice and this permission notice shall be included
      in all copies or substantial portions of the Software.

      THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
      OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
      MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
      IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
      CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
      TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
      SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
   ]]
}

Concord.entity     = require(PATH..".entity")
Concord.component  = require(PATH..".component")
Concord.components = require(PATH..".components")
Concord.system     = require(PATH..".system")
Concord.world      = require(PATH..".world")
Concord.utils      = require(PATH..".utils")

return Concord
--- Data structure that allows for fast removal at the cost of containing order.
-- @classmod List

local List = {}
List.__mt = {
   __index = List
}

--- Creates a new List.
-- @treturn List A new List
function List.new()
   return setmetatable({
      size = 0,
   }, List.__mt)
end

--- Adds an object to the List.
-- Object must be of reference type
-- Object may not be the string 'size', 'onAdded' or 'onRemoved'
-- @param obj Object to add
-- @treturn List self
function List:add(obj)
   local size = self.size + 1

   self[size] = obj
   self[obj]  = size
   self.size  = size

   if self.onAdded then self:onAdded(obj) end
   return self
end

--- Removes an object from the List.
-- @param obj Object to remove
-- @treturn List self
function List:remove(obj)
   local index = self[obj]
   if not index then return end
   local size  = self.size

   if index == size then
      self[size] = nil
   else
      local other = self[size]

      self[index] = other
      self[other] = index

      self[size] = nil
   end

   self[obj] = nil
   self.size = size - 1

   if self.onRemoved then self:onRemoved(obj) end
   return self
end

--- Clears the List completely.
-- @treturn List self
function List:clear()
   for i = 1, self.size do
      local o = self[i]

      self[o] = nil
      self[i] = nil
   end

   self.size = 0

   return self
end

--- Returns true if the List has the object.
-- @param obj Object to check for
-- @treturn boolean
function List:has(obj)
   return self[obj] and true or false
end

--- Returns the object at an index.
-- @number i Index to get from
-- @return Object at the index
function List:get(i)
   return self[i]
end

--- Returns the index of an object in the List.
-- @param obj Object to get index of
-- @treturn number index of object in the List.
function List:indexOf(obj)
   if (not self[obj]) then
      error("bad argument #1 to 'List:indexOf' (Object was not in List)", 2)
   end

   return self[obj]
end

--- Sorts the List in place, using the order function.
-- The order function is passed to table.sort internally so documentation on table.sort can be used as reference.
-- @param order Function that takes two Entities (a and b) and returns true if a should go before than b.
-- @treturn List self
function List:sort(order)
   table.sort(self, order)

   for key, obj in ipairs(self) do
      self[obj] = key
   end

   return self
end

--- Callback for when an item is added to the List.
-- @param obj Object that was added
function List:onAdded (obj) --luacheck: ignore
end

--- Callback for when an item is removed to the List.
-- @param obj Object that was removed
function List:onRemoved (obj) --luacheck: ignore
end

return setmetatable(List, {
   __call = function()
      return List.new()
   end,
})
--- Iterates over Entities. From these Entities its get Components and modify them.
-- A System contains 1 or more Pools.
-- A System is contained by 1 World.
-- @classmod System

local PATH = (...):gsub('%.[^%.]+$', '')

local Filter     = require(PATH..".filter")
local Utils      = require(PATH..".utils")

local System = {
   ENABLE_OPTIMIZATION = true,
}

System.mt = {
   __index = System,
   __call  = function(systemClass, world)
      local system = setmetatable({
         __enabled = true,

         __filters = {},
         __world = world,

         __isSystem = true,
         __isSystemClass = false, -- Overwrite value from systemClass
      }, systemClass)

      -- Optimization: We deep copy the System class into our instance of a system.
      -- This grants slightly faster access times at the cost of memory.
      -- Since there (generally) won't be many instances of worlds this is a worthwhile tradeoff
      if (System.ENABLE_OPTIMIZATION) then
         Utils.shallowCopy(systemClass, system)
      end

      for name, def in pairs(systemClass.__definition) do
         local filter, pool = Filter(name, Utils.shallowCopy(def, {}))

         system[name] = pool
         table.insert(system.__filters, filter)
      end

      system:init(world)

      return system
   end,
}
--- Creates a new SystemClass.
-- @param table filters A table containing filters (name = {components...})
-- @treturn System A new SystemClass
function System.new(definition)
   definition = definition or {}

   for name, def in pairs(definition) do
      if type(name) ~= 'string' then
         Utils.error(2, "invalid name for filter (string key expected, got %s)", type(name))
      end

      Filter.validate(0, name, def)
   end

   local systemClass = setmetatable({
      __definition = definition,

      __isSystemClass = true,
   }, System.mt)
   systemClass.__index = systemClass

   -- Optimization: We deep copy the World class into our instance of a world.
   -- This grants slightly faster access times at the cost of memory.
   -- Since there (generally) won't be many instances of worlds this is a worthwhile tradeoff
   if (System.ENABLE_OPTIMIZATION) then
      Utils.shallowCopy(System, systemClass)
   end

   return systemClass
end

-- Internal: Evaluates an Entity for all the System's Pools.
-- @param e The Entity to check
-- @treturn System self
function System:__evaluate(e)
   for _, filter in ipairs(self.__filters) do
      filter:evaluate(e)
   end

   return self
end

-- Internal: Removes an Entity from the System.
-- @param e The Entity to remove
-- @treturn System self
function System:__remove(e)
   for _, filter in ipairs(self.__filters) do
      if filter:has(e) then
         filter:remove(e)
      end
   end

   return self
end

-- Internal: Clears all Entities from the System.
-- @treturn System self
function System:__clear()
   for _, filter in ipairs(self.__filters) do
      filter:clear()
   end

   return self
end

--- Sets if the System is enabled
-- @tparam boolean enable
-- @treturn System self
function System:setEnabled(enable)
   if (not self.__enabled and enable) then
      self.__enabled = true
      self:onEnabled()
   elseif (self.__enabled and not enable) then
      self.__enabled = false
      self:onDisabled()
   end

   return self
end

--- Returns is the System is enabled
-- @treturn boolean
function System:isEnabled()
   return self.__enabled
end

--- Returns the World the System is in.
-- @treturn World
function System:getWorld()
   return self.__world
end

--- Callbacks
-- @section Callbacks

--- Callback for system initialization.
-- @tparam World world The World the System was added to
function System:init(world) -- luacheck: ignore
end

--- Callback for when a System is enabled.
function System:onEnabled() -- luacheck: ignore
end

--- Callback for when a System is disabled.
function System:onDisabled() -- luacheck: ignore
end

return setmetatable(System, {
   __call = function(_, ...)
      return System.new(...)
   end,
})
--- Type
-- Helper module to do easy type checking for Concord types

local Type = {}

function Type.isCallable(t)
   if type(t) == "function" then return true end

   local meta = getmetatable(t)
   if meta and type(meta.__call) == "function" then return true end

   return false
end

--- Returns if object is an Entity.
-- @param t Object to check
-- @treturn boolean
function Type.isEntity(t)
   return type(t) == "table" and t.__isEntity or false
end

--- Returns if object is a ComponentClass.
-- @param t Object to check
-- @treturn boolean
function Type.isComponentClass(t)
   return type(t) == "table" and t.__isComponentClass or false
end

--- Returns if object is a Component.
-- @param t Object to check
-- @treturn boolean
function Type.isComponent(t)
   return type(t) == "table" and t.__isComponent or false
end

--- Returns if object is a SystemClass.
-- @param t Object to check
-- @treturn boolean
function Type.isSystemClass(t)
   return type(t) == "table" and t.__isSystemClass or false
end

--- Returns if object is a System.
-- @param t Object to check
-- @treturn boolean
function Type.isSystem(t)
   return type(t) == "table" and t.__isSystem or false
end

--- Returns if object is a World.
-- @param t Object to check
-- @treturn boolean
function Type.isWorld(t)
   return type(t) == "table" and t.__isWorld or false
end

--- Returns if object is a Filter.
-- @param t Object to check
-- @treturn boolean
function Type.isFilter(t)
   return type(t) == "table" and t.__isFilter or false
end

return Type
--- Utils
-- Helper module for misc operations

local lfs = require('lfs')

local Utils = {}

function Utils.error(level, str, ...)
    error(string.format(str, ...), level + 1)
end

--- Does a shallow copy of a table and appends it to a target table.
-- @param orig Table to copy
-- @param target Table to append to
function Utils.shallowCopy(orig, target)
    for key, value in pairs(orig) do
        target[key] = value
    end

    return target
end

function Utils.isFile(path)
    local attr = lfs.attributes(path)
    return attr and attr.mode == "file"
end

function Utils.listDirectory(path)
    return lfs.dir(path)
end

function Utils.loadNamespace(pathOrFiles, namespace)
    namespace = namespace or {}

    if type(pathOrFiles) == "string" then
        local files = Utils.listDirectory(pathOrFiles)

        if not files then
            return
        end

        for _, file in ipairs(files) do
            local filePath = pathOrFiles .. "/" .. file

            if Utils.isFile(filePath) and file:match('%.lua$') then
                local name = file:sub(1, #file - 4)
                local path = pathOrFiles .. "." .. name

                local value = import(path:gsub("/", "."))
                if namespace then namespace[name] = value end
            end
        end
    elseif type(pathOrFiles) == "table" then
        for _, path in ipairs(pathOrFiles) do
            if type(path) ~= "string" then
                error(
                string.format(
                "bad argument #2 to 'loadNamespace' (string/table of strings expected, got table containing %s)",
                    type(path)), 2)
            end

            local name = path

            local dotIndex, slashIndex = path:match("^.*()%."), path:match("^.*()%/")
            if dotIndex or slashIndex then
                name = path:sub((dotIndex or slashIndex) + 1)
            end

            local value = require(path:gsub("/", "."))
            if namespace then namespace[name] = value end
        end
    end

    return namespace
end

return Utils
--- A collection of Systems and Entities.
-- A world emits to let Systems iterate.
-- A World contains any amount of Systems.
-- A World contains any amount of Entities.
-- @classmod World

local PATH = (...):gsub('%.[^%.]+$', '')

local Filter     = require(PATH..".filter")
local Entity     = require(PATH..".entity")
local Components = require(PATH..".components")
local Type       = require(PATH..".type")
local List       = require(PATH..".list")
local Utils      = require(PATH..".utils")

local World = {
   ENABLE_OPTIMIZATION = true,
}
World.__mt = {
   __index = World,
}

local defaultGenerator = function (state)
   local current = state
   state = state +1
   return string.format("%d", current), state
end

--- Creates a new World.
-- @treturn World The new World
function World.new()
   local world = setmetatable({
      __entities = List(),
      __systems  = List(),

      __events     = {},
      __emitSDepth = 0,

      __resources = {},

      __hash = {
         state = -2^53,
         generator = defaultGenerator,
         keys = {},
         entities = {}
      },

      __added   = List(), __backAdded   = List(),
      __removed = List(), __backRemoved = List(),
      __dirty   = List(), __backDirty   = List(),

      __systemLookup = {},

      __isWorld = true,

      __ignoreEmits = false
   }, World.__mt)

   -- Optimization: We deep copy the World class into our instance of a world.
   -- This grants slightly faster access times at the cost of memory.
   -- Since there (generally) won't be many instances of worlds this is a worthwhile tradeoff
   if (World.ENABLE_OPTIMIZATION) then
      Utils.shallowCopy(World, world)
   end

   return world
end

--- Adds an Entity to the World.
-- @tparam Entity e Entity to add
-- @treturn World self
function World:addEntity(e)
   if not Type.isEntity(e) then
      Utils.error(2, "bad argument #1 to 'World:addEntity' (Entity expected, got %s)", type(e))
   end

   if e.__world then
      error("bad argument #1 to 'World:addEntity' (Entity was already added to a world)", 2)
   end

   e.__world = self
   self.__added:add(e)

   return self
end

--- Creates a new Entity and adds it to the World.
-- @treturn Entity e the new Entity
function World:newEntity()
   return Entity(self)
end

function World:query(def, onMatch)
   local filter = Filter.parse(nil, def)

   local list = nil
   if not Type.isCallable(onMatch) then
      list = type(onMatch) == "table" and onMatch or {}
   end

   for _, e in ipairs(self.__entities) do
      if Filter.match(e, filter) then
         if list then
            table.insert(list, e)
         else
            onMatch(e)
         end
      end
   end

   return list
end

--- Removes an Entity from the World.
-- @tparam Entity e Entity to remove
-- @treturn World self
function World:removeEntity(e)
   if not Type.isEntity(e) then
      Utils.error(2, "bad argument #1 to 'World:removeEntity' (Entity expected, got %s)", type(e))
   end

   if e.__world ~= self then
      error("trying to remove an Entity from a World it doesn't belong to", 2)
   end

   if e:has("key") then
      e:remove("key")
   end

   self.__removed:add(e)

   return self
end

-- Internal: Marks an Entity as dirty.
-- @param e Entity to mark as dirty
function World:__dirtyEntity(e)
   if not self.__dirty:has(e) then
      self.__dirty:add(e)
   end
end

-- Internal: Flushes all changes to Entities.
-- This processes all entities. Adding and removing entities, as well as reevaluating dirty entities.
-- @treturn World self
function World:__flush()
   -- Early out
   if (self.__added.size == 0 and self.__removed.size == 0 and self.__dirty.size == 0) then
      return self
   end

   -- Switch buffers
   self.__added,   self.__backAdded   = self.__backAdded,   self.__added
   self.__removed, self.__backRemoved = self.__backRemoved, self.__removed
   self.__dirty,   self.__backDirty   = self.__backDirty,   self.__dirty

   local e

   -- Process added entities
   for i = 1, self.__backAdded.size do
      e = self.__backAdded[i]

      if e.__world == self then
         self.__entities:add(e)

         for j = 1, self.__systems.size do
            self.__systems[j]:__evaluate(e)
         end

         self:onEntityAdded(e)
      end
   end
   self.__backAdded:clear()

   -- Process removed entities
   for i = 1, self.__backRemoved.size do
      e = self.__backRemoved[i]

      if e.__world == self then
         e.__world = nil
         self.__entities:remove(e)

         for j = 1, self.__systems.size do
            self.__systems[j]:__remove(e)
         end

         self:onEntityRemoved(e)
      end
   end
   self.__backRemoved:clear()

   -- Process dirty entities
   for i = 1, self.__backDirty.size do
      e = self.__backDirty[i]

      if e.__world == self then
         for j = 1, self.__systems.size do
            self.__systems[j]:__evaluate(e)
         end
      end
   end
   self.__backDirty:clear()

   return self
end

-- These functions won't be seen as callbacks that will be emitted to.
local blacklistedSystemFunctions = {
   "init",
   "onEnabled",
   "onDisabled",
}

local tryAddSystem = function (world, systemClass)
   if (not Type.isSystemClass(systemClass)) then
      return false, "SystemClass expected, got "..type(systemClass)
   end

   if (world.__systemLookup[systemClass]) then
      return false, "SystemClass was already added to World"
   end

   -- Create instance of system
   local system = systemClass(world)

   world.__systemLookup[systemClass] = system
   world.__systems:add(system)

   for callbackName, callback in pairs(systemClass) do
      -- Skip callback if its blacklisted
      if (not blacklistedSystemFunctions[callbackName]) then
         -- Make container for all listeners of the callback if it does not exist yet
         if (not world.__events[callbackName]) then
            world.__events[callbackName] = {}
         end

         -- Add callback to listeners
         local listeners = world.__events[callbackName]
         listeners[#listeners + 1] = {
            system   = system,
            callback = callback,
         }
      end
   end

   -- Evaluate all existing entities
   for j = 1, world.__entities.size do
      system:__evaluate(world.__entities[j])
   end

   return true
end

--- Adds a System to the World.
-- Callbacks are registered automatically
-- Entities added before are added to the System retroactively
-- @see World:emit
-- @tparam System systemClass SystemClass of System to add
-- @treturn World self
function World:addSystem(systemClass)
   local ok, err = tryAddSystem(self, systemClass)

   if not ok then
      Utils.error(2, "bad argument #1 to 'World:addSystem' (%s)", err)
   end

   return self
end

--- Adds multiple Systems to the World.
-- Callbacks are registered automatically
-- @see World:addSystem
-- @see World:emit
-- @param ... SystemClasses of Systems to add
-- @treturn World self
function World:addSystems(...)
   for i = 1, select("#", ...) do
      local systemClass = select(i, ...)

      local ok, err = tryAddSystem(self, systemClass)
      if not ok then
         Utils.error(2, "bad argument #%d to 'World:addSystems' (%s)", i, err)
      end
   end

   return self
end

--- Returns if the World has a System.
-- @tparam System systemClass SystemClass of System to check for
-- @treturn boolean
function World:hasSystem(systemClass)
   if not Type.isSystemClass(systemClass) then
      Utils.error(2, "bad argument #1 to 'World:hasSystem' (SystemClass expected, got %s)", type(systemClass))
   end

   return self.__systemLookup[systemClass] and true or false
end

--- Gets a System from the World.
-- @tparam System systemClass SystemClass of System to get
-- @treturn System System to get
function World:getSystem(systemClass)
   if not Type.isSystemClass(systemClass) then
      Utils.error(2, "bad argument #1 to 'World:getSystem' (SystemClass expected, got %s)", type(systemClass))
   end

   return self.__systemLookup[systemClass]
end

--- Emits a callback in the World.
-- Calls all functions with the functionName of added Systems
-- @string functionName Name of functions to call.
-- @param ... Parameters passed to System's functions
-- @treturn World self
function World:emit(functionName, ...)
   if not functionName or type(functionName) ~= "string" then
      Utils.error(2, "bad argument #1 to 'World:emit' (String expected, got %s)", type(functionName))
   end

   local shouldFlush = self.__emitSDepth == 0

   self.__emitSDepth = self.__emitSDepth + 1

   local listeners = self.__events[functionName]

   if not self.__ignoreEmits and Type.isCallable(self.beforeEmit) then
      self.__ignoreEmits = true
      local preventDefaults = self:beforeEmit(functionName, listeners, ...)
      self.__ignoreEmits = false
      if preventDefaults then return end
   end

   if listeners then
      for i = 1, #listeners do
         local listener = listeners[i]

         if (listener.system.__enabled) then
            if (shouldFlush) then
               self:__flush()
            end

            listener.callback(listener.system, ...)
         end
      end
   end

   if not self.__ignoreEmits and Type.isCallable(self.afterEmit) then
      self.__ignoreEmits = true
      self:afterEmit(functionName, listeners, ...)
      self.__ignoreEmits = false
   end

   self.__emitSDepth = self.__emitSDepth - 1

   return self
end

--- Removes all entities from the World
-- @treturn World self
function World:clear()
   for i = 1, self.__entities.size do
      self:removeEntity(self.__entities[i])
   end

   for i = 1, self.__added.size do
      local e = self.__added[i]
      e.__world = nil
   end
   self.__added:clear()

   self:__flush()

   return self
end

function World:getEntities()
   return self.__entities
end

function World:getSystems()
   return self.__systems
end

function World:serialize(ignoreKeys)
   self:__flush()

   local data = { generator = self.__hash.state }

   for i = 1, self.__entities.size do
      local entity = self.__entities[i]

      if entity.serializable then
         local entityData = entity:serialize(ignoreKeys)
         table.insert(data, entityData)
      end
   end

   return data
end

function World:deserialize(data, startClean, ignoreGenerator)
   if startClean then
      self:clear()
   end

   if (not ignoreGenerator) then
      self.__hash.state = data.generator
   end

   local entities = {}

   for i = 1, #data do
      local entity = Entity(self)

      if data[i].key then
         local component = Components.key:__new(entity)
         component:deserialize(data[i].key)
         entity.key = component

         entity:__dirty()
      end

      entities[i] = entity
   end

   for i = 1, #data do
      entities[i]:deserialize(data[i])
   end

   self:__flush()

   return self
end

function World:setKeyGenerator(generator, initialState)
   if not Type.isCallable(generator) then
      Utils.error(2, "bad argument #1 to 'World:setKeyGenerator' (function expected, got %s)", type(generator))
   end

   self.__hash.generator = generator
   self.__hash.state = initialState

   return self
end

function World:__clearKey(e)
   local key = self.__hash.keys[e]

   if key then
      self.__hash.keys[e] = nil
      self.__hash.entities[key] = nil
   end

   return self
end

function World:__assignKey(e, key)
   local hash = self.__hash

   if not key then
      key = hash.keys[e]
      if key then return key end

      key, hash.state = hash.generator(hash.state)
   end

   if hash.entities[key] and hash.entities[key] ~= e then
      Utils.error(4, "Trying to assign a key that is already taken (key: '%s').", key)
   elseif hash.keys[e] and hash.keys[e] ~= key then
      Utils.error(4, "Trying to assign more than one key to an Entity. (old: '%s', new: '%s')", hash.keys[e], key)
   end

   hash.keys[e] = key
   hash.entities[key] = e

   return key
end

function World:getEntityByKey(key)
   return self.__hash.entities[key]
end

--- Callback for when an Entity is added to the World.
-- @tparam Entity e The Entity that was added
function World:onEntityAdded(e) -- luacheck: ignore
end

--- Callback for when an Entity is removed from the World.
-- @tparam Entity e The Entity that was removed
function World:onEntityRemoved(e) -- luacheck: ignore
end

--- Sets a named resource in the world
-- @string name Name of the resource
-- @tparam Any resource Resource to set
-- @treturn World self
function World:setResource(name, resource)
  self.__resources[name] = resource
  return self
end

--- Gets a named resource from the world
-- @string name Name of the resource
-- @treturn Any resource
function World:getResource(name)
  return self.__resources[name]
end

return setmetatable(World, {
   __call = function(_, ...)
      ---@diagnostic disable-next-line: redundant-parameter
      return World.new(...)
   end,
})
---@meta game-engine

--------------------------------------------------------------------------------
--- Engine
--------------------------------------------------------------------------------
---
---Registers Lua function to an engine hook
---@param hook_name string The hook being registered to
---@param function_ref function The function being registered
---
function RegisterFunction(hook_name, function_ref) end

---
---Sets the value of the master volume and notifies event listeners
---@param master_volume number Value from 0 to 1
---
function Engine_SetMasterVolume(master_volume) end

---
---Returns the canvas width of the game window
---@return integer
---
function Engine_GetWidth() end

---
---Returns the canvas height of the game window
---@return integer
---
function Engine_GetHeight() end

---
---Runs hook with string name if it exists and is registered
---@param hook_name string The name of the hook being run
---
function Engine_RunHook(hook_name) end

---
---Initializes resource group
---@param group integer Group to initialize
---
function Engine_ResourceGroup_Init(group) end

---
---Frees resource group from memory
---@param group integer Group to free
---
function Engine_ResourceGroup_Free(group) end

---
---Unloads resources in resource group
---@param group integer Group to clear
---
function Engine_ResourceGroup_Clear(group) end

---
---Load and switch to current scene from dynamic library file.
---Cleanup functions are run for previous scene, and the init
---function is run on startup of new scene.
---@param new_scene_path string Path to new scene dynamic library file
---
function Engine_Scene_Switch(new_scene_path) end

---
---Load and switch to current scene from Lua mod file.
---Cleanup functions are run for previous scene, and the init
---function is run on startup of new scene.
---@param scene_name string Name of Lua mod scene
---
function Engine_Mod_Scene_Switch(scene_name) end

---
---Load an asset to resources.
---@param resource_path string Path to asset
---@param group integer Resource group to load to
---@return string | Texture2D | Sound | boolean
---
function Engine_LoadResource(resource_path, group) end

---
---Load an asset texture from resources.
---@param id integer Asset id of texture to load
---@return Texture2D
---
function Engine_LoadTexture2D(id) end

---
---Registers to listen for when events are sent with the provided code.
---Events with duplicate listener/callback combos will not be registered
---again and will cause this to return false.
---@param type string The event code to listen for.
---@param listener string|nil A listener instance. Can be nil.
---@param on_event function The callback function to be invoked when the event code is fired.
---@return boolean True if the event is successfully registered; otherwise false.
---
function event_register(type, listener, on_event) end

---
---Unregister from listening for when events are sent with the provided code. If no matching
---registration is found, this function returns false.
---again and will cause this to return false.
---@param type string The event code to stop listening for.
---@param listener string|nil A listener instance. Can be nil.
---@param on_event function The callback function to be unregistered.
---@return boolean True if the event is successfully unregistered; otherwise false.
---
function event_unregister(type, listener, on_event) end

---
---Fires an event to listeners of the given code. If an event handler returns
---true, the event is considered handled and is not passed on to any more listeners.
---@param type string The event code to listen for.
---@param sender string|nil A sender instance. Can be nil.
---@return boolean True if handled, otherwise false.
---
function event_fire(type, sender) end

---@alias audio_group_t userdata

---
---Returns pointer to an engine initialized audio group given an index.
---@param index integer Index of audio group.
---@return audio_group_t Pointer to an audio group initialized by the engine.
---
function audio_group_get(index) end

---
---Add sound to audio group.
---@param group audio_group_t Pointer to an audio group.
---@param sound Sound Pointer to a Sound.
---
function audio_group_add_sound(group, sound) end

---
---Remove sound from audio group.
---@param group audio_group_t Pointer to an audio group.
---@param sound Sound Pointer to a Sound.
---
function audio_group_remove_sound(group, sound) end

---
---Get volume of an audio group.
---@param group audio_group_t Pointer to an audio group.
---@return number Volume of audio group.
---
function audio_group_get_volume(group) end

---
---Set volume of an audio group.
---@param group audio_group_t Pointer to an audio group.
---@param volume number Value from 0 to 1.
---
function audio_group_set_volume(group, volume) end

---
---Emscripten function to return all files and folders in a directory
---@param path string Path to directory to read
---
function EMSCRIPTEN_readdir(path) end

---
---Function to check if the given path is a file or a directory
---@param path string Path to directory to check
---
function engine_is_file_or_directory(path) end

---
---Returns current mouse position
---@return Vector2
---
function mouse_pos() end

EMSCRIPTEN = EMSCRIPTEN or false
WIN32 = WIN32 or false
-- modified from the following repository
-- https://github.com/yogeshlonkar/lua-import

local lfs = require("lfs")

local import_lua_dir = debug.getinfo(1, 'S').source:sub(2):match('(.*)' .. (...):gsub('%.', '/') .. '.lua')

---Function to check if a path is a directory
--
---@param path string to be checked
---@return boolean
local function is_directory(path)
  local attr = lfs.attributes(path)
  return attr and attr.mode == "directory"
end

---Converts a path relative to the current directory to realpath relative to root.
--
---@param path string to be resolved
---@param __dirname string of calling script
---@return string
local function resolve_relative(path, __dirname)
  if path:match('^%.%./') then
    local trimmed_path, up_count = path:gsub('%.%./', '')
    local segments = {}
    for str in __dirname:gmatch('([^/]+)') do table.insert(segments, str) end
    for _ = 1, up_count do table.remove(segments) end
    if #segments == 0 then return trimmed_path end
    if #segments == 1 and segments[1] == '' then return trimmed_path end
    if __dirname:match('^/') then table.insert(segments, 1, '') end
    return table.concat(segments, '/') .. '/' .. trimmed_path
  end
  -- when path is relative to current directory
  if path:match('^%./') then return __dirname .. path:gsub('^%./', '') end
  -- when path is doesn't have any relative path
  if path:match('%.') and not path:match('/') then return path end
  -- when path is not relative and contains prefix of __dirname
  if not path:match('%.') and path:match('/') then
    if path:match(__dirname) then return path end
    if path:match(__dirname:gsub('%./', '')) then return path end
  end
  return __dirname .. path
end

---Converts a path to a require argument.
--
---@param path any
---@return string
local function to_require_arg(path) return path:gsub('^%./', ''):gsub('/$', ''):gsub('/', '.') end

---Removes the common root from a string.
---This is the magic method to work when debug.getinfo returns absolute path.
--
---@param s string
---@return string
local function normalise_path(s)
  local to_trim_index = -1
  for i = 1, #import_lua_dir do
    if i > #s then break end
    if s:sub(i, i) == import_lua_dir:sub(i, i) then
      to_trim_index = i
    else
      break
    end
  end
  local to_trim = ''
  if to_trim_index > -1 then to_trim = s:sub(1, to_trim_index) end
  local to_return = s:gsub(to_trim, '')
  return to_return
end

-- Function to convert Windows paths to Unix paths and remove drive letter
local function convert_windows_to_unix_path(win_path)
  -- Convert backslashes to forward slashes
  local unix_path = win_path:gsub("\\", "/")
  -- Remove the drive letter (e.g., "C:/") if present
  unix_path = unix_path:gsub("^%a:/", "/")
  return unix_path
end

local function convert_unix_to_windows_path(unix_path)
  -- If the path starts with '/', it's an absolute Unix path
  if unix_path:sub(1, 1) == "/" then
    return "Z:" .. unix_path
  else
    -- Handle relative paths (if needed)
    return unix_path
  end
end

---The lua-import module provides a function',
---the function takes single single string argument which is a glob pattern.
---The return value is the module refered by the glob pattern.
--
---@param path any
---@return unknown
function import(path)
  if (EMSCRIPTEN) then
    local __dirname = debug.getinfo(2, 'S').source:sub(2):match('(.*' .. '/' .. ')')
    local resolved_path = resolve_relative(path, __dirname)

    if (is_directory(resolved_path)) then
      resolved_path = resolved_path .. "/init"
    end
    resolved_path = lfs.normalize_slashes(resolved_path)

    local require_arg = to_require_arg(resolved_path)
    return require(require_arg)
  end

  local debug_path = debug.getinfo(2, 'S').source:sub(2)
  local __dirname
  if debug_path:find('\\') then
    debug_path = convert_windows_to_unix_path(debug_path)
  end
  __dirname = debug_path:match('(.*' .. '/' .. ')')
  __dirname = lfs.normalize_slashes(__dirname)

  if (WIN32) then
    __dirname = convert_unix_to_windows_path(__dirname)
  end
  local resolved_path = resolve_relative(path, __dirname)
  resolved_path = lfs.normalize_slashes(resolved_path)

  if (is_directory(resolved_path)) then
    resolved_path = resolved_path .. "/init"
  end
  local normal_path = normalise_path(resolved_path)
  if (WIN32) then
    normal_path = lfs.backNormalizePath(normal_path)
  end
  local require_arg = to_require_arg(normal_path)
  -- print('import_lua_dir: ' .. import_lua_dir)
  -- print('path: ' .. path)
  -- print('__dirname: ' .. __dirname)
  -- print('resolved_path: ' .. resolved_path)
  -- print('normal_path: ' .. normal_path)
  -- print('require_arg: ' .. require_arg)
  return require(require_arg)
end

print('import_lua_dir: ' .. import_lua_dir)

return import
-- Helper function definitions
local cwd = function()
  local info = debug.getinfo(1, "S")
  if info and info.source then
    local path = info.source:gsub("^[@=]", "")
    return path:match("^(.*[\\/])")
  end
  return nil
end

package.path = package.path .. ";" .. cwd() .. "?/init.lua"
package.path = package.path .. ";" .. cwd() .. "?.lua"
package.path = package.path .. ";" .. "?.lua"

require('import')

-- Includes
require("logging")
require("game-engine")
require("raylib")
require("nuklear")
require("rtc_handler")
require("animation")
ECS = require("concord")
local lfs = {}

function lfs.normalize_slashes(path)
    -- Replace multiple slashes with a single slash
    return path:gsub("//+", "/")
end

function lfs.remove_drive_from_path(path)
    -- Match and remove the drive letter pattern followed by a colon
    local cleaned_path = path:gsub("^[A-Za-z]:\\", "/")
    return cleaned_path
end

function lfs.trimRootPath(root, absolute)
    -- Ensure both root and absolute paths end with a slash for consistent processing
    if root:sub(-1) ~= '/' then
        root = root .. '/'
    end

    -- Check if the absolute path starts with the root path
    if absolute:sub(1, #root) == root then
        -- Remove the root path from the absolute path
        return absolute:sub(#root + 1)
    else
        -- If the absolute path does not start with the root path, return nil or handle error
        return '', "The absolute path does not start with the root path."
    end
end

function lfs.normalizePath(path)
    -- path = lfs.remove_drive_from_path(path)
    -- Replace backslashes with forward slashes
    local normalizedPath = path:gsub("\\", "/")
    return normalizedPath
end

function lfs.backNormalizePath(path)
    -- Replace backslashes with forward slashes
    local normalizedPath = path:gsub("/", "\\")
    return normalizedPath
end

local is_file_or_directory_posix = function(path)
    local file_check_cmd = "test -f '" .. path .. "' && echo file || echo not_file"
    local dir_check_cmd = "test -d '" .. path .. "' && echo directory || echo not_directory"

    local file_handle = io.popen(file_check_cmd)
    if file_handle == nil then
        return "error"
    end

    local file_result = file_handle:read("*a")
    file_handle:close()

    local dir_handle = io.popen(dir_check_cmd)
    if dir_handle == nil then
        return "error"
    end

    local dir_result = dir_handle:read("*a")
    dir_handle:close()

    file_result = file_result:gsub("%s+", "")
    dir_result = dir_result:gsub("%s+", "")

    if file_result == "file" then
        return "file"
    elseif dir_result == "directory" then
        return "directory"
    else
        return "unknown"
    end
end

local is_file_or_directory_windows = function(path)
    local check_cmd = 'if exist "' ..
    path .. '\\*" (echo directory) else (if exist "' .. path .. '" (echo file) else (echo unknown))'

    local handle = io.popen("cmd /c " .. check_cmd)
    if handle == nil then
        return "error"
    end

    local result = handle:read("*a")
    handle:close()

    result = result:gsub("%s+", "")

    if result == "file" then
        return "file"
    elseif result == "directory" then
        return "directory"
    else
        return "unknown"
    end
end

function lfs.dir(path)
    path = lfs.normalizePath(path)
    -- path = trimRootPath(path)
    if not EMSCRIPTEN and not WIN32 then
        local p = io.popen('ls "' .. path .. '"')

        if not p then
            return
        end

        local files = {}
        for file in p:lines() do
            table.insert(files, file)
        end

        p:close()
        return files
    elseif WIN32 then
        local cmd = 'dir "' .. lfs.backNormalizePath(path) .. '" /A /B'
        local p = io.popen(cmd)
        if not p then
            return
        end

        local files = {}
        for file in p:lines() do
            table.insert(files, file)
        end

        p:close()
        return files
    elseif EMSCRIPTEN then
        local p = EMSCRIPTEN_readdir(path)

        if not p then
            return
        end

        local files = {}
        for _, file in ipairs(p) do
            table.insert(files, file)
        end

        return files
    end
end

function lfs.attributes(path)
    local ret = {}

    ret.mode = engine_is_file_or_directory(path)

    return ret
end

return lfs
---@meta game-engine

--------------------------------------------------------------------------------
--- Engine
--------------------------------------------------------------------------------
---
---Log with level debug
---@param str string Formatted string to log
---
function L_DEBUG(str) end

---
---Log with level info
---@param str string Formatted string to log
---
function L_INFO(str) end

---
---Log with level notice
---@param str string Formatted string to log
---
function L_NOTICE(str) end

---
---Log with level warn
---@param str string Formatted string to log
---
function L_WARN(str) end

---
---Log with level error
---@param str string Formatted string to log
---
function L_ERROR(str) end

---
---Log with level fatal
---@param str string Formatted string to log
---
function L_FATAL(str) end
---@meta nuklear

--------------------------------------------------------------------------------
--- Metatable definitions
--------------------------------------------------------------------------------
---
---Rectangle class for nuklear
---@class nk_rect
---@field x number Rectangle x coordinate
---@field y number Rectangle y coordinate
---@field w number Rectangle width
---@field h number Rectangle height
---
nk_rect = {}
nk_rect.__index = nk_rect

---
---Constructor function to create a new nk_rect object
---@param x number Rectangle x coordinate
---@param y number Rectangle y coordinate
---@param w number Rectangle width
---@param h number Rectangle height
---
function nk_rect.new(x, y, w, h)
    local self = setmetatable({}, nk_rect)
    self.x = x
    self.y = y
    self.w = w
    self.h = h
    return self
end

---
---Two dimensional vector class for nuklear
---@class nk_vec2
---@field x number Vector x coordinate
---@field y number Vector y coordinate
---
nk_vec2 = {}
nk_vec2.__index = nk_vec2

---
---Constructor function to create a new nk_vec2 object
---@param x number Vector x coordinate
---@param y number Vector y coordinate
---@return nk_vec2
---
function nk_vec2.new(x, y)
    local self = setmetatable({}, nk_vec2)
    self.x = x
    self.y = y
    return self
end

--------------------------------------------------------------------------------
--- Constants
--------------------------------------------------------------------------------
---NK window flags
NK = {}
NK.WINDOW_BORDER = nil
NK.WINDOW_MOVABLE = nil
NK.WINDOW_SCALABLE = nil
NK.WINDOW_CLOSABLE = nil
NK.WINDOW_CLOSABLE = nil
NK.WINDOW_MINIMIZABLE = nil
NK.WINDOW_NO_SCROLLBAR = nil
NK.WINDOW_TITLE = nil
NK.WINDOW_SCROLL_AUTO_HIDE = nil
NK.WINDOW_BACKGROUND = nil
NK.WINDOW_SCALE_LEFT = nil
NK.WINDOW_NO_INPUT = nil

--------------------------------------------------------------------------------
--- Nuklear
--------------------------------------------------------------------------------
---
---Function to start nuklear drawing mode
---@param title string Title of nuklear window
---@param bounds nk_rect Boundaries of nuklear window
---@param flags integer Bitmask of flags
---@return boolean True if successful, false otherwise
---
function nk_begin(title, bounds, flags) end

---
---Function to end nuklear drawing mode
---
function nk_end() end

---
---Function to add a static row to layout
---@param height integer Height of row
---@param item_width integer Width of items in row
---@param cols integer Number of columns in row
---
function nk_layout_row_static(height, item_width, cols) end

---
---Function to add a dynamic row to layout
---@param height integer Height of row
---@param cols integer Number of columns in row
---
function nk_layout_row_dynamic(height, cols) end

---
---Function to add button with label
---@param title string Label of button
---@return boolean True if pressed, false otherwise
---
function nk_button_label(title) end

---
---Function to add option with label
---@param title string Label of option
---@param active boolean True if the option is selected, false otherwise
---@return boolean True if option is pressed, false otherwise
---
function nk_option_label(title, active) end

---
---Function to add property with integer values
---@param name string Name of property
---@param min integer Minimum value of property
---@param val integer Current value of property
---@param max integer Maximum value of property
---@param step integer Amount to change with step buttons
---@param inc_per_pixel integer Amount to change per pixel
---@return integer Integer value of the property
---
function nk_property_int(name, min, val, max, step, inc_per_pixel) end

---
---Function to add label
---@param title string Label string
---@param align integer Alignment option
---
function nk_label(title, align) end

---
---Function to get width of current nuklear window
---@return number Width of window
---
function nk_window_get_width() end

---
---Function to get height of current nuklear window
---@return number Height of window
---
function nk_window_get_height() end

---
---Function to get width of current nuklear widget
---@return number Width of widget
---
function nk_widget_width() end

---
---Function to start drawing mode for color picker dropdown
---@param raylib_color Color Value of color changed
---@param size nk_vec2 Size of dropdown window
---@return boolean True if successful, false otherwise
---
function nk_combo_begin_color(raylib_color, size) end

---
---Function to end combo drawing mode
---
function nk_combo_end() end

---
---Function to end combo drawing mode
---@param raylib_color Color Initial color value
---@param colorformat integer Color format option
---@return Color New color value
---
function nk_color_picker(raylib_color, colorformat) end

---
---Function to add property with float values
---@param name string Name of property
---@param min number Minimum value of property
---@param val number Current value of property
---@param max number Maximum value of property
---@param step number Amount to change with step buttons
---@param inc_per_pixel number Amount to change per pixel
---@return number Float value of property
---
function nk_propertyf(name, min, val, max, step, inc_per_pixel) end

---
---Function to set current context style to default style
---
function nk_style_default() end

---
---Function to set current context style from color table
---@param table { [string]: Color }
---
function nk_style_from_table(table) end

function nk_group_begin(name, flags) end
function nk_group_end() end
function nk_group_get_scroll(name) end
function nk_group_set_scroll(name, x_offset, y_offset) end
function nk_edit_get_cursor() end
function nk_edit_set_cursor(cursor) end
function nk_edit_string_zero_terminated(flags, buffer_table, max) end
function nk_input_is_key_pressed(key_enum) end
---@meta raylib

--------------------------------------------------------------------------------
--- Metatable definitions
--------------------------------------------------------------------------------
---
---Color class representing an RGBA color.
---@class Color
---@field r integer The red component of the color (0-255).
---@field g integer The green component of the color (0-255).
---@field b integer The blue component of the color (0-255).
---@field a integer The alpha component of the color (0-255).
---
Color = {}
Color.__index = Color

---
---Constructor function to create a new Color object
---@param red integer The red component of the color (0-255).
---@param green integer The green component of the color (0-255).
---@param blue integer The blue component of the color (0-255).
---@param alpha integer The alpha component of the color (0-255).
---@return Color
---
function Color.new(red, green, blue, alpha)
    local self = setmetatable({}, Color)
    self.r = red or 0
    self.g = green or 0
    self.b = blue or 0
    self.a = alpha or 255
    return self
end

---
---Custom tostring method for Color objects
---@return string
---
function Color:__tostring()
    return string.format("Color(R:%d, G:%d, B:%d, A:%d)", self.r, self.g, self.b, self.a)
end

-- Default colors
Color.LIGHTGRAY   = Color.new(200, 200, 200, 255)
Color.GRAY        = Color.new(130, 130, 130, 255)
Color.DARKGRAY    = Color.new(80, 80, 80, 255)
Color.YELLOW      = Color.new(253, 249, 0, 255)
Color.GOLD        = Color.new(255, 203, 0, 255)
Color.ORANGE      = Color.new(255, 161, 0, 255)
Color.PINK        = Color.new(255, 109, 194, 255)
Color.RED         = Color.new(230, 41, 55, 255)
Color.MAROON      = Color.new(190, 33, 55, 255)
Color.GREEN       = Color.new(0, 228, 48, 255)
Color.LIME        = Color.new(0, 158, 47, 255)
Color.DARKGREEN   = Color.new(0, 117, 44, 255)
Color.SKYBLUE     = Color.new(102, 191, 255, 255)
Color.BLUE        = Color.new(0, 121, 241, 255)
Color.DARKBLUE    = Color.new(0, 82, 172, 255)
Color.PURPLE      = Color.new(200, 122, 255, 255)
Color.VIOLET      = Color.new(135, 60, 190, 255)
Color.DARKPURPLE  = Color.new(112, 31, 126, 255)
Color.BEIGE       = Color.new(211, 176, 131, 255)
Color.BROWN       = Color.new(127, 106, 79, 255)
Color.DARKBROWN   = Color.new(76, 63, 47, 255)
Color.WHITE       = Color.new(255, 255, 255, 255)
Color.BLACK       = Color.new(0, 0, 0, 255)
Color.BLANK       = Color.new(0, 0, 0, 0)
Color.MAGENTA     = Color.new(255, 0, 255, 255)
Color.RAYWHITE    = Color.new(245, 245, 245, 255)

---
---Texture2D class that holds information about a loaded texture in memory.
---@class Texture2D
---@field id integer OpenGL texture id
---@field width integer Texture2D base width
---@field height integer Texture2D base height
---@field mipmaps integer Mipmap levels, 1 by default
---@field format integer Data format (PixelFormat type)
---
Texture2D         = {}
Texture2D.__index = Texture2D

---
---Constructor function to create a new Texture2D object
---@param id integer OpenGL texture id
---@param width integer Texture2D base width
---@param height integer Texture2D base height
---@param mipmaps integer Mipmap levels, 1 by default
---@param format integer Data format (PixelFormat type)
---@return Texture2D
---
function Texture2D.new(id, width, height, mipmaps, format)
    local self = setmetatable({}, Texture2D)
    self.id = id or 0
    self.width = width or 0
    self.height = height or 0
    self.mipmaps = mipmaps or 0
    self.format = format or 0
    return self
end

---
---Rectangle class that holds information about a rectangle in raylib
---@class Rectangle
---@field x number Rectangle top-left corner position x
---@field y number Rectangle top-left corner position y
---@field width number Rectangle width
---@field height number Rectangle height
---
Rectangle = {}
Rectangle.__index = Rectangle

---
---Constuctor function to create a new Rectangle object
---@param x number Rectangle top-left corner position x
---@param y number Rectangle top-left corner position y
---@param width number Rectangle width
---@param height number Rectangle height
---@return Rectangle
---
function Rectangle.new(x, y, width, height)
    local self = setmetatable({}, Rectangle)
    self.x = x
    self.y = y
    self.width = width
    self.height = height
    return self
end

---
---Vector2 class that holds information about a two dimensional vector
---@class Vector2
---@field x number Vector x component
---@field y number Vector y component
---
Vector2 = {}
Vector2.__index = Vector2

---
---Vector2 equality override
---@param a Vector2
---@param b Vector2
---@return boolean
---
Vector2.__eq = function(a, b)
    return a.x == b.x and a.y == b.y
end

---
---Constructor function to create a new Vector2 object
---@param x number Vector x component
---@param y number Vector y component
---@return Vector2
---
function Vector2.new(x, y)
    local self = setmetatable({}, Vector2)
    self.x = x
    self.y = y
    return self
end

-- Default vectors
Vector2.zero = Vector2.new(0, 0)

--------------------------------------------------------------------------------
--- Raylib
--------------------------------------------------------------------------------
---
---Get time in seconds for last frame drawn (delta time)
---@return number
---
function GetFrameTime() end

---
---Check if a key is being pressed (key held down).
---@param key string The key code to listen for.
---@return boolean True if the key is currently down.
---
function IsKeyDown(key) end

---
---Check if a key is NOT being pressed (key not held down).
---@param key string The key code to listen for.
---@return boolean True if the key is currently up.
---
function IsKeyUp(key) end

---
---Check if a key has been pressed once.
---@param key string The key code to listen for.
---@return boolean True if the key has been pressed.
---
function IsKeyPressed(key) end

---
---Check if a key has been released once.
---@param key string The key code to listen for.
---@return boolean True if the key has been released.
---
function IsKeyReleased(key) end

---
---Check if a key has been pressed again.
---@param key string The key code to listen for.
---@return boolean True if the key has been pressed again.
---
function IsKeyPressedRepeat(key) end

---
---Draw texture
---@param texture Texture2D The texture to draw.
---@param posX integer The x-coordinate of the texture.
---@param posY integer The y-coordinate of the texture.
---@param tint Color The tint of the texture.
---
function DrawTexture(texture, posX, posY, tint) end

---
---Draw a part of a texture (defined by a rectangle) with 'pro' parameters
---@param texture Texture2D The texture to draw.
---@param source Rectangle Source dimensions
---@param dest Rectangle Destination dimensions
---@param origin Vector2 Origin coordinates of the texture
---@param rotation number Rotation of the texture
---@param tint Color The tint of the texture.
---
function DrawTexturePro(texture, source, dest, origin, rotation, tint) end

---
---Draw text (using default font)
---NOTE: fontSize work like in any drawing program but if fontSize is lower than font-base-size, then font-base-size is used
---NOTE: chars spacing is proportional to fontSize
---@param text string The text to draw.
---@param posX integer The x-coordinate of the text.
---@param posY integer The y-coordinate of the text.
---@param fontSize integer The font size of the text.
---@param color Color The color of the text.
---
function DrawText(text, posX, posY, fontSize, color) end

---
---Draw a line (using gl lines)
---@param startPosX integer The starting x-coordinate of the line.
---@param startPosY integer The starting y-coordinate of the line.
---@param endPosX integer The starting x-coordinate of the line.
---@param endPosY integer The starting y-coordinate of the line.
---@param color Color The color of the line.
---
function DrawLine(startPosX, startPosY, endPosX, endPosY, color) end

---
---Draw a color-filled rectangle
---@param posX integer The x-coordinate of the rectangle.
---@param posY integer The y-coordinate of the rectangle.
---@param width integer The width of the rectangle.
---@param height integer The height of the rectangle.
---@param color Color The color of the rectangle.
---
function DrawRectangle(posX, posY, width, height, color) end

---
---Draw rectangle outline
---@param posX integer The x-coordinate of the rectangle.
---@param posY integer The y-coordinate of the rectangle.
---@param width integer The width of the rectangle.
---@param height integer The height of the rectangle.
---@param color Color The color of the rectangle.
---
function DrawRectangleLines(posX, posY, width, height, color) end

---
---Draw a color-filled circle
---@param centerX integer The center x-coordinate of the circle.
---@param centerY integer The center y-coordinate of the circle.
---@param radius number The radius of the circle.
---@param color Color The color of the circle.
---
function DrawCircle(centerX, centerY, radius, color) end

---
---Unload texture from memory
---@param texture Texture2D Texture to unload
---
function UnloadTexture(texture) end

---
---Play sound from Sound data
---@param sound Sound Sound to play
---
function PlaySound(sound) end
---@meta rtc_handler

--------------------------------------------------------------------------------
--- RTC Handler
--------------------------------------------------------------------------------
---
---Generate UUID string
---@return string
---
function generate_uuid() end

---
---Initialize RTC connection information
---@param ws_url string Websocket URL
---@param username string Username to connect with
---@param room string Room code to join
---
function rtc_initialize(ws_url, username, room) end

---
---Start RTC connection 
---
function rtc_handle_connection() end

---
---Cleanup RTC connection 
---
function rtc_cleanup() end

---
---Send message to connected data channels
---@param message string Message string to send
---
function rtc_send_message(message) end

---
---Send json message to connected data channels
---@param type string Type as string
---@param object string Object string
---
function rtc_send_typed_object(type, object) end

---
---Set callback function when data channel is opened
---@param on_message_opened function cb(int id, void *ptr)
---
function rtc_set_message_opened_callback(on_message_opened) end

---
---Set callback function when message is received from a data channel
---@param on_message_received function cb(int id, const char *message, int size, void *ptr)
---
function rtc_set_message_received_callback(on_message_received) end

---
---Set callback function when data channel is closed
---@param on_message_closed function cb(int id, void *ptr)
---
function rtc_set_message_closed_callback(on_message_closed) end
local idle_anim = Anim.new("idle", {1}, 6, 1, 10)

print("idle_anim")

local width = 56
local height = 56

for i=1,6 do
    idle_anim.frame_update[i] = function(self)
        local animator = self.animator
        local res = self.frame_resources[1]
        local texture = animator.resources[res]
        local dest = Rectangle.new(animator.x, animator.y, animator.w, animator.h)

        local x = (i - 1) * width

        local flip = 1
        if not animator.state.facing_right then
            flip = -1
        end

        DrawTexturePro(texture, Rectangle.new(x, 0, width * flip, height), dest, Vector2.zero, 0,
          Color.WHITE)
        self:NextFrame()
    end
end

return idle_anim
local player_animator = Animator.new("Player")

player_animator.Init = function(self)
  self.w = 100
  self.h = 100

  self:LoadResource("assets/player/char_blue_1.png")
  self:LoadResource("assets/sounds/coin.wav", audio_group_get(0))
  self:LoadAnim(import("idle"))
  self:LoadAnim(import("walk"))

  self.current_state = "idle"
  self.state.moving = false
  self.state.facing_right = true

  return self
end

player_animator.Before = function(self)
  if self.state.moving == false then
    self:ChangeState("idle")
  else
    self:ChangeState("walk")
  end
end

player_animator.state_enter["idle"] = function(self)
  -- print('enter idle')
  self.anims["idle"].current_frame = 1
end

player_animator.state_enter["walk"] = function(self)
  -- print('enter walk')
  self.anims["walk"].current_frame = 1
end

return player_animator
local walk_anim = Anim.new("walk", {1}, 8, 1, 10)

print("walk_anim")

local width = 56
local height = 56

for i=1,8 do
    walk_anim.frame_update[i] = function(self)
        local animator = self.animator
        local res = self.frame_resources[1]
        local texture = animator.resources[res]
        local dest = Rectangle.new(animator.x, animator.y, animator.w, animator.h)

        local x = (i - 1) * width
        local y = 2 * height

        local flip = 1
        if not animator.state.facing_right then
            flip = -1
        end

        DrawTexturePro(texture, Rectangle.new(x, y, width * flip, height), dest, Vector2.zero, 0,
          Color.WHITE)
        self:NextFrame()
    end
end

for _, i in pairs({2, 6}) do
    walk_anim.frame_enter[i] = function(self)
        local animator = self.animator
        local walk_sound = animator.resources[2]
        PlaySound(walk_sound)
    end
end

return walk_anim
---@param component any
---@param animator Animator
ECS.component("animator", function(component, animator)
    component.a = animator
end)
---@param component any
---@param hitbox Vector2
---@param offset Vector2
---@param layer? string[]
ECS.component("box_collider", function(component, hitbox, offset, layer)
    component.hitbox = hitbox
    component.offset = offset
    component.layer = layer
end)
---@param component any
---@param w number
---@param h number
---@param col Color
ECS.component("box_draw", function(component, w, h, col)
    component.w = w or 0
    component.h = h or 0
    component.col = col
end)
---@param component any
---@param input_map { [string]: string }
ECS.component("player_input", function(component, input_map)
    component.input_map = input_map
end)

ECS.component("controllable")
---@param component any
---@param target any
ECS.component("follow", function(component, target)
    component.target = target
end)
---@param component any
---@param x number
---@param y number
ECS.component("position", function(component, x, y)
    component.x = x or 0
    component.y = y or 0
end)
---@param component any
---@param val number
ECS.component("speed", function(component, val)
    component.val = val or 4.0
end)
---@param component any
---@param hitbox Vector2
---@param offset Vector2
---@param layer? string[]
ECS.component("trigger", function(component, hitbox, offset, layer)
    component.hitbox = hitbox
    component.offset = offset
    component.layer = layer
end)
---@param component any
---@param x number
---@param y number
ECS.component("velocity", function(component, x, y)
    component.x = x or 0
    component.y = y or 0
end)
print("Core Mod loaded!")

DEBUG = true

import("main_menu")
import("settings_menu")
local cwd = function()
  local info = debug.getinfo(1, "S")
  if info and info.source then
    local path = info.source:gsub("^[@=]", "")
    return path:match("^(.*[\\/])")
  end
  return nil
end

if not WORLD then
  ECS.utils.loadNamespace(cwd() .. "components")
  local Systems = {}
  ECS.utils.loadNamespace(cwd() .. "systems", Systems)

  WORLD = ECS.world()

  local system_sort = {}
  for _, system in pairs(Systems) do
    table.insert(system_sort, system)
  end

  table.sort(system_sort, function(a, b)
    if a.priority and b.priority then
      return a.priority < b.priority
    elseif a.priority then
      return true
    else
      return false
    end
  end)

  for _, system in ipairs(system_sort) do
    WORLD:addSystem(system)
  end
end

if not CAMERA then
  CAMERA = ECS.entity(WORLD)
end
CAMERA
    :ensure("position", 0, 0)
    :ensure("velocity", 0, 0)
    :give("speed", 2.0)
    :ensure("follow")

local bg = Color.new(255, 41, 55, 255)

if not PLAYER then
  PLAYER = ECS.entity(WORLD)
end
PLAYER
    :ensure("animator", import("animators/player"):Init())
    :ensure("position", 20, 20)
    :ensure("velocity", 0, 0)
    :give("speed", 4.0)
    :give("box_collider", Vector2.new(40, 55), Vector2.new(30, 45))
    :give("controllable")
    :give("player_input", {
      up = "KEY_W",
      down = "KEY_S",
      left = "KEY_A",
      right = "KEY_D",
    })
CAMERA.follow.target = PLAYER

if not BOX then
  BOX = ECS.entity(WORLD)
end
BOX
    :ensure("position", 100, 200)
    :give("box_draw", 50, 50, Color.RED)
    :give("box_collider", Vector2.new(50, 50), Vector2.zero)

local STYLE_BLUE = import("styles/blue")
local STYLE_RED = import("styles/red")

local test_text = Engine_LoadResource("assets/test.txt", 0)
print(test_text)

MAX_HISTORY = 32
MAX_INPUT_LENGTH = 256

local debug_console = {
  window_width = 0,
  window_height = 0,
  input_buffer = "",
  io_buffer = {},
  history = {},
  history_count = 0,
  current_command = 0,
  scroll_to_bottom = false
}

RegisterFunction("HOOK_MAIN_MENU_INIT", function()
  print("(Core Mod): Main menu init!")

  local host = "localhost"
  local post = "3012"
  local ws_url = string.format("ws://%s:%s", host, post)

  local uuid = generate_uuid()
  local room = "gg"

  rtc_set_message_opened_callback(function()
    print("data channel opened")
  end)

  rtc_set_message_received_callback(function(id, message, size, ptr)
    print("data channel received"..message)
  end)

  rtc_set_message_closed_callback(function()
    print("data channel closed")
  end)

  rtc_initialize(ws_url, uuid, room)

  rtc_handle_connection()

  event_register("TEST", "main_menu_listener", function()
    print("main_menu TEST event fired")
    return false
  end)

  event_register("TEST", "main_menu_listener the second", function(type, sender, listener, event_context, context)
    print("main_menu " .. type .. " event fired by " .. sender .. " listening from " .. listener)
    return false
  end)
end)

RegisterFunction("HOOK_MAIN_MENU_PROCESS_INPUT", function()
  if IsKeyDown("KEY_BACKSLASH") then
    Engine_Mod_Scene_Switch("SETTINGS_MENU")
  end

  if EDIT_ACTIVE then
    return
  end

  if IsKeyPressed("KEY_R") then
    rtc_send_message("hi")
  end

  if IsKeyDown("KEY_F") then
    event_fire("TEST", "main_menu_sender")
  end

  if IsKeyDown("KEY_G") then
    print(bg)
  end

  if IsKeyPressed("KEY_M") then
    Engine_SetMasterVolume(0.0)
  end
  if IsKeyPressed("KEY_U") then
    Engine_SetMasterVolume(0.2)
  end
  if IsKeyPressed("KEY_I") then
    Engine_SetMasterVolume(1.0)
  end

  if IsKeyPressed("KEY_TAB") then
    DEBUG = not DEBUG
  end

  if IsKeyPressed("KEY_MINUS") then
    local group = audio_group_get(0)
    local vol = audio_group_get_volume(group)
    vol = tonumber(string.format('%.2f', vol - 0.1)) or 0
    if vol >= 0.0 then
      audio_group_set_volume(group, vol)
    end
  end
  if IsKeyPressed("KEY_EQUAL") then
    local group = audio_group_get(0)
    local vol = audio_group_get_volume(group)
    vol = tonumber(string.format('%.2f', vol + 0.1)) or 0
    if vol <= 1.0 then
      audio_group_set_volume(group, vol)
    end
  end
end)

RegisterFunction("HOOK_MAIN_MENU_UPDATE", function()
  WORLD:emit("update")
end)

RegisterFunction("HOOK_MAIN_MENU_DRAW", function()
  WORLD:emit("draw")

  if DEBUG then
    WORLD:emit("debug_draw")
  end

  -- DrawRectangle(player.x, player.y, 20, 20, bg)
  nk_style_from_table(STYLE_BLUE);
  if nk_begin("Main menu", nk_rect.new(0, 0, Engine_GetWidth(), Engine_GetHeight()), NK.WINDOW_BACKGROUND) then
    EASY = 0
    HARD = 1
    OP = OP or EASY
    PROPERTY = PROPERTY or 20
    nk_layout_row_static(30, 80, 1)
    if nk_button_label("button") then
      print("button pressed")
      rtc_send_message("message")
    end
    nk_layout_row_dynamic(30, 2);
    if nk_option_label("easy", OP == EASY) then
      OP = EASY
    end
    if nk_option_label("hard", OP == HARD) then
      OP = HARD
    end
    nk_layout_row_dynamic(25, 1)
    PROPERTY = nk_property_int("Compression:", 0, PROPERTY, 100, 10, 1)
    nk_layout_row_dynamic(20, 1)
    nk_label("background:", 3)
    nk_layout_row_dynamic(25, 1)
    if nk_combo_begin_color(bg, nk_vec2.new(nk_widget_width(), 400)) then
      nk_layout_row_dynamic(120, 1)
      bg = nk_color_picker(bg, 1);
      nk_layout_row_dynamic(25, 1)
      bg.r = nk_property_int("#R:", 0, bg.r, 255, 5, 1)
      bg.g = nk_property_int("#G:", 0, bg.g, 255, 5, 1)
      bg.b = nk_property_int("#B:", 0, bg.b, 255, 5, 1)
      bg.a = nk_property_int("#A:", 0, bg.a, 255, 5, 1)
      nk_combo_end()
    end
  end
  nk_end()

  STYLE_RED.NK_COLOR_HEADER = bg
  nk_style_from_table(STYLE_RED)
  if (nk_begin("Console", nk_rect.new(50, 50, 400, 300),
        NK.WINDOW_BORDER | NK.WINDOW_MOVABLE | NK.WINDOW_SCALABLE |
        NK.WINDOW_MINIMIZABLE | NK.WINDOW_TITLE)) then
    local line_height = 10

    if debug_console.window_height ~= nk_window_get_height() then
      local _, scroll_y = nk_group_get_scroll("History")
      nk_group_set_scroll("History", 0, scroll_y + debug_console.window_height - nk_window_get_height())
    end

    -- Output history
    nk_layout_row_dynamic(nk_window_get_height() - 80, 1)
    if (nk_group_begin("History", NK.WINDOW_BORDER)) then
      for i = 1, #debug_console.io_buffer do
        nk_layout_row_dynamic(line_height, 1)
        nk_label(debug_console.io_buffer[i], NK.TEXT_LEFT)
      end
      if (debug_console.scroll_to_bottom) then
        nk_group_set_scroll("History", 0, #debug_console.io_buffer * line_height)
        debug_console.scroll_to_bottom = false
      end
    end
    nk_group_end()

    -- Input field
    nk_layout_row_dynamic(25, 1);
    local command, state = nk_edit_string_zero_terminated(NK.EDIT_FIELD, debug_console.input_buffer, MAX_INPUT_LENGTH)
    debug_console.input_buffer = command

    if (state & NK.EDIT_ACTIVE) ~= 0 then
      if (nk_input_is_key_pressed(NK.KEY_DOWN)) then
        if debug_console.current_command + 1 <= debug_console.history_count then
          debug_console.current_command = debug_console.current_command + 1
          debug_console.input_buffer = debug_console.history[debug_console.current_command]
          nk_edit_set_cursor(debug_console.input_buffer:len())
        elseif debug_console.current_command + 1 == debug_console.history_count + 1 then
          debug_console.current_command = debug_console.current_command + 1
          debug_console.input_buffer = ""
        end
      end
      if (nk_input_is_key_pressed(NK.KEY_UP)) then
        local count = ((debug_console.current_command - 1) % MAX_HISTORY)
        if debug_console.current_command > 0 and debug_console.history[count] ~= nil then
          debug_console.current_command = debug_console.current_command - 1
          debug_console.input_buffer = debug_console.history[count]
        end
        nk_edit_set_cursor(debug_console.input_buffer:len())
      end
      if (nk_input_is_key_pressed(NK.KEY_ENTER)) then
        local argc = {}
        local regex = ("([^%s]+)"):format(" ")
        for each in command:gmatch(regex) do
          table.insert(argc, each)
        end

        table.insert(debug_console.io_buffer, "> " .. command)

        if argc[1] == "set" and #argc == 3 then
          local val = tonumber(argc[3])

          if val then
            load(argc[2] .. " = " .. argc[3])()
          else
            val = argc[3]
            local len = #val
            if val == "true" or val == "false" then
              load(argc[2] .. " = " .. val)()
            elseif val:sub(1, 1) == '"' and val:sub(len, len) == '"' then
              load(argc[2] .. " = " .. val:sub(2, len - 1))()
            end
          end
        elseif argc[1] == "get" and #argc == 2 then
          local val = _G
          regex = ("([^%s]+)"):format(".")
          for each in argc[2]:gmatch(regex) do
            val = val[each]
          end
          table.insert(debug_console.io_buffer, tostring(val))
        else
          table.insert(debug_console.io_buffer, '"' .. argc[1] .. '"' .. " command not found")
        end

        debug_console.history[(debug_console.history_count % MAX_HISTORY) + 1] = command
        debug_console.history_count = debug_console.history_count + 1
        debug_console.current_command = debug_console.history_count + 1
        debug_console.input_buffer = '\0'
        debug_console.scroll_to_bottom = true
      end
    end

    if (state & NK.EDIT_ACTIVATED) ~= 0 then
      PLAYER:remove("controllable")
      EDIT_ACTIVE = true
    end

    if (state & NK.EDIT_DEACTIVATED) ~= 0 then
      PLAYER:give("controllable")
      EDIT_ACTIVE = false
    end

    debug_console.window_width = nk_window_get_width()
    debug_console.window_height = nk_window_get_height()
  end
  nk_end()
end)

RegisterFunction("HOOK_MAIN_MENU_CLEANUP", function()
  rtc_cleanup()
  print("(Core Mod): Main menu cleanup!")
end)
{
  "name": "Core Mod",
  "version": "1.0",
  "author": "liraymond04",
  "description": "Mod that contains the core game",
  "dependencies": []
}
local player_speed = 4.0

local BLUE = { r = 50, g = 41, b = 55, a = 255 }

RegisterFunction("HOOK_SETTINGS_MENU_INIT", function()
  print("(Core Mod): Settings menu init!")

  player_x = 20
  player_y = 20
end)

RegisterFunction("HOOK_SETTINGS_MENU_PROCESS_INPUT", function()
  -- print("(Core Mod): Settings menu process input!")
  if IsKeyDown("KEY_F") then
    event_fire("TEST", "settings_menu_sender")
  end
end)

RegisterFunction("HOOK_SETTINGS_MENU_UPDATE", function()
  if IsKeyDown("KEY_W") then
    player_y = player_y - player_speed
  end
  if IsKeyDown("KEY_S") then
    player_y = player_y + player_speed
  end
  if IsKeyDown("KEY_A") then
    player_x = player_x - player_speed
  end
  if IsKeyDown("KEY_D") then
    player_x = player_x + player_speed
  end
end)

RegisterFunction("HOOK_SETTINGS_MENU_DRAW", function()
  DrawRectangle(player_x, player_y, 20, 20, BLUE)
end)

RegisterFunction("HOOK_SETTINGS_MENU_CLEANUP", function()
  print("(Core Mod): Settings menu cleanup!")
end)
return {
  NK_COLOR_TEXT = Color.new(20, 20, 20, 255),
  NK_COLOR_WINDOW = Color.new(202, 212, 214, 0),
  NK_COLOR_HEADER = Color.new(137, 182, 224, 220),
  NK_COLOR_BORDER = Color.new(140, 159, 173, 255),
  NK_COLOR_BUTTON = Color.new(137, 182, 224, 255),
  NK_COLOR_BUTTON_HOVER = Color.new(142, 187, 229, 255),
  NK_COLOR_BUTTON_ACTIVE = Color.new(147, 192, 234, 255),
  NK_COLOR_TOGGLE = Color.new(177, 210, 210, 255),
  NK_COLOR_TOGGLE_HOVER = Color.new(182, 215, 215, 255),
  NK_COLOR_TOGGLE_CURSOR = Color.new(137, 182, 224, 255),
  NK_COLOR_SELECT = Color.new(177, 210, 210, 255),
  NK_COLOR_SELECT_ACTIVE = Color.new(137, 182, 224, 255),
  NK_COLOR_SLIDER = Color.new(177, 210, 210, 255),
  NK_COLOR_SLIDER_CURSOR = Color.new(137, 182, 224, 245),
  NK_COLOR_SLIDER_CURSOR_HOVER = Color.new(142, 188, 229, 255),
  NK_COLOR_SLIDER_CURSOR_ACTIVE = Color.new(147, 193, 234, 255),
  NK_COLOR_PROPERTY = Color.new(210, 210, 210, 255),
  NK_COLOR_EDIT = Color.new(210, 210, 210, 225),
  NK_COLOR_EDIT_CURSOR = Color.new(20, 20, 20, 255),
  NK_COLOR_COMBO = Color.new(210, 210, 210, 255),
  NK_COLOR_CHART = Color.new(210, 210, 210, 255),
  NK_COLOR_CHART_COLOR = Color.new(137, 182, 224, 255),
  NK_COLOR_CHART_COLOR_HIGHLIGHT = Color.new( 255, 0, 0, 255),
  NK_COLOR_SCROLLBAR = Color.new(190, 200, 200, 255),
  NK_COLOR_SCROLLBAR_CURSOR = Color.new(64, 84, 95, 255),
  NK_COLOR_SCROLLBAR_CURSOR_HOVER = Color.new(70, 90, 100, 255),
  NK_COLOR_SCROLLBAR_CURSOR_ACTIVE = Color.new(75, 95, 105, 255),
  NK_COLOR_TAB_HEADER = Color.new(156, 193, 220, 255),
}
return {
  NK_COLOR_TEXT = Color.new(190, 190, 190, 255),
  NK_COLOR_WINDOW = Color.new(30, 33, 40, 215),
  NK_COLOR_HEADER = Color.new(181, 45, 69, 220),
  NK_COLOR_BORDER = Color.new(51, 55, 67, 255),
  NK_COLOR_BUTTON = Color.new(181, 45, 69, 255),
  NK_COLOR_BUTTON_HOVER = Color.new(190, 50, 70, 255),
  NK_COLOR_BUTTON_ACTIVE = Color.new(195, 55, 75, 255),
  NK_COLOR_TOGGLE = Color.new(51, 55, 67, 255),
  NK_COLOR_TOGGLE_HOVER = Color.new(45, 60, 60, 255),
  NK_COLOR_TOGGLE_CURSOR = Color.new(181, 45, 69, 255),
  NK_COLOR_SELECT = Color.new(51, 55, 67, 255),
  NK_COLOR_SELECT_ACTIVE = Color.new(181, 45, 69, 255),
  NK_COLOR_SLIDER = Color.new(51, 55, 67, 255),
  NK_COLOR_SLIDER_CURSOR = Color.new(181, 45, 69, 255),
  NK_COLOR_SLIDER_CURSOR_HOVER = Color.new(186, 50, 74, 255),
  NK_COLOR_SLIDER_CURSOR_ACTIVE = Color.new(191, 55, 79, 255),
  NK_COLOR_PROPERTY = Color.new(51, 55, 67, 255),
  NK_COLOR_EDIT = Color.new(51, 55, 67, 225),
  NK_COLOR_EDIT_CURSOR = Color.new(190, 190, 190, 255),
  NK_COLOR_COMBO = Color.new(51, 55, 67, 255),
  NK_COLOR_CHART = Color.new(51, 55, 67, 255),
  NK_COLOR_CHART_COLOR = Color.new(170, 40, 60, 255),
  NK_COLOR_CHART_COLOR_HIGHLIGHT = Color.new(255, 0, 0, 255),
  NK_COLOR_SCROLLBAR = Color.new(30, 33, 40, 255),
  NK_COLOR_SCROLLBAR_CURSOR = Color.new(64, 84, 95, 255),
  NK_COLOR_SCROLLBAR_CURSOR_HOVER = Color.new(70, 90, 100, 255),
  NK_COLOR_SCROLLBAR_CURSOR_ACTIVE = Color.new(75, 95, 105, 255),
  NK_COLOR_TAB_HEADER = Color.new(181, 45, 69, 220),
}
local box_draw_system = ECS.system({
    pool = { "position", "box_draw" }
})

box_draw_system.priority = 100

function box_draw_system:draw()
    if not CAMERA then
        return
    end
    for _, e in ipairs(self.pool) do
        local x = e.position.x - CAMERA.position.x
        local y = e.position.y - CAMERA.position.y
        DrawRectangle(x, y, e.box_draw.w, e.box_draw.h, e.box_draw.col)
    end
end

return box_draw_system
local collision_system = ECS.system({
    pool = { "position", "box_collider" }
})

collision_system.priority = 11

function collision_system:debug_draw()
    if not CAMERA then
        return
    end
    for _, e in ipairs(self.pool) do
        local pos = e.position
        local col = e.box_collider
        local x = pos.x + col.offset.x - CAMERA.position.x
        local y = pos.y + col.offset.y - CAMERA.position.y
        DrawRectangleLines(x, y, col.hitbox.x, col.hitbox.y, Color.BLUE)
    end
end

function collision_system:update()
    for i, e1 in ipairs(self.pool) do
        for j, e2 in ipairs(self.pool) do
            if i == j then
                goto continue
            end

            if check_collision(e1, e2) then
                local posA = e1.position
                local offsetA = e1.box_collider.offset
                local boxA = e1.box_collider.hitbox

                local posB = e2.position
                local offsetB = e2.box_collider.offset
                local boxB = e2.box_collider.hitbox

                local ax1 = posA.x + offsetA.x
                local ax2 = ax1 + boxA.x
                local ay1 = posA.y + offsetA.y
                local ay2 = ay1 + boxA.y

                local bx1 = posB.x + offsetB.x
                local bx2 = bx1 + boxB.x
                local by1 = posB.y + offsetB.y
                local by2 = by1 + boxB.y

                local overlapX = math.min(ax2, bx2) - math.max(ax1, bx1)
                local overlapY = math.min(ay2, by2) - math.max(ay1, by1)

                if overlapX < overlapY then
                    if ax1 < bx1 then
                        e1.position.x = posA.x - overlapX
                    else
                        e1.position.x = posA.x + overlapX
                    end
                else
                    if ay1 < by1 then
                        e1.position.y = posA.y - overlapY
                    else
                        e1.position.y = posA.y + overlapY
                    end
                end
            end

            ::continue::
        end
    end
end

function check_collision(a, b)
    local pos_a = a.position
    local col_a = a.box_collider

    local pos_b = b.position
    local col_b = b.box_collider

    local offset_a = col_a.offset
    local offset_b = col_b.offset

    if col_a and col_b then
        return box_box(pos_a, offset_a, col_a.hitbox, pos_b, offset_b, col_b.hitbox)
    end

    return false
end

function circle_circle(pos_a, offset_a, circle_a, pos_b, offset_b, circle_b)
    local dx = (pos_a.x + offset_a.x) - (pos_b.x + offset_b.x)
    local dy = (pos_a.y + offset_a.y) - (pos_b.y + offset_b.y)
    local distance = math.sqrt(dx * dx + dy * dy)
    return distance < (circle_a.radius + circle_b.radius)
end

function box_box(pos_a, offset_a, box_a, pos_b, offset_b, box_b)
    return pos_a.x + offset_a.x < pos_b.x + offset_b.x + box_b.x and
        pos_a.x + offset_a.x + box_a.x > pos_b.x + offset_b.x and
        pos_a.y + offset_a.y < pos_b.y + offset_b.y + box_b.y and
        pos_a.y + offset_a.y + box_a.y > pos_b.y + offset_b.y
end

function circle_box(circle_pos, circle_offset, circle, box_pos, box_offset, box)
    -- Simplified check assuming the box is axis-aligned
    local closestX = math.max(box_pos.x + box_offset.x,
        math.min(circle_pos.x + circle_offset.x, box_pos.x + box_offset.x + box.x))
    local closestY = math.max(box_pos.y + box_offset.y,
        math.min(circle_pos.y + circle_offset.y, box_pos.y + box_offset.y + box.y))

    local dx = (circle_pos.x + circle_offset.x) - closestX
    local dy = (circle_pos.y + circle_offset.y) - closestY

    return (dx * dx + dy * dy) < (circle.radius * circle.radius)
end

return collision_system
local draw_system = ECS.system({
    pool = { "position", "animator" }
})

draw_system.priority = 101

function draw_system:draw()
    if not CAMERA then
        return
    end
    for _, e in ipairs(self.pool) do
        ---@type Animator
        local animator = e.animator.a
        animator.x = e.position.x - CAMERA.position.x
        animator.y = e.position.y - CAMERA.position.y
        animator:Tick()
    end
end

return draw_system
local follow_system = ECS.system({
    pool = { "position", "velocity", "speed", "follow"}
})

follow_system.priority = 12

function follow_system:update()
    for _, e in ipairs(self.pool) do
        local target = e.follow.target
        if target then
            e.position.x = (target.position.x + target.animator.a.w / 2) - Engine_GetWidth() / 2
            e.position.y = (target.position.y + target.animator.a.h / 2) - Engine_GetHeight() / 2
        end
    end
end

return follow_system
local input_system = ECS.system({
    pool = { "velocity", "speed", "animator", "player_input", "controllable" }
})

input_system.priority = 1

function input_system:update()
    for _, e in ipairs(self.pool) do
        local dir = Vector2.new(0, 0)
        ---@type Animator
        local animator = e.animator.a
        animator.state.moving = false

        local input_map = e.player_input.input_map

        if IsKeyDown(input_map.up) then
            dir.y = dir.y - e.speed.val
        end
        if IsKeyDown(input_map.down) then
            dir.y = dir.y + e.speed.val
        end
        if IsKeyDown(input_map.left) then
            dir.x = dir.x - e.speed.val
        end
        if IsKeyDown(input_map.right) then
            dir.x = dir.x + e.speed.val
        end

        if dir.x > 0 then
            animator.state.facing_right = true
        end
        if dir.x < 0 then
            animator.state.facing_right = false
        end

        if dir ~= Vector2.zero then
            animator.state.moving = true
        end

        e.velocity.x = dir.x
        e.velocity.y = dir.y
    end
end

return input_system
local move_system = ECS.system({
    pool = { "position", "velocity" },
})

move_system.priority = 10

function move_system:update()
    for _, e in ipairs(self.pool) do
        e.position.x = e.position.x + e.velocity.x
        e.position.y = e.position.y + e.velocity.y
    end
end

return move_system
rresd          IMGESW              GM     h                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     JTb                                                                                                                                                                                                                                                                                                                                                                                                                                    JTbJTb                                               JTbJTb                                              muJTb                                                                                                  JTb                                                   JTb                                                                                                                                                                  mu2<9JTbmu                                              mu2<9JTbmu                                            muJTbmumu                                             JTb                                                 JTbmu                                               muJTb                                                                                                                                                               JTbJTbmumu2<92<9mumumu                                             JTbJTbmumu2<92<9mumumu                                             JTbJTbmumu2<92<9mumumu                                              mu2<9muJTb                                              mu2<9mumu                                               mumumumu                                                                                                                                                              JTbJTbJTbJTbrOrO2<9mumumu                                             JTbJTbJTbJTbrOrO2<9mumumu                                            JTbJTbJTbJTbJTbrOrO2<9mumumu                                             JTbJTbmumu2<92<9mumumu                                            JTbJTbmumu2<92<9mumumu                                             JTbJTbmumu2<92<9mumumu                                                                                                                                                             JTb2<9JTbJTbrOrOrO2<9mu                                             2<92<9JTbJTbrOrOrO2<9mu                                             2<92<9JTbJTbrOrOrO2<9mu                                            JTbJTbJTbJTbJTbrOrO2<9mumumu2<9                                            JTbJTbJTbJTbrOrO2<9mumumu                                             JTbJTbJTbJTbrOrO2<9mumu                                                                                                                                                             2<92<9iJTb],(],(                                               2<92<9iJTb],(],(                                               2<92<9iJTb],(],(                                              JTbJTb2<9JTbJTbrOrOrO2<9mu                                            JTbJTb2<9JTbJTbrOrOrO2<9mu                                             JTb2<9JTbJTbrOrOrO2<9mu                                                                                                                                                              2<9irO],(],(                                                2<9irO],(],(                                                2<9irO],(],(                                               2<92<9iJTb],(],(                                               2<92<9iJTb],(rOrO],(                                                2<9iJTb],(rOrO],(                                                                                                                                                                2<9rO],(                                                 2<9rO],(                                                 2<9rO],(                                                2<9irO],(],(                                                2<9irO],(],(                                                2<9irO],(],(                                                                                                                                                                  ],(rO                                               H6H6H6 %] %]rO],(                                              H6H6H6 %] %]rO],(                                                 2<9rO],(                                                 2<9rO],(                                                 2<9rO],(                                                                                                                                                              H6H6H6 %] %] %]rOrO],(],(                                             ],(H6H6H6H6 %] %]rOrO],(],(],(                                           ],(],(H6H6H6H6 %] %]rOrO],(],(],(                                             H6H6H6 %] %]rO],(                                              H6H6H6 %] %]rO],(                                              H6H6H6 %] %]rO],(                                                                                                                                                             ],(H6H6H6H6 %]tttG],(],(                                           ],(bH6H6H6H6ttttG],(],(                                           ],(bH6H6H6H6ttttG],(],(                                           ],(],(H6H6H6H6 %] %]rOrO],(],(],(                                           ],(],(H6H6H6H6 %] %]rOrO],(],(],(                                            ],(H6H6H6H6 %] %]rOrO],(],(],(                                                                                                                                                           bbH6H6H6H6ttttt],(],(                                           bbb],(],(],(ttttt2<92<9                                           bbb],(],(],(ttttt2<92<92<9                                      bbH6H6H6H6ttttt],(],(2<9                                      bbH6H6H6H6ttttt],(],(2<9                                      bbH6H6H6H6ttttG],(],(                                                                                                                                                           bbb],(],(],(ttttt2<92<92<9                                     bbbb %] %]GGGG2<92<92<9                                     bbbb %] %]GG %] %]2<92<9                                   bbbb],(],(],(ttttG2<92<92<9                                   bbbb],(],(],(ttttG2<92<92<9                                    bbb],(],(],(ttttG2<92<92<9                                                                                                                                                     bbbb %] %]GGG %]2<92<92<9                                   bbbGGGGG2<92<92<9                                   bbbGGGG %]2<9B$3B$3JTb                                   bbbb %] %]G %] %] %]2<92<9B$3B$3JTb                                   bbbb %] %] %] %] %] %]2<92<9B$3B$3JTb                                   bbbb %] %] %] %] %] %]2<92<92<9                                                                                                                                                   bbbGGGGG2<92<9B$3B$3JTb                                   ],(bb  GGGGG2<9],(],(B$3B$3JTb                                   bbb GGGGG],(],(B$3B$3B$3B$3                                  bbb GGGG %]],(],(B$3B$3B$3B$3                                  bbb GGGG %]],(],(B$3B$3B$3B$3                                  bbbGGGG2<92<9B$3B$3JTb                                                                                                                                                   ],(],(],( GGGGG],(],(B$3B$3B$3B$3                                  ],(],(],(  GGGGG],(],(B$3B$3B$3B$3                                  ],(],(],(  GGGGG],(],(uGB$3B$3B$3B$3                                  ],(bb  GGGG %]],(],(uGB$3B$3B$3B$3                                  ],(bb GGGG %]],(],(uGB$3B$3B$3B$3                                  ],(],(],( GGGG],(],(B$3B$3B$3B$3                                                                                                                                                  ],(],(],(   %] %]GGGGG],(],(uGB$3B$3B$3B$3                                  ],(],(],(   %] %]GGGGG],(],(uGB$3B$3B$3B$3                                  ],(],(],(   %] %]GGGGGB$3B$3uGuGB$3B$3B$3                                  ],(],(],(   %]GGGGGB$3B$3uGuGB$3B$3B$3                                  ],(],(],(   %]GGGG %]B$3B$3uGuGB$3B$3B$3                                  ],(],(],(  GGGG],(],(uGB$3B$3B$3B$3                                                                                                                                                  ],(],(],(   %] %]GGGGGB$3B$3uGuGB$3B$3B$3                                  ],(],(],(   %] %]GGGGGB$3B$3uGuGB$3B$3B$3                                  ],(ii   %] %]GB$3B$3B$3B$3B$3B$3uGuGB$3B$3B$3                                  ],(ii   %] %]GB$3B$3B$3B$3B$3B$3uGuGB$3B$3B$3                                  ],(ii   %] %]GGGGGB$3B$3uGuGB$3B$3B$3                                  ],(],(],(   %] %]GGGGGB$3B$3uGuGB$3B$3B$3                                                                                                                                                  ],(ii ],(],(],(],(B$3B$3B$3B$3uGuGB$3B$3B$3                                   ii ],(],(],(],(B$3B$3B$3B$3uGuGB$3B$3B$3                                   iii],(],(],(],(B$3B$3B$3B$3B$3B$3B$3B$3B$3JTb                                   ],(iii],(],(],(],(B$3B$3B$3B$3B$3B$3B$3B$3B$3JTb                                   ],(iii],(],(],(],(B$3B$3B$3B$3B$3B$3B$3B$3B$3JTb                                   ],(ii ],(],(],(],(B$3B$3B$3B$3uGuGB$3B$3B$3                                                                                                                                                   iiiH6H6H6H6],(B$3B$3B$3B$3B$3B$3B$3B$3B$3JTb                                    iiiH6H6H6H6],(B$3B$3B$3B$3B$3B$3B$3B$3B$3JTb                                    iiH6H6H6],(],(B$3B$3B$3 B$3B$3B$3B$3B$3JTbJTb                                    iiH6H6H6],(],(B$3B$3B$3],(B$3B$3B$3B$3B$3JTbJTb                                    iiH6H6H6],(],(B$3B$3B$3],(B$3B$3B$3B$3B$3JTbJTb                                    iiiH6H6H6H6],(B$3B$3B$3B$3B$3B$3B$3B$3B$3JTb                                                                                                                                                    iiH6H6H6H6B$3B$3B$3],(],(B$3B$3B$3B$3B$3JTbJTb                                    iiH6H6H6H6B$3B$3B$3],(],(B$3B$3B$3B$3B$3JTbJTb                                     iH6H6B$3B$3B$3],(],( JTbJTbJTbJTb                                       iH6H6B$3B$3],(],( JTbJTbJTbJTb                                       iH6H6B$3B$3],(],( JTbJTbJTbJTb                                      iiH6H6H6H6B$3B$3B$3],(],(B$3B$3B$3B$3B$3JTbJTb                                                                                                                                                     iH6B$3],(],(],( JTbJTbJTbJTb                                       iH6B$3],(],(],( JTbJTbJTbJTb                                         H6],(],(],(                                              H6],(],(],(                                              H6],(],(],(                                            iH6H6],(],(],( JTbJTbJTbJTb                                                                                                                                                         H6 ],(],(],(                                              H6 ],(],(],(                                              H6H6H6],(],(],(                                              H6H6H6],(],(],(],(                                             H6H6H6],(],(],(],(                                             H6 ],(],(],(                                                                                                                                                             ],(H6H6H6],(],(],(],(                                            ],(H6H6H6],(],(],(],(                                            ],(H6H6H6   ],(],(],(],(                                            ],(H6H6H6   ],(],(],(],(                                            ],(H6H6H6   ],(],(],(],(                                            ],(H6H6H6],(],(],(],(                                                                                                                                                            ],(H6H6],(    ],(],(],(],(                                            ],(H6H6],(    ],(],(],(],(                                            ],(H6H6],(    ],(],(],(],(                                            ],(H6H6],(    ],(],(],(],(                                            ],(H6H6],(    ],(],(],(],(                                            ],(H6H6],(    ],(],(],(],(                                                                                                                                                            bbb],(    H6H6],(                                            bbb],(    H6H6],(                                            bbb],(    H6H6],(                                            bbb],(    H6H6],(                                            bbb],(    H6H6],(                                            bbb],(    H6H6],(                                                                                                                                                           2<92<92<9     2<92<9                                            2<92<92<9     2<92<9                                            2<92<92<9     2<92<9                                            2<92<92<9     2<92<9                                            2<92<92<9     2<92<9                                            2<92<92<9     2<92<9                                                                                                                                                            2<92<92<9     2<92<9                                            2<92<92<9     2<92<9                                            2<92<92<9     2<92<9                                            2<92<92<9     2<92<9                                            2<92<92<9     2<92<9                                            2<92<92<9     2<92<9                                                                                                                                                           2<92<92<9      2<92<9                                           2<92<92<9      2<92<9                                           2<92<92<9      2<92<9                                           2<92<92<9      2<92<9                                           2<92<92<9      2<92<9                                           2<92<92<9      2<92<9                                                                                                                                                           2<92<92<9      2<92<92<9                                          2<92<92<9      2<92<92<9                                          2<92<92<9      2<92<92<9                                          2<92<92<9      2<92<92<9                                          2<92<92<9      2<92<92<9                                          2<92<92<9      2<92<92<9                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    JTb                                              JTb                                                        mumu                                   ~~~~           mumu                                                                                                                                                                                                            JTb                                             JTbJTb                                           JTbJTb                                                   JTbJTb                                ~~~~~~~      mu                                                                                                   mu                                                                                                    JTbJTb                                            mu2<9JTbmu                                          mu2<9JTbmu                                                muJTbJTb                                ~~~~~~~~~~  muJTbJTb                                               muJTb                                               JTbJTb                                                JTbJTb                                               mu2<9JTbmu                                          JTbJTbmumu2<92<9mumumu                                         JTbJTbmumu2<92<9mumumu                                                 JTbJTbmumu2<92<9mumumu                                 ~~~~~~~~~~~~JTbJTbmumu2<92<9mumumu                                              muJTbmumu                                             mu2<9mumu                                              mu2<9mumu                                             JTbJTbmumu2<92<9mumumu                                         JTbJTbJTbJTbrOrO2<9mumumu                                        JTbJTbJTbJTbrOrO2<9mumumu                                               JTbJTbJTbJTbJTbrOrO2<9mumu2<9                                ~~~~~~~~~~JTbJTbrOrO2<9mumumu                                             JTbJTbmumu2<92<9mumumu                                             JTbJTbmumu2<92<9mumumu                                             JTbJTbmumu2<92<9mumumu                                            JTbJTbJTbJTbrOrO2<9mumumu                                         JTb2<9JTbJTbrOrOrO2<9mu                                         JTb2<9JTbJTbrOrOrO2<9mu                                                 JTb2<9JTbJTbrOrOrO2<9mu2<9                                  ~~~~~~~~~rOrO2<9mu                                              JTbJTbJTbJTbrOrO2<9mumumu                                             JTbJTbJTbJTbrOrO2<9mumumu                                             JTbJTbJTbJTbrOrOmumumumu                                            JTb2<9JTbJTbrOrO2<9mumu                                       2<92<9iJTb],(],(                                   2<92<92<9      2<92<9iJTb],(],(                                                  2<92<9iJTb],(],(                                    ~~~~~~~~~],(                                               JTb2<92<9JTbJTbrOrOrO2<9mu                                            JTb2<9JTbJTbrOrOrO2<9mu                                             JTb2<9JTbJTbrOrOrO2<9mu2<9                                            2<92<9iJTb],(],(                                         2<9irO],(],(                                    ii2<92<9      2<9irO],(],(                                                    2<9irO],(],(                                     ~~~~~~~                                              2<92<9iJTb],(],(                                               2<92<9iJTb],(],(                                               2<92<9iJTb],(],(                                               2<9irO],(],(                                         2<9rO],(                                    iii        2<9rO],(                                           2<92<9        2<9rO],(                                     ~~~~~~~                                            2<9irO],(],(                                                2<9irO],(],(                                                2<9irO],(],(                                                2<9rO],(                                           ],(rO                                     iiuG],(        ],(rO                                             2<9ii],(        ],(rO                                          ~~~                                         2<9rO],(                                                 2<9rO],(                                                 2<9rO],(~~~                                              ],(rO                                         H6H6H6 %] %]rOrO],(],(                                2<9],(],(],(],(    H6H6H6 %] %]rOrO],(],(                                       2<9iiiuG],(    H6H6H6 %] %]rOrO],(],(                                                                               JTbJTbJTbJTb ],(rO                                             JTbJTbJTbJTb  ],(rO                                                JTbJTbJTb],(rO~~~~~~~                                        H6H6H6 %] %]rOrO],(],(                                   2<92<9  ],(H6H6H6 %]tttG],(],(                           ],(],(],(b  H6H6H6H6ttttG],(],(                                      ii],(],(bbbbH6H6H6ttttG],(],(                                        JTbJTb                             JTbJTbJTb],(],(],(],(],(                                           JTbJTbJTbJTb],(],(],(],(],(                                              JTbJTb],(],(],(],(],(~~~~~~~~~                                     bH6H6H6ttttG],(],(                              i2<92<9  bH6H6H6H6ttttt],(],(JTbB$3B$3JTb                               bbbbH6H6H6H6ttttt],(],(muB$3B$3B$3mumu                                     2<9],(],(bbbbbH6H6ttttt],(],(                                       JTbB$3GH6H6H6                           JTbB$3B$32<9GH6H6H6H6                                           JTbB$3B$32<92<9GGH6H6H6H6                                              JTbB$3GGH6H6H6H6~~~~~~~~~~                                   bbbH6H6ttttt],(],(                            iii2<9  bbb],(],(],(ttttt2<92<9B$3B$3B$3B$3B$3B$3                              bbbbb],(],(],(ttttt2<92<9B$3B$3B$3B$3B$3B$3B$3                                        bbbb],(],(tttttB$3B$3mumu                                     JTbB$3B$32<9GH6H6H6H6H6                         JTbB$3B$3JTbJTbJTbGH6H6bbbb                                 JTbB$3B$3JTbJTbJTbJTbGGH6H6bbbb                                           JTbB$3B$3JTb],(],(],(],(bbb~~~~~~~~~~                                bbbbb],(],(tttttB$3B$3mumu                           iii],(],(bbbb %]GGGGG2<92<92<9B$3B$3B$3B$3B$3B$3B$3                                bbb %]GGGGG2<92<9B$3B$3B$3B$3B$3B$3B$3                                          bb],(GGGGGB$3B$3B$3B$3B$3                                     JTbB$3B$3JTbJTbGGH6bbb                           JTbB$3B$3JTbJTbJTbGGH6bbbbb],(],(iii                                 JTbB$3B$3JTbJTbJTbJTbGGGGbbbbbb],(                                         JTbB$3B$3iii],(],(],(bbbb~~~~~~~~                              ],(],(],(bb],(GGGGGB$3B$3B$3B$3B$3                           2<9i],(],(],(bbbbGGGGG2<9],(],(uGuGB$3B$3B$3                                    GGGGG2<9],(uGuGB$3B$3B$3                                             GGGGGB$3B$3B$3B$3B$3                                     JTbB$3B$3JTbJTbGGbbbbbb],(],(],(ii2<9                        JTbB$3B$3JTbJTbJTbGGGbbbbb],(],(iii                                  JTbB$3B$3JTbJTbJTbJTbGGGGbbbbbb],(                                         JTbB$3iii],(],(],(bbbbb~~~~~                             iii],(   GGGGGB$3B$3B$3B$3B$3                             ],(bbb   GGGGG2<9],(],(uGuGB$3B$3B$3                                    GGGGG],(uGuGB$3B$3B$3                                              GGGGG],(uGB$3B$3B$3                                     JTbB$3B$32<9GGGGbbbbb],(],(],(iii2<9                            JTbB$3B$32<92<92<9GGGGbbbb],(],(],(rOi                                    JTbB$3B$32<92<92<92<9GGGGbbbb                                         ~~                            i     GGGGG],(uGB$3B$3B$3                                      %] %] %]GGGGB$3B$3B$3B$3B$3B$3B$3JTb                                       %] %]GGGG B$3B$3B$3B$3B$3B$3JTbmu                                               %] %]GGGGB$3uGB$3B$3B$3                                      JTbB$3B$3GGGG %] %]bbb],(],(],(rOii2<92<9                                   JTbB$3B$3B$3GGGG %] %] %] %]                                           JTbB$3B$3B$3B$3GGGGG %] %] %]                                                                         %] %]GGGGB$3uGB$3B$3B$3                                      %] %] %]GGGG B$3B$3B$3B$3B$3B$3JTbJTb                                       %] %]GGGG  B$3B$3B$3B$3B$3mu                                               %] %] %]GGGGB$3B$3B$3B$3B$3JTbmu                                      JTbJTbB$3GGG %] %] %] %]                                            JTbJTbB$3B$3GGG %] %] %] %]                                            JTbJTbB$3B$3B$3GGGG %] %] %]                                                                        %] %] %]GGGGB$3B$3B$3B$3B$3JTbmu                                     ],(],(],(],(B$3B$3   JTbJTbJTbJTb                                        ],(],(],(],(],(B$3B$3B$3  JTbJTbJTbJTb                                               ],(],(],(],(B$3B$3B$3B$3B$3B$3B$3B$3B$3mu                                         JTb],(],(],(],(B$3B$3B$3                                               JTbJTb],(],(],( %] %] %]                                              JTbJTbJTb],(],(],( %] %] %]                                                                         ],(],(],( %] %] %]B$3B$3B$3B$3B$3B$3B$3mu                                      H6H6H6H6],(B$3B$3B$3                                              H6H6H6H6B$3B$3B$3B$3                                                    ],(H6H6H6H6B$3B$3B$3B$3 JTbJTbJTbJTb                                          ],(H6H6H6H6B$3B$3B$3                                               ],(H6H6H6H6B$3B$3B$3                                               ],(H6H6H6H6B$3B$3B$3                                                                                ],(H6H6H6H6B$3B$3B$3B$3JTbJTbJTbJTb                                       H6H6H6H6H6B$3B$3],(                                              H6H6H6H6B$3],(],(],(],(                                                  ],(],(H6H6H6H6],(],(],(                                              ],(],(H6H6H6H6],(],(],(],(                                             ],(],(H6H6H6H6],(],(],(],(                                             ],(],(H6H6H6H6],(],(],(],(                                                                                      ],(],(H6H6H6H6],(],(],(B$3                                           H6H6H6H6],(],(],(                                             H6H6H6],(],(],(],(],(                                                 ],(H6H6H6],(B$3],(],(                                              ],(H6H6H6],(B$3],(],(],(                                             ],(H6H6H6],(B$3],(],(],(                                             ],(H6H6H6],(B$3],(],(],(                                             ],(H6H6H6],(B$3],(],(],(                                             ],(H6H6H6],(B$3],(],(],(                                          ],(H6H6],(   ],(],(],(                                             H6H6H6],(  ],(],(],(                                                H6H6H6H6],(  B$3B$3],(],(                                             H6H6H6H6],(   B$3],(],(],(                                            H6H6H6H6],(   B$3],(],(],(                                            H6H6H6H6],(   B$3],(],(],(                                            H6H6H6H6],(   B$3],(],(],(                                            H6H6H6H6],(   B$3],(],(],(                                          ],(H6H6],(    ],(],(],(                                            ],(H6H6    B$3],(],(],(                                              ],(H6H6H6],(    B$3],(],(                                            ],(H6H6H6],(     ],(],(],(                                           ],(H6H6H6],(     ],(],(],(                                           ],(H6H6H6],(     ],(],(],(                                           ],(H6H6H6],(     ],(],(],(                                           ],(H6H6H6],(     ],(],(],(                                          ],(H6H6      B$3],(],(                                            ],(H6H6     B$3],(],(],(                                             ],(H6H6      ],(],(],(H6                                           ],(H6H6       ],(],(H6                                           ],(H6H6       ],(],(H6                                           ],(H6H6       ],(],(H6                                           ],(H6H6       ],(],(H6                                           ],(H6H6       ],(],(H6                                          bbb      B$3H6H6H6                                           bbb      B$3H6H6H6                                           bbbH6       H6H62<9                                          bbbH6       H6H62<9                                          bbbH6       H6H62<9                                          bbbH6       H6H62<9                                          bbbH6       H6H62<9                                          bbbH6       H6H62<9                                          2<92<9       2<92<92<9                                           2<92<9       2<92<9                                           2<92<9b       2<92<9                                          2<92<9b       2<92<9                                          2<92<9b       2<92<9                                          2<92<9b       2<92<9                                          2<92<9b       2<92<9                                          2<92<9b       2<92<9                                          2<92<9       2<92<9                                           2<92<9       2<92<9                                           2<92<92<92<9       2<92<9                                          2<92<92<92<9       2<92<9                                          2<92<92<92<9       2<92<9                                          2<92<92<92<9       2<92<9                                          2<92<92<92<9       2<92<9                                          2<92<92<92<9       2<92<9                                         2<92<92<9       2<92<9                                          2<92<92<9        2<92<9                                         2<92<92<9        2<92<92<9                                        2<92<92<9        2<92<92<9                                        2<92<92<9        2<92<92<9                                        2<92<92<9        2<92<92<9                                        2<92<92<9        2<92<92<9                                        2<92<92<9        2<92<92<9                                        2<92<92<9       2<92<92<9                                         2<92<92<9        2<92<9                                         2<92<92<9        2<92<92<9                                       2<92<92<9        2<92<92<9                                       2<92<92<9        2<92<92<9                                       2<92<92<9        2<92<92<9                                       2<92<92<9        2<92<92<9                                       2<92<92<9        2<92<92<9                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 muJTb                                                                                                                                                                                                         muJTb                                              JTbJTb                                                JTbJTb                                                 muJTb                                              mumuJTbmu                                            JTbJTb                                                JTbJTb                                                 muJTb                                              mumuJTbmu                                              mu2<9JTbmu                                              JTbJTb                                               muJTbJTbmu                                             JTbJTbmumuJTb2<9mumumu                                            mu2<9JTbmu                                              JTbJTb                                               muJTbJTbmu                                             JTbJTbmumuJTb2<9mumumu                                             JTbJTbmumu2<92<9mumumu                                              mu2<9mumu                                              JTbJTbmumu2<92<9mumumu                                            mumumuJTbJTbrOrO2<9mumumu                                          JTbJTbmumu2<92<9mumumu                                             mu2<9mumu                                              JTbJTbmumu2<92<9mumumu                                            mumumuJTbJTbrOrO2<9mumumu                                            JTbJTbJTbJTbrOrO2<9mumumu                                             JTbJTbmumu2<92<9mumumu                                            JTbmuJTbJTbJTbrOrO2<9mumu                                            JTb2<9JTbJTbrOrOrO2<92<9                                           JTbJTbJTbJTbrOrO2<9mumumu                                           JTbJTbmumu2<92<9mumumu                                            JTbmuJTbJTbJTbrOrO2<9mumumu                                             JTb2<9JTbJTbrOrOrO2<92<9                                             mu2<9JTbJTbrOrOrO2<9mu                                            JTbJTbJTbJTbrOrO2<9mumumu                                            mumu2<9JTbJTbrOrOrOmumu                                            2<92<9iJTb],(],(                                             mu2<9JTbJTbrOrOrO2<9mu                                          JTbJTbJTbJTbrOrO2<9mumu                                           mumu2<9JTbJTbrOrOrO2<9mu                                             2<92<9iJTb],(],(                                               2<92<9iJTb],(],(                                              mumu2<9JTbJTbrOrOrO2<9mu                                             2<92<9iJTb],(],(                                              2<9irO],(],(                                             2<92<9iJTb],(],(                                            mumu2<9JTbJTbrOrOrOmumu                                            2<92<9iJTb],(],(                                                2<9irO],(],(                                                2<9irO],(],(                                               2<92<9iJTb],(],(                                                2<9irO],(],(                                              2<9rO],(                                             2<9irO],(],(                                             2<92<9iJTb],(],(                                              2<9irO],(],(                                                 2<9rO],(                                             2<9rO],(                                                2<9irO],(],(                                                 2<9rO],(                                               ],(rO                                               2<9rO],(                                              2<9irO],(],(                                              2<9rO],(                                                  ],(rO  JTbJTb                                         ],(rO                                              2<9rO],(                                                  ],(rO                                               ],(],(],(],(rOrOJTbJTb                                               ],(rO                                               2<9rO],(                                               ],(rO                                            H6H6H6],( %]rOrO],(],( B$3B$3JTb                                       H6H6H6],(rOrO],(],( JTbJTb                                         ],(rO                                                  ],(],(],(rOrO],(                                              ],(],( %]H6H6H6H6G 2<92<92<92<92<9                                          ],(],(rOrO                                                 ],(rO                                              H6H6H6],( %]rOrO],(],(JTbJTb                                     bbH6H6H6],(tttG],(JTbB$3B$3B$3B$3B$3B$3                                     H6H6H6H6],(ttG],( B$3B$3JTb                                       H6H6H6],(rOrO],(],(                                            ],(H6H6H6GGG                                          JTbJTbJTb %]H6H6H6H6G  iii                                          ],(H6H6H6GG                                            ],(],(],(rOrO],(],(                                          H6H6H6H6],(tttG],(B$3B$3JTb                                   bbbbH6H6H6],(tttt],(JTbB$3uGuGB$3B$3B$3B$3                                   bbbH6H6H6],(ttt],(JTbB$3B$3B$3B$3B$3B$3                                     H6H6H6H6],(ttG],(JTb                                         H6H6H6H6GGG                                         JTbJTbJTbJTb %]],(bbbbbb],(],(],(iirO                                         JTb %]H6H6H6H6G2<92<92<92<9                                         ],(H6H6H6GGG],(                                       bbbH6H6H6],(tttt],(B$3B$3B$3B$3B$3B$3                                  bbbbb],(],(ttttt2<9JTbB$3uGuGB$3B$3B$3                                   bbbbtttttt2<9JTbB$3B$3B$3B$3B$3B$3B$3                                    bbH6H6H6],(tttB$3JTb                                         H6H6bbGGG2<92<9ii2<92<9                                        JTbJTbJTb2<9 %]Gbbbbbb],(],(],(iirO                                        JTbJTb %]H6H6bbGiii                                          H6H6H6H6GGG],(JTb                                       bbbb],(],(ttttt2<9B$3uGuGB$3B$3B$3B$3                                  ],(],(b   %] %]GGGG2<92<9],(],(uGuGB$3B$3B$3                                  ],(],(],(b2<9GGGGGG2<92<9B$3uGuGB$3B$3B$3                                   bbbbbtttB$3B$3B$3B$3B$3                                        bbbb],(],(],(iiirO                                         2<92<92<92<9GGGbbb],(],(],(],( 2<9                                         JTbJTb %]],(bbbbb],(],(],(iirO                                          H6H6bbGGG2<92<9ii2<92<9                                     ],(],(],(b2<9 %] %] %]GGGG2<92<9B$3uGuGB$3B$3B$3                                  ],(],(],(2<9 GGGGG2<92<9],(],(B$3B$3B$3B$3B$3JTb                                   ],(iii2<92<9],(uGuGB$3B$3B$3                                  bbbbb2<92<92<9B$3B$3B$3B$3B$3B$3B$3                                        bbbb],(],(],(iirOrO                                          2<92<92<9GGGG %]B$3B$3JTb                                           2<92<9Gbbbbb],(],(],(iirO                                          bbbb],(],(],(iiirOB$3                                     ],(iii2<9],(],(uGuGB$3B$3B$3                                 iii2<9GGGGG B$3B$3B$3B$3B$3JTbJTb                                   ii2<92<92<9],(],(B$3B$3B$3B$3JTb                                   bb],(],(ii2<92<9GGB$3uGuGB$3B$3B$3                                         %] %]bbb],(],(],(iirO                                            2<9 %]GGG %] %]B$3JTb                                             2<92<9GGGbbb],(],(],(B$32<9                                           bbbb],(],(],(iirOrOB$3                                     ii2<9],(],(B$3B$3B$3B$3B$3JTb                                   rOii   JTbJTbJTbJTb                                       rOrO2<9GGGGGG B$3B$3B$3B$3B$3JTbJTb                                   b],(],(],(iii2<9GGG],(uGuGB$3B$3B$3                                         %] %]GG %] %] %]B$3B$3B$3                                            ],(],(GG %] %] %]],(],(JTb                                               GGG %] %]B$3B$3B$3B$3                                           bbbb],(],(iirOB$3B$3                                       rOrO2<9 %] %]GGGGGB$3B$3B$3B$3B$3JTbJTb                                   rOrO2<9  ],(GH6H6H6                                                %]GGGGGG   JTbJTbJTbJTb                                      ],(],(2<9iiiGGGG],(B$3B$3B$3B$3B$3JTb                                         H6H6H6],( %] %] %]],(B$3B$3JTb                                             ],(H6H6H6B$3B$3B$3],(],(],(],(                                               %]GG %] %] %]B$3B$3B$3B$3JTb                                              %]GGGGGB$3B$3B$3JTb                                           ],(],(],(],(GH6H6H6H6 JTbJTbJTbJTb                                          ],(],(],(B$3B$3H6H6H6H6H6H6                                             ],(],(B$3B$3],(H6H6H6                                               rOrOGGGH6H6B$3B$3B$3B$3JTbJTb                                         H6H6H6H6B$3B$3],(],(B$3JTbJTb                                             H6H6H6H6B$3B$3B$3],(],(],(],(                                              H6H6H6H6],(],(B$3B$3B$3JTbJTb                                              %]H6H6H6],(],(B$3B$3B$3JTbJTb                                           ],(],(],(],(H6H6H6H6H6                                               ],(],(],(],(B$3H6H6H6H6H6H6                                       2<92<92<9   ],(],(],(B$3H6H6H6H6                                                ],(],(B$3B$3H6H6H6H6 JTbJTbJTbJTb                                          ],(H6H6H6H6B$3],(],(],(B$3                                        2<92<92<92<9bH6H6H6H6H6H6],(B$3B$3B$3],(],(],(],(                                       2<92<92<9  ],(H6H6H6H6],(],(],(JTbJTb                                               H6H6H6H6],(],(],(JTbJTbJTb                                            ],(],(],(],(],(H6H6H6H6H6                                        2<92<92<92<9H6],(],(],(],(],(],(B$3],(H6H6H6H6H6H6                                      2<92<92<9H6],(],(],(],(],(B$3B$3H6H6H6H6                                               ],(],(],(B$3H6H6H6H6                                               ],(H6H6H6H6],(],(],(],(B$3                                        2<92<92<92<9bH6H6H6H6H6],(],(  B$3],(],(],(],(                                       2<92<92<92<9bH6H6H6H6H6],(],(],(                                                 H6H6H6H6],(],(],(                                               ],(],(],(],(],(H6H6H6H6                                         2<92<92<92<9H6],(],(],(],(],(],(],(  ],(],(H6H6H6                                     2<92<92<9H6],(],(],(],(],(  ],(H6H6H6                                           2<92<92<9B$3B$3],(],(],(H6H6H6H6                                              ],(H6H6H6H62<9H6H6],(],(                                         2<92<9bH6H6H6],(      ],(],(],(],(                                      2<92<92<92<92<9bH6H6H6H6],(],(],(],(                                             2<92<92<9],(],(H6H6H6],(],(],(                                              ],(],(],(],(],(bH6H6H6                                          2<92<9H6],(],(],(],(      ],(H6H6H6                                     2<92<9B$3B$3],(],(],(    ],(H6H6H6                                          2<92<92<9H6],(],(],(],(H6H6H6                                               ],(H6H6H62<92<92<9                                            2<92<9            ],(H6H6                                       2<92<92<9bH6H6H6  B$3],(],(],(                                            2<92<92<9H6H6H6H6H6],(],(                                               ],(],(],(],(2<92<9bb                                           2<92<9            ],(bb                                      2<92<9            ],(H6H6                                         2<92<92<9H6],(],(],(],(H6H6H6                                               H6H6H62<92<92<9                                             2<92<9              2<92<9                                       2<92<9          B$3],(],(                                           2<92<92<9H6H6H6H6],(],(],(                                               ],(],(],(2<92<92<9                                            2<92<9              2<92<9                                                    ],(H6bb                                        2<92<9   B$3B$3B$3H6H6H6                                              bbH6 2<92<92<9                                                             2<92<92<9                                                  B$3],(H6H6                                          2<92<9    ],(],(],(],(                                              H6H6],( 2<92<9                                                             2<92<92<9                                                    b2<92<9                                        2<92<9       bbb                                              2<92<9b                                                                 2<92<92<92<9                                                  H62<92<9                                          2<92<9      bbb                                              2<92<9H6 2<92<9                                                              2<92<92<92<9                                                    2<92<9                                                2<92<9                                              2<92<92<9                                                                 2<92<92<9                                                   2<92<92<9                                                 2<92<9                                              2<92<92<9                                                                 2<92<92<9                                                    2<92<92<92<9                                              2<92<9                                             2<92<9                                                                                                                         2<92<92<92<9                                               2<92<9                                             2<92<9                                                                                                                           2<92<92<92<9                                              2<92<92<9                                            2<92<92<9                                                                                                                         2<92<92<9                                               2<92<92<9                                            2<92<92<9                                                                                                                          2<92<92<9                                               2<92<92<9                                            2<92<92<9                                                                                                                         2<92<9                                                2<92<92<9                                            2<92<92<9                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         JTb                                                   JTb                                                                                                                                                                                                                                                                                                                                                                                   JTbJTb                                               JTbJTb                                                                                                                                                                                                                                                                                                                                                                          mu2<9mumu                                               mu2<9mumu                                                                                                                                                              muJTb                                               JTb                                              JTb                                               mumu                                               JTbJTbmumu2<92<9mumumu                                             JTbJTbmumu2<92<9mumumu                                                                                                                                                          mumuJTb                                             mumuJTb                                              mumumu                                              JTbmumuJTb                                              JTbJTbJTbJTbrOrO2<9mumumu                                            JTbJTbJTbJTbrOrO2<9mumumu                                                                                                                                                       JTbmumu2<92<9mumumu                                             JTbmumu2<92<9mumumu                                              JTbJTbmumu2<92<9mumumu                                            JTbJTbmumu2<92<9mumumu                                             JTbJTb2<9JTbJTbrOrOrO2<9mu                                            JTbJTb2<9JTbJTbrOrOrO2<9mu                                                                                                      muJTb                                               JTbJTbJTbJTbrOrO2<9mumu                                             JTbJTbJTbJTbrOrO2<9mumu                                             JTbJTbJTbJTbrOrO2<9mumu                                             JTbJTbJTbJTbrOrO2<9mumu                                             2<92<9iJTb],(],(                                               2<92<9iJTb],(],(                                                                                                       mumuJTb                                              JTb2<9JTbJTbrOrOrO2<9mu                                             JTb2<9JTbJTbrOrO2<9mumu                                              2<92<9JTbJTbrOrO2<92<9mu                                              2<92<9JTbJTbrOrOrO2<9mu                                              2<9irO],(],(                                                2<9irO],(],(                                                                                                       JTbmumu2<92<9mumumu                                             2<92<9iJTb],(],(                                              2<92<9iJTb],(],(                                                2<9iJTb],(],(                                               2<92<9iJTb],(],(                                                2<9rO],(                                                 2<9rO],(                                                                                                    JTbJTbJTbJTbrOrO2<9mumu                                              2<9irO],(],(                                                2<9irO],(],(                                                2<9irO],(],(                                                2<9irO],(],(                                                  ],(rO                                                   ],(rO                                                                                                   JTb2<9JTbJTbrOrOrO2<9mu                                               2<9rO],(                                                 2<9rO],(                                                 2<9rO],(                                                 2<9rO],(                                              H6H6H6 %] %] %]rOrO],(],(                                           H6H6H6 %] %] %]rOrO],(],(                                           muJTb                                                2<92<9iJTb],(],(                                                ],(rO                                                   ],(rO                                                   ],(rO                                                   ],(rO                                            bbbH6H6H6H6 %]tttG],(],(JTb                                    bbbH6H6H6H6 %]tttG],(],(JTb                                      muJTbJTbmu                                                2<9irO],(],(                                                  %] %] %]rOrO],(],(                                                  %] %] %]rOrO],(],(                                                  %] %] %]rOrO],(],(                                                  %] %] %]rOrO],(],(                                         bbbbbH6H6H6H6ttttt],(],(                                  bbbbbH6H6H6H6ttttt],(],(                                       JTbJTbmumu2<92<9mumumu                                                2<9rO],(                                               H6H6H6],(tttG],(],(                                              H6H6H6],(tttG],(],(                                              H6H6H6],(tttG],(],(                                              H6H6H6],(tttG],(],(                                     ii],(],(],(bbbb],(],(],(ttttt2<92<9],(],(                              ii],(],(],(bbbb],(],(],(ttttt2<92<9],(],(                                      JTbJTbJTbJTbrOrO2<9mumu                                                ],(rO                                               bH6H6H6H6tttt],(],(                                             bH6H6H6H6tttt],(],(                                             bH6H6H6H6tttt],(],(                                             bH6H6H6H6tttt],(],(                                    iiii],(],(],(   %] %] %] %] %] %]2<92<9],(],(uGuG                             iiii],(],(],(   %] %] %] %] %] %]2<92<9],(],(uGuG                                     2<9JTb2<9JTbJTbrOrOrO2<9mu                                                 %] %] %]rOrO],(],(                                             bbbH6H6H6tttt2<92<92<9                                        bbbH6H6H6tttt2<92<92<9                                        bbbH6H6H6tttt2<92<92<9                                        bbbH6H6H6tttt2<92<92<9                                i       %] %] %] %] %]  B$3B$3uGuG                             i       H6H6H6 %] %]  B$3B$3uGuG                                      2<92<9iJTb],(],(                                                H6H6H6],(tttG],(],(                                           bbbbb],(],(GGGG2<92<92<9JTb                                     bbbbb],(],(GGGG2<92<92<9JTb                                     bbbbb],(],(GGGG2<92<92<9JTb                                     bbbbb],(],(GGGG2<92<92<9JTb                                     ],(H6H6H6H6H6 %] %]   B$3B$3B$3B$3JTb                                      %]H6H6H6H6H6   B$3B$3B$3B$3JTb                                       2<9irO],(],(                                               bH6H6H6H6tttt],(],(                                          ],(bbbb %]GGGGG2<92<92<9                                    ],(bbbb %]GGGGG2<92<92<9                                    ],(bbbb %]GGGGG2<92<92<9                                    ],(bbbb %]GGGGG2<92<92<9                                   ],(H6H6H6H6H6],(],(],(    B$3B$3B$3JTbJTb                                    ],(H6H6H6H6H6H6],(],(],(],(  B$3B$3B$3JTbJTb                                        2<9rO],(                                               bbH6H6H6tttt2<92<92<9                                         ],(],(b  %]GGGG %]2<9],(],(                                   ],(],(b  %]GGGG %]2<9],(],(                                   ],(],(b  %]GGGG %]2<9],(],(                                   ],(],(b  %]GGGG %]2<9],(],(                                 ],(H6H6H6H6H6],(],(],(],(    JTbJTbJTb                                     H6H6H6bbbB$3B$3],(],(],(],(  JTbJTbJTb                                          ],(rO                                               bbbb],(],(GGGG2<92<92<9                                        ],(],(],(    %]H6H6H6H6 %] %] B$3B$3],(uGuG                                  ],(],(],(    %]H6H6H6H6 %] %] B$3B$3],(uGuG                                  ],(],(],(    %]H6H6H6H6 %] %] B$3B$3],(uGuG                                  ],(],(],(    %]H6H6H6H6 %] %] B$3B$3],(uGuG                               ],(],(bbbB$3],(],(],(],(                                           H6H6],(2<92<92<9],(],(],(],(                                           H6H6H6 %] %] %]rOrO],(],(                                              bbb %]GGGGG2<92<9                                      iii    H6H6H6H6H6 %] %]  B$3B$3uGuG                                 iii    H6H6H6H6H6 %] %]  B$3B$3uGuG                                 iii    H6H6H6H6H6 %] %]  B$3B$3uGuG                                 iii    H6H6H6H6H6 %] %]  B$3B$3uGuG                                 2<92<92<9],(],(],(],(                                            H6H6],(2<92<92<9],(],(],(                                          ],(H6H6H6H6 %]tttG],(],(                                             bb %]GGGGG2<92<9                                    iii   ],(H6H6H6H6H6],(],(  B$3B$3B$3B$3JTb                                 iii   ],(H6H6H6H6H6],(],(  B$3B$3B$3B$3JTb                                 iii   ],(H6H6H6H6H6],(],(  B$3B$3B$3B$3JTb                                 iii   ],(H6H6H6H6H6],(],(  B$3B$3B$3B$3JTb                                 2<92<92<9],(],(],(                                              ],(],(],(2<92<92<9],(],(],(                                         bbbbH6H6H6ttttt],(],(                                          ],(bb %] %] %] %] %] %] %]2<92<9B$3JTb                                     i  ],(H6H6H6H6],(],(],(    B$3B$3B$3JTbJTb                                  i  ],(H6H6H6H6],(],(],(    B$3B$3B$3JTbJTb                                  i  ],(H6H6H6H6],(],(],(    B$3B$3B$3JTbJTb                                  i  ],(H6H6H6H6],(],(],(    B$3B$3B$3JTbJTb                                   2<92<92<9],(],(],(                                                  2<92<92<9H6H6                                          bbbbb],(],(ttttt2<92<9                                        ],(],(],(],(H6H6H6H6 %] %]],(],(B$3B$3B$3                                       bbH6H6],(],(],(],(     JTbJTbJTb                                      bbH6H6],(],(],(],(     JTbJTbJTb                                      bbH6H6],(],(],(],(     JTbJTbJTb                                      bbH6H6],(],(],(],(     JTbJTbJTb                                      2<92<92<9],(],(                                                    2<9                                          bbbbbb %] %] %] %] %] %]2<9B$3B$3JTb                                        ],(],(],(H6H6H6H6H6],(],(],(],(],(B$3B$3B$3B$3                                       2<92<9bb],(],(],(],(                                              2<92<9bb],(],(],(],(                                              2<92<9bb],(],(],(],(                                              2<92<9bb],(],(],(],(                                                  2<9H6H6                                                                                                bbb  %] %] %] %] %]B$3B$3B$3B$3B$3                                       ],(iiH6H6H6H6H6],(],(],(uGuGB$3B$3B$3                                      2<92<92<9B$3],(],(],(                                              2<92<92<9B$3],(],(],(                                              2<92<92<9B$3],(],(],(                                              2<92<92<9B$3],(],(],(                                                                                                                                                    ],(],(],(   %] %]GGG %] %]B$3B$3B$3B$3B$3B$3                                       iiH6H6H6],(],(],(],(uGuGB$3B$3B$3                                       2<92<9B$3],(],(],(                                                2<92<9B$3],(],(],(                                                2<92<9B$3],(],(],(                                                2<92<9B$3],(],(],(                                                                                                                                                     ],(],(],(   %] %]GGGGGuGuGB$3B$3B$3                                       iiH6],(],(],(],(B$3B$3B$3B$3B$3JTb                                         2<92<9B$3],(],(],(                                                 2<92<9B$3],(],(],(                                                 2<92<9B$3],(],(],(                                                 2<92<9B$3],(],(],(                                                                                                                                                          ],(],(i ],(],(],(],(B$3B$3],(],(],(B$3B$3B$3                                        i ],(],(],(B$3B$3B$3B$3JTbJTb                                         2<92<92<9],(],(                                                  2<92<92<9],(],(                                                  2<92<92<9],(],(                                                  2<92<92<9],(],(                                                                                                                                                           iiH6H6H6H6],(B$3B$3],(],(],(],(],(B$3JTb                                          2<9bH6 JTbJTbJTbJTb                                              ],(],(                                                     ],(],(                                                     ],(],(                                                     ],(],(                                                                                                                                                            iiB$3B$3],(],(],(],(],(JTbJTb                                         2<9bb B$3],(                                                  H6H6                                                     H6H6                                                     H6H6                                                     H6H6                                                                                                                                                                i H6B$3],(],(],(],(                                           2<92<9  ],(],(],(                                                  2<92<9                                                     2<92<9                                                     2<92<9                                                     2<92<9                                                                                                                                                                  H6H6H6],(   ],(],(                                           2<92<92<9  ],(],(                                                   2<92<92<9                                                     2<92<92<9                                                     2<92<92<9                                                     2<92<92<9                                                                                                                                                                 bbb],(      H6H6                                           2<92<92<9  H6H6                                                    2<92<92<9                                                     2<92<92<9                                                     2<92<92<9                                                     2<92<92<9                                                                                                                                                                 2<92<9],(      2<92<9                                           2<92<92<9  2<92<9                                                    2<92<92<9                                                     2<92<92<9                                                     2<92<92<9                                                     2<92<92<9                                                                                                                                                                 2<92<9       2<92<9                                                2<92<9                                                                                                                                                                                                                                                                                                                                                                                               2<92<92<9       2<92<9                                                2<92<9                                                                                                                                                                                                                                                                                                                                                                                               2<92<92<9       2<92<92<9                                                2<92<92<9                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    muJTb                                                                                                                                                                                                                                                                                                                                                                                                                                           muJTbmu                                              JTb                                                                                                      JTb                                                   JTb                                                                                                                                                                                                                          JTbJTbmumu2<92<9mumumu                                             JTbJTb                                                muJTb                                               muJTbJTb                                             muJTb                                                                                                                                                                                                                       JTbJTbJTbJTbJTbrOrO2<9mumumu                                           JTbmu2<9mu                                             JTbmuJTbmu                                            JTbJTbmuJTbmu                                           JTbJTbmuJTbmu                                                                                                                                                                                                                JTbJTb2<9JTbJTbrOrOrO2<9mu                                            JTbJTbmumu2<92<9mumumu                                           JTbJTbJTbmumu2<92<9mumumu                                            JTbJTbJTbmumuJTbJTbmumumu                                             JTbJTbmumu2<92<9mumumu                                               JTb                                                                                                                                                                  2<92<9iJTb],(],(                                              JTbJTbJTbJTbrOrO2<9mumu                                             JTbJTbJTbJTbrOrO2<9mumu                                              JTbJTbJTbJTbrOrO2<9mumu                                              JTbJTbJTbJTbrOrO2<9mumu                                              muJTb                                                                                                                                                                 2<9irO],(],(                                              JTb2<9JTbJTbrOrOrO2<9mu                                              JTb2<9JTbJTbrOrOrO2<9mu                                               JTb2<9JTbJTbrOrOrO2<9mu                                               JTb2<9JTbJTbrOrOrO2<9mu                                               muJTbJTbmu                                                                                                                                                                 2<9rO],(                                               2<9iJTb],(],(                                                2<9iJTb],(],(                                                2<9iJTb],(],(                                                2<9iJTb],(],(                                               JTbJTbmumu2<92<9mumumu                                                                                                                                                              ],(rO                                                2<9irO],(],(                                                2<9irO],(],(                                                2<9irO],(],(                                                2<9irO],(],(                                              JTbJTbJTbJTbJTbrOrO2<9mumumu                                                                                                                                                        H6H6H6 %] %] %]rOrO],(],(                                             2<9rO],(                                                 2<9rO],(                                                 2<9rO],(                                                 2<9rO],(                                               JTb2<9JTbJTbrOrOrO2<9mu                                                                                                      muJTb                                           bbbbH6H6H6 %]tttG],(],(JTb                                          ],(rO                                                   ],(rO                                                   ],(rO                                                   ],(rO                                                2<92<9iJTb],(],(                                                                                                      muJTbJTbmu                                         bbbbbH6H6H6ttttt],(],(                                      H6H6H6 %] %] %]rOrO],(],(    2<9                                     H6H6H6 %] %] %]rOrO],(],(    2<9                                     H6H6H6 %] %] %]rOrO],(],(    2<9                                     H6H6H6 %] %] %]rOrO],(],(    2<9                                       2<9irO],(],(                                                                                                   JTbJTbmumu2<92<9mumumu                                      ii],(],(],(bb],(],(],(ttttt2<92<9],(],(                                    bbbH6H6 %]tttG],(],(  2<92<9                                  bbbH6H6 %]tttG],(],(  2<92<9                                  bbbH6H6 %]tttG],(],(  2<92<9                                  bbbH6H6 %]tttG],(],(  2<92<9                                      2<9rO],(  2<92<9                                       muJTb                                               JTbJTbJTbJTbrOrO2<9mumu                                     iiii],(],(bbGGGG2<92<9],(],(uGuG                                  bbbbbH6H6ttttt],(],( B$3B$3JTb                                bbbbbH6H6ttttt],(],( B$3B$3JTb                                bbbbbH6H6ttttt],(],( B$3B$3JTb                                bbbbbH6H6ttttt],(],( B$3B$3JTb                                       ],(rO  2<92<9                                     muJTbJTb                                              JTb2<9JTbJTbrOrOrOmumumu                                     i        %]GGG %] B$3B$3uGuG                                  bbbbbb],(ttttt2<92<92<9B$3B$3B$3B$3B$3B$3                               bbbbbb],(ttttt2<92<92<9B$3B$3B$3B$3B$3B$3                               bbbbbb],(ttttt2<92<92<9B$3B$3B$3B$3B$3B$3                               bbbbbb],(ttttt2<92<92<9B$3B$3B$3B$3B$3B$3                                  H6H6H6 %] %] %]rOrO],(],( 2<9                                     JTbmumumu2<92<9mumu                                              2<92<9iJTb],(],(                                                %] %] %] %]GGGB$3B$3B$3B$3JTb                                  ],(],(],(bbb %] %]GGGG2<92<92<9B$3rOrOB$3B$3B$3B$3                               ],(],(],(bbb %] %]GGGG2<92<92<9B$3rOrOB$3B$3B$3B$3                               ],(],(],(bbb %] %]GGGG2<92<92<9B$3rOrOB$3B$3B$3B$3                               ],(],(],(bbb %] %]GGGG2<92<92<9B$3rOrOB$3B$3B$3B$3                                 bbbH6H6 %]tttG],(],(                                     JTbJTbJTbJTbrO2<9mumu                                               2<9irO],(],(                                              ],(H6H6H6H6],(],(],(],(],( B$3B$3B$3JTbJTb                                  ],(],(],(  GGGGG2<92<9],(],(],(rOrOB$3B$3B$3                               ],(],(],(  GGGGG2<92<9],(],(],(rOrOB$3B$3B$3                               ],(],(],(  GGGGG2<92<9],(],(],(rOrOB$3B$3B$3                               ],(],(],(  GGGGG2<92<9],(],(],(rOrOB$3B$3B$3                               bbbbbH6H6ttttt],(],(B$3B$3B$3B$3B$3B$3                                     JTb2<9JTbJTbrOrO2<9mumu                                                2<9rO],(                                             ],(H6H6H6H6H6],(],(],(],(  JTbJTbJTb                                   iii  GGGGG2<9],(],(],(rOuGB$3B$3B$3                               iii  GGGGG2<9],(],(],(rOuGB$3B$3B$3                               iii  GGGGG2<9],(],(],(rOuGB$3B$3B$3                               iii  GGGGG2<9],(],(],(rOuGB$3B$3B$3                               bbbbbb],(ttttt2<92<9B$3B$3B$3B$3B$3B$3                                     2<92<9iJTb],(mumu                                                  ],(rO                                               ],(],(H6H6H6H6H6],(],(],(                                        ii   %] %]GGGGG2<9],(],(B$3B$3B$3B$3B$3B$3JTb                                ii   %] %]GGGGG2<9],(],(B$3B$3B$3B$3B$3B$3JTb                                ii   %] %]GGGGG2<9],(],(B$3B$3B$3B$3B$3B$3JTb                                ii   %] %]GGGGG2<9],(],(B$3B$3B$3B$3B$3B$3JTb                                bbbbbb %] %]GGGG2<92<9B$3B$3B$3B$3B$3B$3B$3                                     2<92<9irO],(],(                                              H6H6H6 %] %] %]rOrO],(],(                                                ],(H6H6H6H6],(],(                                          i  GGGGG],(],(],(  B$3B$3B$3B$3B$3B$3JTbJTb                                 i  GGGGG],(],(],(  B$3B$3B$3B$3B$3B$3JTbJTb                                 i  GGGGG],(],(],(  B$3B$3B$3B$3B$3B$3JTbJTb                                 i  GGGGG],(],(],(  B$3B$3B$3B$3B$3B$3JTbJTb                                 ],(],(],(GGGGG2<9B$3rOrOB$3B$3B$3B$3                                       2<9rO],(                                              H6H6H6H6 %]tttG],(],(                                                ],(H6H6H6                                             H6H6H6H6],(],(],(],(],(   JTbJTbJTbJTb                                      H6H6H6H6],(],(],(],(],(   JTbJTbJTbJTb                                      H6H6H6H6],(],(],(],(],(   JTbJTbJTbJTb                                      H6H6H6H6],(],(],(],(],(   JTbJTbJTbJTb                                    ],(],(],(GGGGG],(],(],(rOrOB$3B$3B$3                                        ],(rO                                              H6H6H6H6H6ttttt],(],(                                               H6H6H6                                            H6H6H6H6],(],(],(],(],(                                            H6H6H6H6],(],(],(],(],(                                            H6H6H6H6],(],(],(],(],(                                            H6H6H6H6],(],(],(],(],(                                            iii %] %]GGGGG],(],(],(rOuGB$3B$3B$3                                        %] %] %]rOrO],(],(                                             bbb],(],(ttttt2<9                                              bbb                                             ],(H6H6H6H6],(],(],(],(                                             ],(H6H6H6H6],(],(],(],(                                             ],(H6H6H6H6],(],(],(],(                                             ],(H6H6H6H6],(],(],(],(                                            iiiGGGGG],(],(B$3B$3B$3B$3B$3B$3JTb                                     H6H6H6H6 %]tttG],(],(                                            bbb %] %] %] %] %] %]2<9B$3B$3B$3JTb                                              2<92<92<9                                                 H6H6H6H6],(],(                                               H6H6H6H6],(],(                                               H6H6H6H6],(],(                                               H6H6H6H6],(],(                                             iiGG B$3B$3B$3B$3B$3B$3JTbJTb                                    H6H6H6H6H6ttttt],(],(                                          bbb %] %]GG %]B$3B$3B$3B$3B$3B$3                                             2<92<9                                                  H6H6H6H6B$3                                                 H6H6H6H6B$3                                                 H6H6H6H6B$3                                                 H6H6H6H6B$3                                                H6H6],(   JTbJTbJTbJTb                                      H6H6H6H6],(ttttt2<92<9                                        bbb %] %]GGGGB$3B$3B$3B$3B$3B$3B$3                                             2<92<92<9                                                  H6H6H6B$3                                                  H6H6H6B$3                                                  H6H6H6B$3                                                  H6H6H6B$3                                                H6H6H6H6H6],(],(                                            bbH6H6 %] %] %] %] %] %]2<9B$3B$3JTb                                        bbbbGGGGG2<9uGuGB$3B$3B$3                                              2<92<92<9                                                  H6H6H6H6                                                  H6H6H6H6                                                  H6H6H6H6                                                  H6H6H6H6                                                ],(H6H6H6H6],(],(],(],(                                            bbb %] %] %] %] %]B$3B$3B$3B$3B$3                                        bbb],(],(],(B$3B$3],(],(uGuGB$3B$3B$3                                                                                                  H6H6H6                                                     H6H6H6                                                     H6H6H6                                                     H6H6H6                                                   ],(H6H6H6B$3],(],(],(                                            bbb %] %] %] %] %]B$3B$3B$3B$3B$3B$3B$3                                        bbbH6H6],(B$3B$3],(],(],(],(B$3B$3B$3JTb                                                                                                     bbb                                                     bbb                                                     bbb                                                     bbb                                                    H6H6H6B$3],(],(                                             bbbbH6H6],(B$3B$3],(],(],(],(],(],(B$3                                        H6],(],(],(H6B$3B$3],(],(],(],(],(B$3JTbJTb                                                                                                     2<92<92<9                                                     2<92<92<9                                                     2<92<92<9                                                     2<92<92<9                                                    H6H6H6H6                                             bbbbH6H6B$3B$3B$3],(],(],(],(],(],(B$3                                        H6],(],(],(H6],(],(],(],(],(B$3                                                                                                       2<92<9                                                     2<92<9                                                     2<92<9                                                     2<92<9                                                     H6H6H6                                             H6bbbH6H6B$3B$3B$3B$3],(],(],(],(],(JTb                                         H6],(],(ii   ],(],(],(                                                                                                         2<92<9                                                     2<92<9                                                     2<92<9                                                     2<92<9                                                     H6bb                                             ],(bbbH6H6B$3],(],(],(],(],(JTbJTb                                         H6H6ii   ],(],(                                                                                                         2<92<92<92<9                                                    2<92<92<92<9                                                    2<92<92<92<9                                                    2<92<92<92<9                                                    b2<92<9                                              ],(b],(],(H6H6H6JTb                                          bbbiiH6H6                                                                                                          2<92<92<9                                                     2<92<92<9                                                     2<92<92<9                                                     2<92<92<9                                                     2<92<92<9                                              2<9],(],(],(     2<92<9                                           2<92<9 i                                                                                                                                                                                                                                                                                                                                            2<92<9                                              2<9],(],(],(     2<92<92<9                                           2<92<9       2<9                                                                                                                                                                                                                                                                                                                                          2<92<92<9                                            2<92<9],(],(iii   2<92<92<9                                          2<92<92<9       2<92<9                                                                                                                                                                                                                                                                                                                                           2<92<92<9                                            2<92<92<9iii2<9                                         2<92<92<9       2<92<92<9                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         JTb                                                                                                                                                                                                                                                                                                                                                                                                  JTbJTb                                              JTbJTb                                                                                                                                                                                                                                                                                                                                                                                          mu2<9JTbmu                                           JTb                                                                                                   JTb                                                                                                                                                                                                                                                                                    JTbJTbmumu2<92<9mumumu                                        mumu2<9mu                                              JTb                                                 JTb                                                                                                                                                                                                                                                                                  JTbJTbJTbJTbrOrO2<9mumumu                                        mumumumu2<92<9mumuJTbJTb                                            JTbJTbmu                                              JTbJTbmu                                                                                                                                                                                                                                                                                   JTb2<9JTbJTbrOrOrO2<9mu                                          mumu2<9JTbJTbJTbJTbJTbJTb                                          mumumu2<92<9mumuJTbJTb                                              mumumu2<92<9mumuJTbJTb                                                                                                                                                                                                                                                                                  2<92<9iJTb],(                                             2<92<9rOrOJTbJTbJTb2<9JTb                                           mumu2<9rOrOJTbJTbJTbJTb                                         mumu2<9rOrOJTbJTbJTbJTb                                                                                                                                                                                                                                                                               2<9irO],(],(                                              ],(JTbi2<92<9                                           mu2<9rOrOrOJTbJTb2<9JTb   2<92<9                                  mu2<9rOrOrOJTbJTb2<9JTb   2<92<9                                                                                                                                                                                                                                                                         2<9rO],(                                              ],(],(],(rOi2<9                                              ],(JTbi2<92<9   2<9B$3B$3JTb                                    ],(JTbi2<92<9   2<9B$3B$3JTb                                                                                                                                                                                                                                                                          ],(],(],(                                               ],(rO2<9                                           ],(],(],(rOi2<9   B$3B$3B$3B$3B$3B$3                                   ],(],(],(rOi2<9   B$3B$3B$3B$3B$3B$3                                                                                                                                                                                                                                                                     H6H6H6 %] %] %]rOrO],(],(                                             H6H6],(],(],(],(],(],( 2<9                                    ],(rO2<9],(],(],( B$3B$3uGuGuGB$3B$3B$3                                   ],(rO2<9],(],(],( B$3B$3uGuGuGB$3B$3B$3                                                                                                                                                                                                                                                                     H6H6H6H6 %]tttG],(],(                                       ],(H6H6H6rOrO %]],(],(],(],(],(B$3B$3JTb                                     ],(],(],(H6],(],(],(],(B$3uGuGuGB$3B$3B$3                                    ],(],(],(H6],(],(],(],(B$3uGuGuGB$3B$3B$3                                                                                                                                                                                                                                                                    bbH6H6H6ttttt],(],(2<9                                    bbH6H6H6ttttt],(],(B$3B$3B$3B$3B$3                                   ],(],(H6H6 %]H6H6tt],(],(],(uGuGB$3B$3B$3                                   ],(],(H6H6 %]H6H6tt],(],(],(uGuGB$3B$3B$3                                                                                                                                                                                                                                                                    bbb],(],(ttttt2<9B$3B$3JTb                                    bbb],(],(ttttt2<9],(uGuGuGB$3B$3B$3                                   bb],(],(ttttt2<92<9],(],(],(B$3B$3B$3JTb                                    bb],(],(ttttt2<92<9],(],(],(B$3B$3B$3JTb                                                                                                                                                                                                                                                                     bbb %] %]GGG],(],(B$3B$3B$3                                   bbb %] %]GGGG2<9],(uGuGuGB$3B$3B$3                                   bbb %] %]GGGG2<92<92<92<9B$3B$3B$3JTbJTb                                    bbb %] %]GGGG2<92<92<92<9B$3B$3B$3JTbJTb                                                                                                                                                                                                                                                                     bbbGiuGuGuGB$3B$3B$3B$3                                   bbbbGGGGG],(],(uGuGB$3B$3B$3                                   bbbbGGGGG JTbJTbJTbJTb                                      bbbbGGGGG JTbJTbJTbJTb                                                                                                                                                                                                                                                                       bbb],(],(],(iiiB$3uGuGuGB$3B$3B$3                                    bbbbb],(],(],(iiiB$3B$3B$3B$3B$3B$3JTb                                     bbbbbb],(],(],(iii                                            bbbbbb],(],(],(iii                                                                                                                                                                                                                                                                            bb],(],(],(],(iiiGB$3B$3uGuGB$3B$3B$3                                     bbbb],(],(],(iiiB$3B$3B$3B$3JTbJTb                                      bbbbb],(],(],(iii                                             bbbbb],(],(],(iii                                                                                                                                                                                                                                                                            bb],(],(],(],(iiGGB$3B$3B$3B$3B$3B$3JTb                                      bbbb],(],(],(ii  JTbJTbJTbJTb                                         bbbb],(],(],(ii                                               bbbb],(],(],(ii                                                                                                                                                                                                                                                                                ],(],(],(],(],(B$3B$3B$3B$3B$3B$3B$3JTbJTb                                        ],(],(],(],(],(B$3B$3B$3                                                ],(],(],(],(],(B$3B$3B$3B$3                                               ],(],(],(],(],(B$3B$3B$3B$3                                                                                                                                                                                                                                                                               H6H6H6H6B$3B$3B$3B$3],( JTbJTbJTbJTb                                          H6H6H6H6B$3B$3B$3B$3],(                                               H6H6H6H6B$3B$3B$3B$3],(],(                                              H6H6H6H6B$3B$3B$3B$3],(],(                                                                                                                                                                                                                                                                              H6H6H6H6B$3],(],(],(],(],(                                              H6H6H6H6B$3],(],(],(],(],(                                              H6H6H6H6B$3],(],(],(],(],(],(                                             H6H6H6H6B$3],(],(],(],(],(],(                                                                                                                                                                                                                                                                             H6H6H6],(],(],(],(],(                                              H6H6H6H6B$3],(],(],(],(],(                                             ],(H6H6H6H6],(],(],(],(                                             ],(H6H6H6H6],(],(],(],(                                                                                                                                                                                                                                                                             H6H6H6],(  ],(],(],(],(                                             H6H6H6H6B$3 ],(],(],(],(                                              ],(H6H6H6  ],(],(],(                                              ],(H6H6H6  ],(],(],(                                                                                                                                                                                                                                                                             ],(H6H6    B$3],(],(],(                                             ],(H6H6H6   B$3],(],(],(],(                                              H6H6H6   ],(],(],(],(                                              H6H6H6   ],(],(],(],(                                                                                                                                                                                                                                                                            ],(H6H6     B$3],(],(],(                                            ],(H6H6H6    B$3],(],(],(                                             H6H6H6H6   B$3],(],(],(                                             H6H6H6H6   B$3],(],(],(                                                                                                                                                                                                                                                                            bbb      H6H6H6                                             bbb     H6H6H6                                             bbb     H6H6H6                                             bbb     H6H6H6                                                                                                                                                                                                                                                                            2<92<9      2<92<9                                             2<92<92<9     2<92<9                                             2<92<9     2<92<9                                             2<92<9     2<92<9                                                                                                                                                                                                                                                                            2<92<9      2<92<9                                            2<92<92<9     2<92<9                                            2<92<92<9     2<92<9                                            2<92<92<9     2<92<9                                                                                                                                                                                                                                                                           2<92<92<9      2<92<92<9                                           2<92<92<9     2<92<92<92<9                                           2<92<92<9      2<92<92<92<9                                           2<92<92<9      2<92<92<92<9                                                                                                                                                                                                                                                                          2<92<92<9      2<92<92<9                                           2<92<9      2<92<92<92<9                                           2<92<92<9      2<92<92<92<9                                           2<92<92<9      2<92<92<92<9                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ],(],(],(],(                                                                                                                                                                                                       JTbJTb                                                                                                                                                  JTb                                        mu            ],(],(],(],(],(],(],(],(                                                                                                                                                                                                  mu2<9JTbmu                                                  JTbJTbJTb                                                                                            JTbJTbmumumu                                    JTbmuJTb         B$3B$3B$3],(],(],(],(                       mu                  mumumumu                                                                                                                                                  JTbJTbmumu2<92<9mumumu                                                mu2<9JTbJTbmu                                              JTbJTb                                          muJTbmumuJTbJTb     JTbJTb                               mumumumu          B$3B$3B$3B$3JTb                        mu              muB$3B$3B$3B$3B$3mumu                                                                                                                                               JTbJTbJTbJTbrOrO2<9mumumu                                               JTbJTbmumu2<92<9mumumu                                            mu2<9JTbmumu                                       mumumumumumu      JTb                           mumumumumumurOrOrOrO            B$3JTbJTbJTb                           JTbmu          muB$3B$3],(],(],(],(],(                           JTbJTb                                                                                                              JTb2<9JTbJTbrOrOrO2<9mu                                                JTbJTbJTbJTbrOrO2<9mu                                            JTbJTbmumu2<92<9mumu                                     mumumurOrO                                 mumu2<9muJTbJTbrOH6H6rO        2<92<9                                mumu2<9mumumu2<92<92<9      2<92<92<9  B$3],(],(],(H6H6],(],(],(                                                                                                                                      2<92<9iJTb],(                                                  JTb2<9JTbJTbrOrOrO2<9mu                                             JTbJTbJTbJTbrOrO2<9mu                                    2<92<9muJTbJTbH6H6rO            B$3B$3B$3B$3                     2<92<92<9JTbJTbJTb         2<9                                 JTbJTbmumu2<92<9mumumu2<92<9     2<92<92<9JTb],(],(],(H6H6],(H6H6],(                         JTbJTbmu                                                                                                            2<9irO],(],(                                                  2<92<9iJTb],(                                               JTb2<9JTbJTbrOrOrOmumu                                      JTbJTbJTbJTb               B$3B$3                       2<92<92<9rOrO         2<92<92<9                                 JTbJTbJTbJTbJTbrOrOrOmu        JTb],(],(H6H6],(H6H6H6],(                           JTbmu2<9                                                                                                             2<9rO],(                                                   2<9irO],(],(                                               2<92<9iJTb],(],(                                        2<9rOrO                                          2<92<9rO2<9rO         2<9                                   JTbrOJTbrOrO          JTb],(H6H6H6H6H6                          2<9JTbJTbmumu2<92<9JTb                                                                                                          ],(],(],(                                                     2<9rO],(                                                2<9irO],(],(],(                                     2<9rO2<9rO   2<92<92<92<9                                       2<92<92<9rOrOrO2<92<92<9  ],(],(],(uGuGuG                                     rOJTbrO],(],(           mumuH6H6H6H6                           2<9JTb2<9JTbJTbrOrOmumu                                                                                                  H6H6H6 %] %] %]rOrO],(],(                                               H6H6H6 %] %] %]],(],(],(                                             H6H6H6 %] %]2<9rO],(                                 2<92<92<9rOrOrO2<92<92<92<9],(2<92<9uGuGuG                                      %] %] %]H6H6H6 %]2<92<92<92<9],(],(],(uGuGuGuG                                     2<9rO],(               mu                             2<9rO2<9JTbJTbrOrOmumu2<9          JTbB$3B$3B$3                                                                                       H6H6H6H6 %]tttG],(],(                                              H6H6H6H6 %]tttrO],(],(                                             H6H6H6H6 %] %]],(],(],(  JTbB$3B$3B$3                            H6H6H6 %] %]H6H6H62<92<92<92<9],(2<9],(uGuGuGuG                                  H6H6H6H6 %] %]H6H6 %]2<92<92<92<92<9],(],(uG                                     H6H6H6],(],(rO2<92<92<9                                               rO2<9JTbrOmumu2<9         JTbB$3B$3B$3B$3B$3B$3                                                                                      bbH6H6H6ttttt],(],(                                         bbH6H6H6tttttt],(                                        bbH6H6H6ttttrO],(  JTbB$3B$3B$3B$3B$3B$3                           H6H6H6H6t %]],(H6H6G2<92<92<9],( uG                                     H6H6H6H6ttttt2<92<92<9                                          H6H6H6H6],(rOrOGG2<92<92<92<9],(],(],(                                           %] %]2<9rO],(],(],(           JTbB$3B$3B$3B$3B$3B$3B$3B$3JTb                                                                                     bbb],(],(ttttt2<92<92<9JTbJTb                                    bbb],(],(tttttt2<92<9                                   bbb],(],(ttttt   JTbB$3B$3B$3B$3B$3B$3B$3B$3JTb                         bbH6H6],(tttttt2<92<9                                         bbH6H6],(tttttt                                           bH6H6H6H6tttG %]2<92<92<92<9],(],(uGuGuG                                      H6H6H6 %]2<9rO],(2<92<9          B$3B$3B$3B$3B$3B$3B$3B$3B$3JTb                                                                                     bbb %] %]GGGG2<92<92<92<92<9B$3B$3B$3JTb                                    bbb %] %] %] %] %] %] %]2<92<92<92<9B$3B$3B$3B$3JTb                                  bbb %] %] %] %] %]2<92<92<9],(],(uGuGuGB$3B$3B$3B$3B$3B$3B$3JTb                         bbb],(GtttG %]                                           bbb],( %]GGGG %] %]                                          bbb],(],( %] %] %] %] %] %] %]    ],(uGuGuGuG                                     H6H6H6H6 %] %]rOrO2<92<92<9],(],(        B$3B$3B$3B$3B$3B$3B$3B$3B$3                                                                                      bbbGGGGGG2<92<9],(],(],(B$3B$3B$3B$3                                  bbb %] %]GGGG2<92<92<92<9],(],(],(B$3B$3B$3B$3                                 bb %] %] %] %]2<92<92<92<9],(],(],(uGuGuGB$3B$3B$3B$3B$3B$3B$3                          bbbb %] %]GGGG   ],(],(],(],(                                    bbbb %]GGGGG  ],(],(],(                                     bbbb %] %] %] %] %]GG     uG                                       bH6H6H6H6GGG],(],(2<92<92<92<9],(],(],(        B$3B$3B$3B$3B$3B$3B$3JTb                                                                                      bbbGGGGGG B$3],(uGuGuGB$3B$3B$3                                  bbb],( %] %]GGG %]  2<92<9],(],(uGuGuGB$3B$3B$3                                bbb],(],(],(ii %]2<92<9   ],(],(],(uGuGB$3B$3B$3B$3B$3B$3B$3JTb                          bbbb  %]GGGGG],(],(],(],(],(],(                                    bbbbGGGGGG],(],(],(],(],(],(                                   bbbb %] %]GGGGG                                           bbb],(],( %] %] %] %] %] %]    ],(uGuG         B$3B$3B$3B$3                                                       ],(],(],(],(                              ],(],(],(GGGGGG B$3uGuGuGB$3B$3B$3                                  bb],(],(],(iiGG %]    B$3B$3],(uGuGuGB$3B$3B$3                                bbb],(],(iii2<9 %]           B$3B$3B$3B$3                            bbb],(  %] %]GGG],(],(],(],(],(],(                                    bbb],( %]GGGGGB$3B$3],(],(],(],(H6H6                                  b],(],(],( %] %]GGGGG],(],(                                        bbbbb %] %] %] %] %]GG     2<92<92<9uG                                                                ],(],(],(],(],(],(],(],(                             ],(],(],(GGGGGG B$3uGuGB$3B$3B$3B$3                                   b],(],(iiiuGuGB$3B$3B$3B$3                                bbb],(],(iii %] %]                                            b],(],(],( %] %] %]B$3B$3B$3B$3B$3],(],(],(                                     ],(],(],(  %] %]GG],(B$3B$3B$3B$3B$3],(H62<92<9                                  b],(],(],(  %] %]GG],(],(],(],(],(],(                                      bb],(],(],( %] %] %]GGGG   2<92<9                                                              B$3B$3B$3B$3B$3],(],(],(                              ],(iii],(],(B$3B$3B$3  B$3B$3B$3B$3B$3JTb                                     ],(],(iii B$3B$3B$3B$3B$3JTb                                    ],(],(],(],(],(B$3B$3B$3B$3                                           ],(],(],(  %] %]H6H6H6H6H6H6B$3],(H6H6                                     ],(],(],(   %] %]H6H6H6H6H6],(   2<92<92<9                                  ],(iii  %] %]H6H6H6B$3B$3],(],(],(],(                                      b],(],(],( %] %] %]GGG],(],(],(                                                               B$3B$3B$3B$3JTb                                 iiB$3],( JTbJTbB$3B$3B$3B$3JTbJTb                                      H6H6H6H6B$3B$3],(   JTbJTbB$3B$3B$3B$3JTbJTb                                    H6H6H6H6B$3B$3B$3B$3],(],(                                          ],(],(iii],(H6H6H6H6H6H6H62<92<9                                      ],(],(   ],(H6H6H6H6H6H6],(   2<92<9                                  iii  ],(H6H6H6H6B$3B$3],(],(],(],(                                      ],(iii %] %] %] %]],(],(],(],(],(],(],(                                          GGG              B$3JTbJTbJTb                                     ii  JTbJTbJTbJTb                                        H6H6H6H6B$3],(],(],(],(],(    JTbJTbJTbJTb                                      H6H6H6H6B$3],(],(],(],(],(],(                                           iii],(H6H6H6H6H6H6H62<92<9                                      iii  ],(H6H6H6H6H6H6H6                                         ii   ],(H6H6H6H6H6 B$3B$3],(H6H6                                     iii  %] %]],(H6H6H6],(],(],(],(],(],(                             mu       GGGGGGB$3B$3B$3],(],(                                                  H6H6H6],(],(],(                                              H6H6H6H6B$3],(],(],(],(],(                                             ],(H6H6H6H6],(],(],(],(                                           ii    ],(],(H6H6H6H62<92<9                                     iii    ],(],(H6H6H6H6H6                                              ],(H6H6H6H6H6  ],(H62<92<9                                    ii   ],(],(H6H6H6H6B$3B$3B$3],(],(],(                           mumumumu],(rOrOrO GttGGGGGB$3B$3B$3],(],(],(],(                                                H6H6H6],(  ],(],(],(],(                                             H6H6H6H6B$3 ],(],(],(],(                                              ],(H6H6H6  ],(],(],(                                                   ],(H6H6H6b2<92<9                                     ii       ],(],(H6H6H6b                                               H6H6H6H6b  2<92<92<9                                          ],(H6H6H6H6   B$3],(H6H6                             JTbmumu2<9tttGGGGG],(],(],(B$3B$3],(H62<92<9                                              ],(H6H6    B$3],(],(],(                                             ],(H6H6H6   B$3],(],(],(],(                                              H6H6H6   ],(],(],(],(                                                   H6H6b2<9                                                 H6bb                                                H6bb    2<92<92<9                                          H6H6H6H6    H62<92<9                             mu2<9rOtttGGGGG],(H6H6H6],(],(H62<92<92<92<92<9                                           ],(H6H6     B$3],(],(],(                                            ],(H6H6H6    B$3],(],(],(                                             H6H6H6H6   B$3],(],(],(                                                    b2<92<9                                                  b2<92<9                                                b2<92<9                                                 ],(H6H6b    2<92<92<9                            2<9rOrO],(rO %]ttG %] %] %]G],(H6H6H6H6H6b2<92<9                                            bbb      H6H6H6                                             bbb     H6H6H6                                             bbb     H6H6H6                                                     2<92<92<92<9                                                  2<92<92<92<9                                                2<92<92<92<9                                                ],(bb2<9     2<92<9                           2<92<9rOrO],(rO %] %] %]t %]H6H6H6H6H6b2<92<92<92<92<9                                           2<92<9      2<92<9                                             2<92<92<9     2<92<9                                             2<92<9     2<92<9                                                      2<92<9                                                   2<92<9                                                 2<92<9                                                b2<92<9                                   JTbmumuJTbJTbJTbrO2<9H6H6H6 %]],( %]ii  ],(],(2<92<92<9                                           2<92<9      2<92<9                                            2<92<92<9     2<92<9                                            2<92<92<9     2<92<9                                                      2<92<92<9                                                   2<92<92<9                                                  2<92<9                                                  2<92<9                                   JTbmumumuJTbJTbrOrO2<9H6H6b],(],(iii 2<92<9                                                 2<92<92<9      2<92<92<9                                           2<92<92<9     2<92<92<92<9                                           2<92<92<9      2<92<92<92<9                                                                                                                                                                                                                     2<92<9                                   mumu2<92<92<92<92<92<9H6bb],(],(iiuG2<92<92<92<92<9                                                  2<92<92<9      2<92<92<9                                           2<92<9      2<92<92<92<9                                           2<92<92<9      2<92<92<92<9                                                                                                                                                                                                                     2<92<9                                      2<92<92<92<9   bbb],(],(                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           2<9                                                                                                                                                                                                                                                                                                                                                                                                                                                      ],(],(H62<92<92<92<9                                                                                                                                                                                                                                                                                                                                                                                         GGGB$3B$3                                     murOrOrO           ],(],(],(],(H62<92<92<92<9                                                                                                                                                                                                                                                                                                                                                                                GGGGGGB$3B$3B$3],(],(],(                                JTbJTbmumu2<9          B$3],(],(],(],(H62<92<9                            murOrOrO                                                                                                                                                                                                                                                                                                                                     mu],(rO GttGGGGGB$3B$3B$3],(],(],(],(               JTbJTb             mumurOH6rOGttG   GB$3],(],(],(],(                                 mumumu2<9                    2<9                           2<92<9                                                                                                                                                                                                                                                                                   2<9rOtttGGGGG],(],(B$3B$3],(],(],(H62<9          JTb            mu2<9rOrOH6rOtttG %] %] %]GB$3B$3B$3B$3B$3                                 JTbJTbmumurOH6rO               H62<92<92<92<9                          mumumuH6rO                                                                                                                                                                                                                                                                               JTbJTbmumurOrOtttG %] %]GG],(H6H6H6],(],(],(H62<92<9                    2<92<9rOrOrO %]tttGGGGG],(H6H6H6H6H6b2<92<9                             JTbmu2<9rOrOH6rOGG         ],(],(],(],(H62<92<92<92<9                          mumumuH6                                                                                                                                                                                                                                                                               JTbmu2<9rOrO],(rO %] %]tt %] %]],(],(H6H6H6H6H62<92<92<92<9  B$3B$3B$3B$3                 2<92<9JTbJTbrO],( %]H6tttGGGG],(H6H6H6H6H6b2<92<92<92<92<9                        2<92<9rOrOrO %]GttG   GB$3B$3],(],(],(],(],(2<92<9                           JTbJTbmumurOH6rOGG       ],(],(],(],(                                                                                                                                                                                                                                                                2<92<9rOrOrO],( %]H6bbb  H6H6H6H62<92<9   B$3B$3                     JTbmumuJTbrOrO %]H6H6bbbG %] %]G],(H6H6H6H6H6b2<92<92<92<92<92<9                        2<92<9JTbJTbrO],( %]tttGG %] %]GB$3B$3B$3B$3],(],(],(                               JTbmu2<9rOrOH6rOtttGGG %]G],(],(],(],(],(],(                                                                                                                                                                                                                                                               2<92<9JTbJTbrO],(H6bbb],(],(     ],(H6H6b                            JTbmuJTb2<92<9 %]H6bbbbb %] %]],(],(],(     2<92<9                         JTbmumuJTbrOrO %]H6H6ttGGGGGB$3B$3H6H6H6H6H6b2<92<92<92<9                        2<92<9rOrOrO %]tttGGGGGB$3B$3B$3],(],(],(],(                                                                                                                                                                                                                                                              JTbmumuJTbrOrO2<9H6bb],(],(],(ii   ],(],(b2<92<92<9                             2<92<92<92<92<9H6bbb],(],(2<9                                 JTbmu2<92<92<92<9H6H6tttGGGG],(H6H6H6H6H6H6b2<92<92<92<92<9       JTbJTbJTb           2<92<9JTbJTbrO],( %]H6tttGGGG],(H6H6H6H6H6b2<92<92<9                                                                                                                                                                                                                                                          JTbmumumuJTb2<92<92<9   ],(],(iii 2<92<9    2<92<92<92<92<9                             2<92<92<9    b],(],(],(  2<92<92<9                              JTb2<92<92<92<92<9H6H6bbbGiii],(H6H6H6H6H6H6b2<92<9   JTbJTbB$3B$3B$3           JTbmumuJTbrOrO2<9H6H6bbbGiiG],(H6H6H6H6H6b2<92<92<92<92<9                                                                                                                                                                                                                                                          JTbmumu2<92<92<92<92<9     iii  2<92<92<9    2<92<92<9                                       ],(iii                JTbJTbJTbJTb                2<9    H6bb],(],(iii2<9          B$3B$3B$3                 mumumuJTb2<92<92<9H6H6bb],(],(iii],(H6b2<92<92<92<92<9   JTbJTbJTbJTb                                                                                                                                                                                                                                               mu 2<92<9           2<92<9       2<9                                         iii                B$3B$3B$3B$3B$3                        b],(],(ii2<92<92<9                             JTbmumuJTb2<92<92<92<9H6H6bb],(],(iii2<92<9     B$3B$3B$3B$3B$3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      f                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              f                                                         f                                                                                                                                                                                                                                                                                      f                                                                                                          f                                                         f                                                                                                                                                                                                                                                                                    f                                                                                                            f                                                       ff                                                                                                                                                                                                                                                                                                                           f                                                  f    f                                                                                                                                                                                                                                                                                                                                    f                                                  ff                                                   ff                                                                                                                                                                                                                                                                                                                                          f                                                   f                                                     f                                                                                                                                                                                                                                                                                                                                            f                                                   f                                                     f                                                                                                                                                                                                                                                                                                                                                                                                  f                                                                                                         f         f                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     f                                                  f         f                                                                                                                                                                                                                                                                               f                                                                                                    f                                                   f         f                                                                                                                                                                                                                                                                               f                                                f                                                   f                                                                                                                                                                                                                                                                                                                                           ff                                                fff                                                   f   f                                                                                                                                                                                                                                                                                                                                   ff                                                                                                         f                                                                                                                                                                                                                                                                                                                                ff                                                                                                   f      f                                                                                                                                                                                                                                                                                                                                f                                                                                                     f                                                   f                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        f                                                                                                                                                                                                                                                                                                                                                                                                                                   f                                                                                                                                                                                                                                                                                                                                                                            JTb                                              JTb                                                                                                                                                                                                                                                                                                         JTb                                             JTbJTb                                             JTbJTb                                                                                              JTb                                               JTbJTb                                             JTbJTb                                                   JTb                                                 JTbJTb                                            mu2<9JTbmu                                             mu2<9JTbmu                                            JTbJTb                                            JTbJTb                                             mu2<9JTbmu                                            mu2<9JTbmu                                                JTbJTb                                                mu2<9JTbmu                                    2<92<92<92<92<9   JTbJTbmumu2<92<9mumumu                                       2<92<92<92<92<9 JTbJTbmumu2<92<9mumumu                                            mu2<9JTbmu                                      2<92<92<92<92<9  mu2<9JTbmu                                        2<92<92<92<92<9 JTbJTbmumu2<92<9mumumu                                       2<92<92<92<92<9 JTbJTbmumu2<92<9mumumu                                                mu2<9JTbmu                                              JTbJTbmumu2<92<9mumumu                                    iii    JTbJTbJTbJTbrOrO2<9mumumu                                        iii  JTbJTbJTbJTbrOrO2<9mumumu                                           JTbJTbmumu2<92<9mumumu                                       iii  JTbJTbmumu2<92<9mumumu                                       iii  JTbJTbJTbJTbrOrO2<9mumumu                                        iii  JTbJTbJTbJTbrOrO2<9mumumu                                               JTbJTbmumu2<92<9mumumu                                             JTbJTbJTbJTbrOrO2<9mumumu                                    iiuG],(   JTb2<9JTbJTbrOrOrO2<9mu                                        iiuG],( JTb2<9JTbJTbrOrOrO2<9mu                                       2<92<92<92<92<9 JTbJTbJTbJTbrOrO2<9mumu                                       iiuG],( JTbJTbJTbJTbrOrO2<9mumu                                        iiuG],( JTb2<9JTbJTbrOrOrO2<9mu                                        iiuG],( JTb2<9JTbJTbrOrOrO2<9mu                                               JTbJTbJTbJTbrOrO2<9mumumu                                             JTb2<9JTbJTbrOrOrO2<9mu                                   ii],(],(   2<92<9iJTb],(],(                                          ii],(],( 2<92<9iJTb],(],(                                          iii  JTb2<9JTbJTbrOrOrO2<9mu                                         ii],(],( JTb2<9JTbJTbrOrOrO2<9mu                                         ii],(],( 2<92<9iJTb],(],(                                          ii],(],( 2<92<9iJTb],(],(                                                 JTb2<9JTbJTbrOrOrO2<9mu                                            2<92<9iJTb],(],(                                       2<9],(],(    2<9irO],(],(                                           2<9],(],(  2<9irO],(],(                                          iii],( 2<92<9iJTb],(],(                                           2<9],(],( 2<92<9iJTb],(],(                                           2<9],(],(  2<9irO],(],(                                           2<9],(],(  2<9irO],(],(                                                 2<92<9iJTb],(],(                                                2<9irO],(],(                                      bbb    2<9rO],(                                          bb   2<9rO],(                                          iirO],(  2<9irO],(],(                                          bb  2<9irO],(],(                                          bb   2<9rO],(                                          bb   2<9rO],(                                                  2<9irO],(],(                                                 2<9rO],(                                        bbb     ],(rO                                             bbb   ],(rO                                           iirO],(   2<9rO],(                                            bbb  2<9rO],(                                            bbb   ],(rO                                             bbb   ],(rO                                                    2<9rO],(                                                  ],(rO                                          bbb H6H6H6 %] %]rOrO],(],(                                            bbbH6H6H6 %] %]rOrO],(],(                                          ],(],(b   ],(rO                                             bbbH6  ],(rO                                             bbbH6H6H6 %] %]rOrO],(],(                                            bbbH6H6H6 %] %]rOrO],(],(                                                    ],(rO                                                H6H6H6 %] %]rOrO],(],(                                     bbbbH6H6H6ttttG],(],(                                           bbbH6H6H6ttttG],(],(                                         bbbH6H6H6 %] %]rOrO],(],(                                            bbbH6H6H6 %] %]rOrO],(],(                                            bbbH6H6H6ttttG],(],(                                           bbbH6H6H6ttttG],(],(                                                H6H6H6 %] %]rOrO],(],(                                          ],(H6H6H6 %]tttG],(],(                                 bbbH6H6H6ttttt],(],(                                       bbbH6H6H6ttttt],(],(                                           bbbH6H6H6ttttG],(],(                                           bbbH6H6H6ttttG],(],(                                           bbbH6H6H6ttttt],(],(                                           bbbH6H6H6ttttt],(],(                                               ],(H6H6H6 %]tttG],(],(                                    bH6H6H6H6ttttt],(],(JTbB$3B$3JTb                                  bb],(],(],(ttttt2<92<9                                      bb],(],(],(ttttt2<92<9                                        bbbH6H6H6ttttt],(],(                                            bb],(],(],(ttttt2<92<9                                         bb],(],(],(ttttt2<92<9                                         bb],(],(],(ttttt2<92<9                                           bH6H6H6H6ttttt],(],(JTbB$3B$3JTb                                    bb],(],(],(ttt2<92<9B$3B$3B$3B$3B$3B$3                                  b %]GGGGG2<92<9B$3B$3mumu                                        %]GGGGG2<92<9mu                                        b],(],(],(ttttt2<92<9                                            %]GGGGG2<92<9mu                                          %]GGGGG2<92<9mu                                          %]GGGGG2<92<9mu                                         bb],(],(],(ttt2<92<9B$3B$3B$3B$3B$3B$3                                  iib2<92<92<9B$3B$3B$3B$3B$3B$3B$3                                    GGGGG2<92<9B$3B$3B$3B$3B$3B$3                                        GGGGG2<92<9B$3mumu                                         %]GGGGG2<92<9mu                                          GGGGG2<92<9B$3mumu                                         GGGGG2<92<9B$3mumu                                         GGGGG2<92<9B$3mumu                                       iib2<92<92<9B$3B$3B$3B$3B$3B$3B$3                                 iii2<9GG2<9],(],(uGuGB$3B$3B$3                                    GGGGG2<9B$3B$3B$3B$3B$3B$3                                         GGGGG2<9B$3B$3B$3B$3                                         GGGGG2<92<9B$3mumu                                          GGGGG2<9B$3B$3B$3B$3                                          GGGGG2<9B$3B$3B$3B$3                                          GGGGG2<9B$3B$3B$3B$3                                      iii2<9GG2<9],(],(uGuGB$3B$3B$3                                 iii2<9GGGGG2<9],(],(uGuGB$3B$3B$3                                      %] %]GGGG],(uGuGB$3B$3B$3                                          %]GGGG],(B$3uGB$3B$3B$3                                          GGGGG2<9B$3B$3B$3B$3                                           %]GGGG],(B$3uGB$3B$3B$3                                           %]GGGG],(B$3uGB$3B$3B$3                                           %]GGGG],(B$3uGB$3B$3B$3                                      iii2<9GGGGG2<9],(],(uGuGB$3B$3B$3                               2<9iii2<9  %] %]GGGGGB$3B$3B$3B$3B$3B$3B$3JTb                                       %] %]GGGG],(uGuGB$3B$3B$3                                          %] %]GGGG],(uGuGB$3B$3                                           %]GGGG],(B$3uGB$3B$3B$3                                           %] %]GGGG],(uGuGB$3B$3                                           %] %]GGGG],(uGuGB$3B$3                                           %] %]GGGG],(uGuGB$3B$3                                    2<9iii2<9  %] %]GGGGGB$3B$3B$3B$3B$3B$3B$3JTb                                        %] %] %]GGGG B$3B$3B$3B$3B$3B$3JTbJTb                                      ],(],(],(],(],(B$3B$3B$3B$3B$3B$3B$3JTbmu                                         ],(],(],(],(],(B$3B$3uGB$3B$3B$3                                           %] %]GGGG],(uGuGB$3B$3                                          ],(],(],(],(],(B$3B$3uGB$3B$3B$3                                          ],(],(],(],(],(B$3B$3uGB$3B$3B$3                                          ],(],(],(],(],(B$3B$3uGB$3B$3B$3                                            %] %] %]GGGG B$3B$3B$3B$3B$3B$3JTbJTb                                       ],(],(],(],(B$3B$3   JTbJTbJTbJTb                                        H6H6H6H6],(B$3B$3B$3B$3B$3B$3B$3mu                                          H6H6H6H6],(B$3B$3B$3B$3B$3B$3JTbmu                                          ],(],(],(],(],(B$3B$3uGB$3B$3B$3                                          H6H6H6H6],(B$3B$3B$3B$3B$3B$3JTbmu                                          H6H6H6H6],(B$3B$3B$3B$3B$3B$3JTbmu                                          H6H6H6H6],(B$3B$3B$3B$3B$3B$3JTbmu                                           ],(],(],(],(B$3B$3   JTbJTbJTbJTb                                         H6H6H6H6],(B$3B$3B$3                                              H6H6H6H6B$3B$3B$3B$3B$3JTbJTbJTbJTb                                           H6H6H6H6B$3B$3B$3B$3B$3B$3B$3B$3mu                                           H6H6H6H6],(B$3B$3B$3B$3B$3B$3JTbmu                                          H6H6H6H6B$3B$3B$3B$3B$3B$3B$3B$3mu                                           H6H6H6H6B$3B$3B$3B$3B$3B$3B$3B$3mu                                           H6H6H6H6B$3B$3B$3B$3B$3B$3B$3B$3mu                                            H6H6H6H6],(B$3B$3B$3                                               H6H6H6H6H6B$3B$3],(                                              H6H6H6H6B$3],(],(],(],(                                               H6H6H6H6B$3],(],(],(],(B$3JTbJTb                                            H6H6H6H6B$3B$3B$3B$3B$3B$3B$3B$3mu                                           H6H6H6H6B$3],(],(],(],(B$3JTbJTb                                            H6H6H6H6B$3],(],(],(],(B$3JTbJTb                                            H6H6H6H6B$3],(],(],(],(B$3JTbJTb                                             H6H6H6H6H6B$3B$3],(                                               H6H6H6H6],(],(],(                                             H6H6H6],(],(],(],(],(                                              H6H6H6],(],(],(],(],(                                              H6H6H6H6B$3],(],(],(],(B$3JTbJTb                                            H6H6H6],(],(],(],(],(                                              H6H6H6],(],(],(],(],(                                              H6H6H6],(],(],(],(],(                                               H6H6H6H6],(],(],(                                             ],(H6H6],(   ],(],(],(                                             ],(H6H6],(  ],(],(],(                                              ],(H6H6],(  ],(],(],(                                              H6H6H6],(],(],(],(],(                                              ],(H6H6],(  ],(],(],(                                              ],(H6H6],(  ],(],(],(                                              ],(H6H6],(  ],(],(],(                                              ],(H6H6],(   ],(],(],(                                             ],(H6H6],(    ],(],(],(                                            ],(H6H6    B$3],(],(],(                                             ],(H6H6    B$3],(],(],(                                             ],(H6H6   B$3B$3],(],(],(                                             ],(H6H6    B$3],(],(],(                                             ],(H6H6    B$3],(],(],(                                             ],(H6H6    B$3],(],(],(                                             ],(H6H6],(    ],(],(],(                                            ],(H6H6      B$3],(],(                                            ],(H6H6     B$3],(],(],(                                            ],(H6H6     B$3],(],(],(                                            ],(H6H6    B$3],(],(],(],(                                            ],(H6H6     B$3],(],(],(                                            ],(H6H6     B$3],(],(],(                                            ],(H6H6     B$3],(],(],(                                            ],(H6H6      B$3],(],(                                            bbb      B$3H6H6H6                                           bbb      B$3H6H6                                            bbb      B$3H6H6                                            bbb      B$3H6H6                                            bbb      B$3H6H6                                            bbb      B$3H6H6                                            bbb      B$3H6H6                                            bbb      B$3H6H6H6                                           2<92<9       2<92<92<9                                           2<92<9      2<92<9                                           2<92<9      2<92<9                                           2<92<9      2<92<9                                           2<92<9      2<92<9                                           2<92<9      2<92<9                                           2<92<9      2<92<9                                           2<92<9       2<92<92<9                                           2<92<9       2<92<9                                           2<92<9       2<92<9                                           2<92<9       2<92<9                                           2<92<9       2<92<9                                           2<92<9       2<92<9                                           2<92<9       2<92<9                                           2<92<9       2<92<9                                           2<92<9       2<92<9                                          2<92<92<9       2<92<9                                           2<92<92<9       2<9                                          2<92<92<9       2<9                                          2<92<92<9       2<9                                          2<92<92<9       2<9                                          2<92<92<9       2<9                                          2<92<92<9       2<9                                         2<92<92<9       2<92<9                                          2<92<92<9       2<92<92<9                                         2<92<92<9        2<92<92<9                                         2<92<92<9        2<92<92<9                                         2<92<92<9        2<92<92<9                                         2<92<92<9        2<92<92<9                                         2<92<92<9        2<92<92<9                                         2<92<92<9        2<92<92<9                                         2<92<92<9       2<92<92<9                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   muJTb                                                                                                                                                                                                                                                                                                                                                                                                                                                muJTbJTbmu                                                                                                   JTb                                                                                                                                                                                                                                                                                                                                         JTbJTbmumu2<92<9mumumu                                              muJTb                                               JTbJTb                                                                                                                                                                                                                                                                                                                                       JTbJTbJTbJTbrOrO2<9mumu                                            muJTbJTb                                               mu2<9JTbmu                                                                                                                                                                                                                                                                                                                                     2<9JTb2<9JTbJTbrOrOrO2<9mu                                             JTbmumumu2<92<9mumu                                              JTbJTbmumu2<92<9mumumu                                                                                                                                                                                                                                                                                                                                     2<92<9iJTb],(],(                                               JTbJTbJTbJTbrO2<9mumu                                              JTbJTbJTbJTbrOrO2<9mumumu                                                                                                                                                                                                                                                                                                                                      2<9irO],(],(                                               JTb2<9JTbJTbrOrO2<9mumu                                              JTb2<9JTbJTbrOrOrO2<9mu                                                                                                                                                                                                                                                                                                                                       2<9rO],(                                               2<92<9iJTb],(mumu                                               2<92<9iJTb],(],(                                                                                                                                                                                                                                                                                                                                          ],(rO                                                2<92<9irO],(],(                                                2<9irO],(],(                                                                                                                                                                                                                                                                                                                                      H6H6H6 %] %] %]rOrO],(],(                                                 2<9rO],(                                                 2<9rO],(                                                                                                                                                                                                                                                                                                                                     ],(H6H6H6H6 %]tttG],(],(                                                 ],(rO                                                   ],(rO                                                                                                                                                                                                                                                                                                                                    bbbbH6H6H6ttttt],(],(                                             %] %] %] %] %]rOrO],(],(                                                %] %] %] %] %]rOrO],(],(                                                                                                                                                                                                                                                                                                                                   bbbbb],(],(ttttt2<92<9                                       bbH6H6H6H6 %]tttG],(],(                                           bbH6H6H6H6 %]tttG],(],(                                                                                                                                                                                                                                                                                                                                 bbbbbb %] %] %] %] %] %]2<9B$3B$3JTb                                     bbbbH6H6H6H6ttttt],(],(                                       bbbbH6H6H6H6ttttt],(],(                                                                                                                                                                                                                                                                                                                               bbb  %] %] %] %] %]B$3B$3B$3B$3B$3                                    bbbbH6H6H6H6ttttt2<92<9                                     bbbbH6H6H6H6ttttt2<92<9                                                                                                                                                                                                                                                                                                                             ],(],(],(   %] %]GGG %] %]B$3B$3B$3B$3B$3B$3                                    bbbbb],(],( %] %] %] %] %] %]2<9B$3B$3JTb                                     bbbbb],(],( %] %] %] %] %] %]2<9B$3B$3JTb                                                                                                                                                                                                                                                                                                                             ],(],(],(   %] %]GGGGGuGuGB$3B$3B$3                                    bbb GG %] %]B$3B$3B$3B$3B$3                                    bbb  %] %] %] %]B$3B$3B$3B$3B$3                                                                                                                                                                                                                                                                                                                             ],(],(i ],(],(],(],(B$3B$3],(],(],(B$3B$3B$3                                    ],(],(],(   %]GGGGB$3B$3B$3B$3                                    ],(],(],(   %] %]GG %]B$3B$3B$3B$3                                                                                                                                                                                                                                                                                                                             iiH6H6H6H6],(B$3B$3],(],(],(],(],(B$3JTb                                      ],(],(i  H6H6H6H6B$3B$3],(],(],(],(],(],(B$3                                     ],(],(i  H6H6H6H6B$3B$3],(],(],(],(],(],(B$3                                                                                                                                                                                                                                                                                                                             iiB$3B$3],(],(],(],(],(JTbJTb                                      iiB$3],(],(],(],(],(],(B$3                                     iiB$3],(],(],(],(],(],(B$3                                                                                                                                                                                                                                                                                                                              i H6B$3],(],(],(],(                                        iiH6B$3B$3B$3],(],(],(],(],(JTb                                      iiH6B$3B$3B$3],(],(],(],(],(JTb                                                                                                                                                                                                                                                                                                                                 H6H6H6],(   ],(],(                                          i H6H6H6H6H6B$3],(],(],(],(],(JTbJTb                                       i H6H6H6H6H6B$3],(],(],(],(],(JTbJTb                                                                                                                                                                                                                                                                                                                                bbb],(      H6H6                                            H6bbbH6H6JTb                                           H6bbbH6H6JTb                                                                                                                                                                                                                                                                                                                                  2<92<9],(      2<92<9                                            2<92<92<9     2<92<9                                            2<92<92<9     2<92<9                                                                                                                                                                                                                                                                                                                                   2<9      2<92<9                                           2<9      2<92<92<9                                           2<9      2<92<92<9                                                                                                                                                                                                                                                                                                                                  2<92<92<9       2<92<9                                          2<92<9       2<92<92<9                                          2<92<9       2<92<92<9                                                                                                                                                                                                                                                                                                                                  2<92<92<9       2<92<92<9                                         2<92<92<9       2<92<92<92<9                                         2<92<92<9       2<92<92<92<9                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                muJTb                                                                                                   JTb                                                                                                                                                                                                                                                                                                                                         muJTbJTbmu                                           muJTb                                               JTbJTb                                                                                                                                                                                                                                                                                                                                       JTbJTbmumu2<92<9mumumu                                             muJTbJTb                                              mu2<9JTbmu                                                                                                                                                                                                                                                                                                                                      JTbJTbJTbJTbrOrO2<9mumumu                                             JTbJTbmumu2<92<9mumumu                                            JTbJTbmumu2<92<9mumumu                                                                                                                                                                                                                                                                                                                                     JTb2<9JTbJTbrOrOrO2<9mu                                             JTbJTbJTbJTbrOrO2<9mumumu                                             JTbJTbJTbJTbrOrO2<9mumumu                                                                                                                                                                                                                                                                                                                                     2<92<9iJTb],(],(                                               JTb2<9JTbJTbrOrOrO2<9mu                                              JTb2<9JTbJTbrOrOrO2<9mu                                                                                                                                                                                                                                                                                                                                      2<9irO],(],(                                               2<92<9iJTb],(],(                                               2<92<9iJTb],(],(                                                                                                                                                                                                                                                                                                                                         2<9rO],(                                                2<9irO],(],(                                                2<9irO],(],(                                                                                                                                                                                                                                                                                                                                          ],(rO                                                  2<9rO],(                                                 2<9rO],(                                                                                                                                                                                                                                                                                                                                      H6H6H6H6 %] %]rOrO],(],(                                                  ],(rO                                                   ],(rO                                                                                                                                                                                                                                                                                                                                      bbH6H6H6ttttG],(],(                                          H6H6H6H6 %] %]rOrO                                           H6H6H6H6 %] %]rOrO                                                                                                                                                                                                                                                                                                                                 bbbH6H6H6ttttt],(],(  mu                                     bbH6H6H6ttB$3B$3B$3B$3],(                                        bbH6H6H6ttB$3B$3B$3B$3],(                                                                                                                                                                                                                                                                                                                               bbbb],(],(ttttt2<92<9 muB$3B$3                                   bbbH6H6H6ttmuB$3B$3],(H6H6],(],(mu                                       bbbH6H6H6ttmuB$3B$3],(H6H6],(],(mu                                                                                                                                                                                                                                                                                                                               bbbb %]GGGGG2<92<92<9B$3B$3B$3B$3B$3B$3                                  bbbb],(],(tmuB$3],(],(],(H6H6],(H6H6                                      bbbb],(],(tmuB$3],(],(],(H6H6],(H6H6                                                                                                                                                                                                                                                                                                                              bbb GGGGG2<9],(],(B$3B$3B$3B$3B$3B$3                                  bbbb %]Gmu],(H6H6],(H6H6],(H6H6                                      bbbb %]Gmu],(H6H6],(H6H6],(H6H6                                                                                                                                                                                                                                                                                                                              ],(],(],( GGGGG],(uGuGB$3B$3B$3B$3                                  bbb Gmu],(H6H6],(H6H6],(H6H6                                      bbb Gmu],(H6H6],(H6H6],(H6H6                                                                                                                                                                                                                                                                                                                              ],(],(],(   %] %]GGGG ],(uGuGB$3B$3B$3B$3                                  ],(],(],( Gmu],(H6H6],(H6H6H6H6H6                                      ],(],(],( Gmu],(H6H6],(H6H6H6H6H6                                                                                                                                                                                                                                                                                                                              ii],(   %] %]GGGG  B$3B$3B$3B$3B$3B$3mu                                   ],(],(],(   %] %]GmuH6H6H6H6H6H6H6                                       ],(],(],(   %] %]GmuH6H6H6H6H6H6H6                                                                                                                                                                                                                                                                                                                               ii  ],(],(],(],(],(B$3B$3B$3 B$3B$3B$3B$3B$3mu                                    ii],(   %] %]GmumuH6H6H6],(],(mumu                                       ii],(   %] %]GmumuH6H6H6],(],(mumu                                                                                                                                                                                                                                                                                                                                 H6H6H6H6B$3B$3B$3B$3  JTbJTbJTb                                      ii  H6H6H6H6B$3mumumumumu                                         ii  H6H6H6H6B$3mumumumumu                                                                                                                                                                                                                                                                                                                                   H6H6H6H6B$3],(],(],(],(                                            H6H6H6H6B$3B$3B$3B$3B$3                                            H6H6H6H6B$3B$3B$3B$3B$3                                                                                                                                                                                                                                                                                                                                     H6H6H6],(],(],(],(],(                                           H6H6H6],(B$3],(],(B$3                                           H6H6H6],(B$3],(],(B$3                                                                                                                                                                                                                                                                                                                                     H6H6H6],(  ],(],(],(                                            H6H6H6],(  ],(],(],(                                            H6H6H6],(  ],(],(],(                                                                                                                                                                                                                                                                                                                                      ],(H6H6    B$3],(],(],(                                            ],(H6H6    B$3],(],(],(                                            ],(H6H6    B$3],(],(],(                                                                                                                                                                                                                                                                                                                                     ],(H6H6     B$3],(],(],(                                            ],(H6H6     B$3],(],(],(                                            ],(H6H6     B$3],(],(],(                                                                                                                                                                                                                                                                                                                                    bbb      B$3H6H6H6                                           bbb      B$3H6H6H6                                           bbb      B$3H6H6H6                                                                                                                                                                                                                                                                                                                                   2<92<9       2<92<9                                           2<92<9       2<92<9                                           2<92<9       2<92<9                                                                                                                                                                                                                                                                                                                                   2<92<9       2<92<9                                           2<92<9       2<92<9                                           2<92<9       2<92<9                                                                                                                                                                                                                                                                                                                                  2<92<92<9        2<92<9                                         2<92<92<9        2<92<9                                         2<92<92<9        2<92<9                                                                                                                                                                                                                                                                                                                                 2<92<92<9        2<92<9                                         2<92<92<9        2<92<9                                         2<92<92<9        2<92<9                                                                                                                                                                                                                                                                                                              TEXT                                	  bruh
WAVE    >  >          a   F  "V                                                                                                                                                                                                                                                                                                                          	                
               
               	 	 	 	 	 	            	 	 	 	             
 	 
 
           	 
 
 
 
           
 
 
 
 
          
     	           	                                                 
                                                                                                                                                	                                                    	        
                                                    
                                                                                                                                                            F 4 ; 8 9 9 /         K 0 < 7 9 8         ! B 4 : 7 8 8         9 9 7 8 7 8 4         D 3 9 6 8 7 .         I / : 5 7 6           ? 2 8 5 7 6         7 7 5 6 6 6 2         A 1 7 4 6 5 ,         F - 8 3 6 4          = 1 6 4 5 4         5 5 4 4 4 4 0         ? / 5 3 4 3 +         D , 6 2 4 3          ; / 4 2 3 2         4 3 2 2 2 2 .         = . 4 1 2 1 )         B * 4 0 2 1          9 - 2 0 1 1         2 1 0 1 0 0 -         ; , 2 / 0 0 (         ? ) 2 . 0 /          7 , 1 . / /         0 / . / . . +         8 * 0 - . . &         = ' 1 , . -          5 * / , - -         . . , - - - )         6 ) . + - , %         : & / + , +          3 ( - + , +         , , + + + + (         4 ' , * + * #         8 $ - ) * *          1 & + ) * )         * * ) ) ) ) &         2 % * ( ) ( "         6 " + ' ) (          . % ) ' ( '         ( ( ' ' ' ' $         0 $ ( & ' '           3 ! ) % ' &          , # ' % & &         ' & % & % % #         - " & $ % %          1  ' # % $          * ! % # $ $         % $ # $ # $ !         +   $ # # #          .  % " # "          (   # " " "         # " ! " " "          )  # ! " !          ,  #   ! !          &  !   !           ! !                  '  !              *  !             $                              $               '               "                             "               %                	       $                       #                       "                       !                       !                       !                       !                       !                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
   
                     
   
                     
   
                     
   
                     
   
                     
   
                     
   
                     
   
                     
   
                     
   
                     
   
                     
   
                     
   
                     
   
                     
   
                     
   
                     
   
                     
   
                     	   
                     	   
                     	   
                     	   
                     	   
                     	   
                     	   
                     	   
                     	   
                     	   
                     	   
                     	  
 
                     	  
 
                     	  
 	                     	  
 	                     	  
 	                     	  
 	         
            	  
 	         
            	  
 	         
            	  
 	         
  
          	  
 	         
 
 
          	  
 	         
 
 
          	  
 	         
 
 
          	  
 	         
 
 
          	  
 	         
 
 
          	  
 	        
 
 
 
          	  
 	        
 
 
 
          	  
 	        
 
 
 
          	  
 	       
 
 
 
 
          	  
 	       
 
 
 
 
          	  
 	       
 
 
 
 
          	  
 	       
 
 
 
 
            
 	       
 
 
 
 
            
 	       
 
 
 
 
            
 	       
 
 
 
 
            
 	       
 
 
 
 
            
 	       
 
 
 
 
            
 	       
 
 
 
 
           
 
 	       
 
 
 
 
           
 	 	       
 
 
 
 
           
 	 	       
 
 
 
 
           
 	 	       
 
 
 
 
           
 	 	       
 
 
 
 
           
 	 	       
 
 
 
 
           
 	        
 
 	 
 
           
 	        
 
 	 
 
           
 	        
 
 	 
 	           
 	        
 
 	 
 	           
 	        
 
 	 	 	           
 	        
 
 	 	 	           
 	        
 
 	 	 	           
 	        
 
 	 	 	           
 	        
 	 	 	 	           
 	        
 	 	 	 	           
 	        
 	 	 	 	           
 	        	 	 	 	 	           
 	        	 	 	 	 	           
 	        	 	 	 	 	           
 	        	 	 	 	 	           
 	        	 	 	 	 	           
 	        	 	 	 	 	           
 	        	 	 	 	 	           
 	        	 	 	 	 	           
 	        	 	 	 	 	           	 	        	 	 	 	 	           	 	        	 	 	 	 	           	 	        	 	 	 	 	           	         	 	 	 	 	           	         	 	 	 	 	           	         	 	 	 	 	           	         	 	 	 	 	           	         	 	 	 	 	           	         	 	  	 	           	         	 	  	 	           	         	 	  	            	         	 	              	         	 	              	         	 	              	         	 	              	         	               	         	               	         	               	                        	                        	                        	                        	                        	                        	                        	                                                                                                                                                                                              
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        	                        	                        	                        	                        	                        	                        	                        	                        	                        	                        	                        	                        	                        	                        	                        	                        	                        	                        	                        	                        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    {
  "assets": {
    "player": {
      "char_blue_1.png": [
        1,
        -1239853229
      ]
    },
    "test.txt": [
      0,
      -789460566
    ],
    "sounds": {
      "coin.wav": [
        2,
        34479757
      ]
    }
  }
}!<arch>
/               0           0     0     0       76        `
                     Init hook_name ProcessInput Update Draw Cleanup mod_scene.c.o/  0           0     0     644     1825      `
 asm    ` ` ` env__linear_memory env__stack_pointerenvColorToNuklearF env__memory_base envsnprintf envEngine_RunHook GOT.mem	hook_name       
 ~# A k"$  A~6  A~6 Aj Aj    (Aj6 # !# "A A j       A j$ \# Ak"$    (Aj6 # !# "A A j       Aj$ \# Ak"$    (Aj6 # !# "A A j       Aj$ \# Ak"$    (Aj6 # !# "A A j       Aj$ \# Ak"$    (Aj6 # !# "A A j       Aj$   A                                                                                                                                                                                                                                                                  AHOOK_%s_INIT  AHOOK_%s_PROCESS_INPUT  AHOOK_%s_UPDATE  AHOOK_%s_DRAW  AHOOK_%s_CLEANUP   linking   Init    	hook_name  .L.str     ProcessInput.L.str.1   Update.L.str.2   Draw.L.str.3   Cleanup.L.str.4  .bss.hook_name .rodata..L.str .rodata..L.str.1 .rodata..L.str.2 .rodata..L.str.3 .rodata..L.str.4   
reloc.CODE) 3FN[  d oz	              	producersprocessed-byclangK21.0.0git (/startdir/llvm-project bf94c8ddb321696956365830bf23dd232ef90e74)  target_features+bulk-memory+bulk-memory-opt+call-indirect-overlong+
multivalue+mutable-globals+nontrapping-fptoint+reference-types+sign-ext
